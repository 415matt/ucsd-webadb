{"version":3,"file":"static/chunks/pages/scrcpy-c5bd4f8b15729490.js","mappings":"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","sources":["webpack://_N_E/?1f23","webpack://_N_E/./src/components/command-bar-spacer-item.tsx","webpack://_N_E/../../libraries/scrcpy/src/codec/av1.ts","webpack://_N_E/../../libraries/scrcpy/src/codec/nalu.ts","webpack://_N_E/../../libraries/scrcpy/src/codec/h264.ts","webpack://_N_E/../../libraries/scrcpy/src/codec/h265.ts","webpack://_N_E/../../libraries/scrcpy/src/codec/index.ts","webpack://_N_E/../../libraries/scrcpy/src/control/basic.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-touch.ts","webpack://_N_E/../../libraries/scrcpy/src/control/type.ts","webpack://_N_E/../../libraries/scrcpy/src/control/hover-helper.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-keycode.ts","webpack://_N_E/../../libraries/scrcpy/src/control/inject-text.ts","webpack://_N_E/../../libraries/scrcpy/src/control/rotate-device.ts","webpack://_N_E/../../libraries/scrcpy/src/control/set-screen-power-mode.ts","webpack://_N_E/../../libraries/scrcpy/src/control/serializer.ts","webpack://_N_E/../../libraries/scrcpy/src/control/writer.ts","webpack://_N_E/../../libraries/scrcpy/src/control/index.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/type.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/ack-clipboard.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/clipboard.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/stream.ts","webpack://_N_E/../../libraries/scrcpy/src/device-message/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/codec-options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/float-to-uint16.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/init.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/message.ts","webpack://_N_E/../../libraries/scrcpy/src/options/codec.ts","webpack://_N_E/../../libraries/scrcpy/src/options/types.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/scroll.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_16/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_17.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_18.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_21.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22/scroll.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22/options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_22/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_23.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_24.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_25/scroll.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_25/options.ts","webpack://_N_E/../../libraries/scrcpy/src/options/1_25/index.ts","webpack://_N_E/../../libraries/scrcpy/src/options/2_0.ts","webpack://_N_E/../../libraries/scrcpy/src/options/2_1.ts","webpack://_N_E/../../libraries/scrcpy/src/options/latest.ts","webpack://_N_E/../../libraries/scrcpy/src/options/index.ts","webpack://_N_E/../../libraries/scrcpy/src/index.ts","webpack://_N_E/../../libraries/scrcpy-decoder-webcodecs/src/index.ts","webpack://_N_E/./src/components/scrcpy/recorder.ts","webpack://_N_E/../../libraries/adb-scrcpy/src/client.ts","webpack://_N_E/../../libraries/adb-scrcpy/src/connection.ts","webpack://_N_E/../../libraries/adb-scrcpy/src/options/types.ts","webpack://_N_E/../../libraries/adb-scrcpy/src/options/1_16.ts","webpack://_N_E/../../libraries/adb-scrcpy/src/options/1_22.ts","webpack://_N_E/../../libraries/adb-scrcpy/src/options/2_0.ts","webpack://_N_E/../../libraries/adb-scrcpy/src/options/latest.ts","webpack://_N_E/../../libraries/adb-scrcpy/src/options/index.ts","webpack://_N_E/../../libraries/adb-scrcpy/src/index.ts","webpack://_N_E/../../libraries/fetch-scrcpy-server/index.js","webpack://_N_E/../../libraries/pcm-player/src/index.ts","webpack://_N_E/./src/components/scrcpy/audio-decode-stream.ts","webpack://_N_E/./src/components/scrcpy/fetch-server.ts","webpack://_N_E/./src/components/scrcpy/input.ts","webpack://_N_E/../../libraries/scrcpy-decoder-tinyh264/src/wrapper.ts","webpack://_N_E/../../libraries/scrcpy-decoder-tinyh264/src/decoder.ts","webpack://_N_E/../../libraries/scrcpy-decoder-tinyh264/src/index.ts","webpack://_N_E/./src/components/scrcpy/settings.tsx","webpack://_N_E/./src/components/scrcpy/state.tsx","webpack://_N_E/./src/components/scrcpy/command-bar.tsx","webpack://_N_E/./src/components/scrcpy/navigation-bar.tsx","webpack://_N_E/./src/components/scrcpy/video-container.tsx","webpack://_N_E/./src/components/scrcpy/index.ts","webpack://_N_E/./src/hooks/add-event-listener.ts","webpack://_N_E/./src/hooks/layout-effect.ts","webpack://_N_E/./src/hooks/stable-callback.ts","webpack://_N_E/./src/hooks/local-storage.ts","webpack://_N_E/./src/hooks/index.ts","webpack://_N_E/./src/pages/scrcpy.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/scrcpy\",\n      function () {\n        return require(\"private-next-pages/scrcpy.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/scrcpy\"])\n      });\n    }\n  ","import { useEffect, useState } from \"react\";\r\n\r\nexport function CommandBarSpacerItem() {\r\n    const [container, setContainer] = useState<HTMLDivElement | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (!container) {\r\n            return;\r\n        }\r\n\r\n        const parent = container.parentElement!;\r\n        const originalFlexGrow = parent.style.flexGrow;\r\n        parent.style.flexGrow = \"1\";\r\n        return () => {\r\n            parent.style.flexGrow = originalFlexGrow;\r\n        };\r\n    }, [container]);\r\n\r\n    return <div ref={setContainer} />;\r\n}\r\n","export enum AndroidAv1Profile {\r\n    Main8 = 1 << 0,\r\n    Main10 = 1 << 1,\r\n    Main10Hdr10 = 1 << 12,\r\n    Main10Hdr10Plus = 1 << 13,\r\n}\r\n\r\nexport enum AndroidAv1Level {\r\n    Level2 = 1 << 0,\r\n    Level21 = 1 << 1,\r\n    Level22 = 1 << 2,\r\n    Level23 = 1 << 3,\r\n    Level3 = 1 << 4,\r\n    Level31 = 1 << 5,\r\n    Level32 = 1 << 6,\r\n    Level33 = 1 << 7,\r\n    Level4 = 1 << 8,\r\n    Level41 = 1 << 9,\r\n    Level42 = 1 << 10,\r\n    Level43 = 1 << 11,\r\n    Level5 = 1 << 12,\r\n    Level51 = 1 << 13,\r\n    Level52 = 1 << 14,\r\n    Level53 = 1 << 15,\r\n    Level6 = 1 << 16,\r\n    Level61 = 1 << 17,\r\n    Level62 = 1 << 18,\r\n    Level63 = 1 << 19,\r\n    Level7 = 1 << 20,\r\n    Level71 = 1 << 21,\r\n    Level72 = 1 << 22,\r\n    Level73 = 1 << 23,\r\n}\r\n","/**\r\n * Split NAL units from an H.264/H.265 Annex B stream.\r\n *\r\n * The input is not modified.\r\n * The returned NAL units are views of the input (no memory allocation nor copy),\r\n * and still contains emulation prevention bytes.\r\n *\r\n * This methods returns a generator, so it can be stopped immediately\r\n * after the interested NAL unit is found.\r\n */\r\nexport function* annexBSplitNalu(buffer: Uint8Array): Generator<Uint8Array> {\r\n    // -1 means we haven't found the first start code\r\n    let start = -1;\r\n    // How many `0x00`s in a row we have counted\r\n    let zeroCount = 0;\r\n    let inEmulation = false;\r\n\r\n    for (let i = 0; i < buffer.length; i += 1) {\r\n        const byte = buffer[i]!;\r\n\r\n        if (inEmulation) {\r\n            if (byte > 0x03) {\r\n                // `0x00000304` or larger are invalid\r\n                throw new Error(\"Invalid data\");\r\n            }\r\n\r\n            inEmulation = false;\r\n            continue;\r\n        }\r\n\r\n        if (byte === 0x00) {\r\n            zeroCount += 1;\r\n            continue;\r\n        }\r\n\r\n        const prevZeroCount = zeroCount;\r\n        zeroCount = 0;\r\n\r\n        if (start === -1) {\r\n            // 0x000001 is the start code\r\n            // But it can be preceded by any number of zeros\r\n            // So 2 is the minimal\r\n            if (prevZeroCount >= 2 && byte === 0x01) {\r\n                // Found start of first NAL unit\r\n                start = i + 1;\r\n                continue;\r\n            }\r\n\r\n            // Not begin with start code\r\n            throw new Error(\"Invalid data\");\r\n        }\r\n\r\n        if (prevZeroCount < 2) {\r\n            // zero or one `0x00`s are acceptable\r\n            continue;\r\n        }\r\n\r\n        if (byte === 0x01) {\r\n            // Found another NAL unit\r\n            yield buffer.subarray(start, i - prevZeroCount);\r\n\r\n            start = i + 1;\r\n            continue;\r\n        }\r\n\r\n        if (prevZeroCount > 2) {\r\n            // Too much `0x00`s\r\n            throw new Error(\"Invalid data\");\r\n        }\r\n\r\n        switch (byte) {\r\n            case 0x02:\r\n                // Didn't find why, but 7.4.1 NAL unit semantics forbids `0x000002` appearing in NAL units\r\n                throw new Error(\"Invalid data\");\r\n            case 0x03:\r\n                // `0x000003` is the \"emulation_prevention_three_byte\"\r\n                // `0x00000300`, `0x00000301`, `0x00000302` and `0x00000303` represent\r\n                // `0x000000`, `0x000001`, `0x000002` and `0x000003` respectively\r\n                inEmulation = true;\r\n                break;\r\n            default:\r\n                // `0x000004` or larger are as-is\r\n                break;\r\n        }\r\n    }\r\n\r\n    if (inEmulation) {\r\n        throw new Error(\"Invalid data\");\r\n    }\r\n\r\n    yield buffer.subarray(start, buffer.length);\r\n}\r\n\r\n/**\r\n * Remove emulation prevention bytes from a H.264/H.265 NAL Unit.\r\n *\r\n * The input is not modified.\r\n * If the input doesn't contain any emulation prevention bytes,\r\n * the input is returned as-is.\r\n * Otherwise, a new `Uint8Array` is created and returned.\r\n */\r\nexport function naluRemoveEmulation(buffer: Uint8Array) {\r\n    // output will be created when first emulation prevention byte is found\r\n    let output: Uint8Array | undefined;\r\n    let outputOffset = 0;\r\n\r\n    let zeroCount = 0;\r\n    let inEmulation = false;\r\n\r\n    let i = 0;\r\n    scan: for (; i < buffer.length; i += 1) {\r\n        const byte = buffer[i]!;\r\n\r\n        if (byte === 0x00) {\r\n            zeroCount += 1;\r\n            continue;\r\n        }\r\n\r\n        // Current byte is not zero\r\n        const prevZeroCount = zeroCount;\r\n        zeroCount = 0;\r\n\r\n        if (prevZeroCount < 2) {\r\n            // zero or one `0x00`s are acceptable\r\n            continue;\r\n        }\r\n\r\n        if (byte === 0x01) {\r\n            // Unexpected start code\r\n            throw new Error(\"Invalid data\");\r\n        }\r\n\r\n        if (prevZeroCount > 2) {\r\n            // Too much `0x00`s\r\n            throw new Error(\"Invalid data\");\r\n        }\r\n\r\n        switch (byte) {\r\n            case 0x02:\r\n                // Didn't find why, but 7.4.1 NAL unit semantics forbids `0x000002` appearing in NAL units\r\n                throw new Error(\"Invalid data\");\r\n            case 0x03:\r\n                // `0x000003` is the \"emulation_prevention_three_byte\"\r\n                // `0x00000300`, `0x00000301`, `0x00000302` and `0x00000303` represent\r\n                // `0x000000`, `0x000001`, `0x000002` and `0x000003` respectively\r\n                inEmulation = true;\r\n\r\n                // Create output and copy the data before the emulation prevention byte\r\n                // Output size is unknown, so we use the input size as an upper bound\r\n                output = new Uint8Array(buffer.length - 1);\r\n                output.set(buffer.subarray(0, i));\r\n                outputOffset = i;\r\n                i += 1;\r\n                break scan;\r\n            default:\r\n                // `0x000004` or larger are as-is\r\n                break;\r\n        }\r\n    }\r\n\r\n    if (!output) {\r\n        return buffer;\r\n    }\r\n\r\n    // Continue at the byte after the emulation prevention byte\r\n    for (; i < buffer.length; i += 1) {\r\n        const byte = buffer[i]!;\r\n\r\n        output[outputOffset] = byte;\r\n        outputOffset += 1;\r\n\r\n        if (inEmulation) {\r\n            if (byte > 0x03) {\r\n                // `0x00000304` or larger are invalid\r\n                throw new Error(\"Invalid data\");\r\n            }\r\n\r\n            // `00000300000300` results in `0000000000` (both `0x03` are removed)\r\n            // which means the `0x00` after `0x03` also counts\r\n            if (byte === 0x00) {\r\n                zeroCount += 1;\r\n            }\r\n\r\n            inEmulation = false;\r\n            continue;\r\n        }\r\n\r\n        if (byte === 0x00) {\r\n            zeroCount += 1;\r\n            continue;\r\n        }\r\n\r\n        const prevZeroCount = zeroCount;\r\n        zeroCount = 0;\r\n\r\n        if (prevZeroCount < 2) {\r\n            // zero or one `0x00`s are acceptable\r\n            continue;\r\n        }\r\n\r\n        if (byte === 0x01) {\r\n            // Unexpected start code\r\n            throw new Error(\"Invalid data\");\r\n        }\r\n\r\n        if (prevZeroCount > 2) {\r\n            // Too much `0x00`s\r\n            throw new Error(\"Invalid data\");\r\n        }\r\n\r\n        switch (byte) {\r\n            case 0x02:\r\n                // Didn't find why, but 7.4.1 NAL unit semantics forbids `0x000002` appearing in NAL units\r\n                throw new Error(\"Invalid data\");\r\n            case 0x03:\r\n                // `0x000003` is the \"emulation_prevention_three_byte\"\r\n                // `0x00000300`, `0x00000301`, `0x00000302` and `0x00000303` represent\r\n                // `0x000000`, `0x000001`, `0x000002` and `0x000003` respectively\r\n                inEmulation = true;\r\n\r\n                // Remove the emulation prevention byte\r\n                outputOffset -= 1;\r\n                break;\r\n            default:\r\n                // `0x000004` or larger are as-is\r\n                break;\r\n        }\r\n    }\r\n\r\n    return output.subarray(0, outputOffset);\r\n}\r\n\r\nexport class NaluSodbBitReader {\r\n    private readonly _nalu: Uint8Array;\r\n    private readonly _byteLength: number;\r\n    private readonly _stopBitIndex: number;\r\n\r\n    private _zeroCount = 0;\r\n    private _bytePosition = -1;\r\n    private _bitPosition = -1;\r\n    private _byte = 0;\r\n\r\n    public get byteLength() {\r\n        return this._byteLength;\r\n    }\r\n\r\n    public get stopBitIndex() {\r\n        return this._stopBitIndex;\r\n    }\r\n\r\n    public get bytePosition() {\r\n        return this._bytePosition;\r\n    }\r\n\r\n    public get bitPosition() {\r\n        return this._bitPosition;\r\n    }\r\n\r\n    public get ended() {\r\n        return (\r\n            this._bytePosition === this._byteLength &&\r\n            this._bitPosition === this._stopBitIndex\r\n        );\r\n    }\r\n\r\n    public constructor(nalu: Uint8Array) {\r\n        this._nalu = nalu;\r\n\r\n        for (let i = nalu.length - 1; i >= 0; i -= 1) {\r\n            if (this._nalu[i] === 0) {\r\n                continue;\r\n            }\r\n\r\n            const byte = nalu[i]!;\r\n            for (let j = 0; j < 8; j += 1) {\r\n                if (((byte >> j) & 1) === 1) {\r\n                    this._byteLength = i;\r\n                    this._stopBitIndex = j;\r\n                    this.readByte();\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n\r\n        throw new Error(\"End bit not found\");\r\n    }\r\n\r\n    private readByte() {\r\n        this._byte = this._nalu[this._bytePosition]!;\r\n        if (this._zeroCount === 2 && this._byte === 3) {\r\n            this._zeroCount = 0;\r\n            this._bytePosition += 1;\r\n            this.readByte();\r\n            return;\r\n        }\r\n\r\n        if (this._byte === 0) {\r\n            this._zeroCount += 1;\r\n        } else {\r\n            this._zeroCount = 0;\r\n        }\r\n    }\r\n\r\n    public next() {\r\n        if (this._bitPosition === -1) {\r\n            this._bitPosition = 7;\r\n            this._bytePosition += 1;\r\n            this.readByte();\r\n        }\r\n\r\n        if (\r\n            this._bytePosition === this._byteLength &&\r\n            this._bitPosition === this._stopBitIndex\r\n        ) {\r\n            throw new Error(\"Bit index out of bounds\");\r\n        }\r\n\r\n        const value = (this._byte >> this._bitPosition) & 1;\r\n        this._bitPosition -= 1;\r\n        return value;\r\n    }\r\n\r\n    public read(length: number): number {\r\n        if (length > 32) {\r\n            throw new Error(\"Read length too large\");\r\n        }\r\n\r\n        let result = 0;\r\n        for (let i = 0; i < length; i += 1) {\r\n            result = (result << 1) | this.next();\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public skip(length: number) {\r\n        for (let i = 0; i < length; i += 1) {\r\n            this.next();\r\n        }\r\n    }\r\n\r\n    public decodeExponentialGolombNumber(): number {\r\n        let length = 0;\r\n        while (this.next() === 0) {\r\n            length += 1;\r\n        }\r\n        if (length === 0) {\r\n            return 0;\r\n        }\r\n        return ((1 << length) | this.read(length)) - 1;\r\n    }\r\n\r\n    public peek(length: number) {\r\n        const { _zeroCount, _bytePosition, _bitPosition, _byte } = this;\r\n        const result = this.read(length);\r\n        Object.assign(this, { _zeroCount, _bytePosition, _bitPosition, _byte });\r\n        return result;\r\n    }\r\n\r\n    public readBytes(length: number): Uint8Array {\r\n        const result = new Uint8Array(length);\r\n        for (let i = 0; i < length; i += 1) {\r\n            result[i] = this.read(8);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public peekBytes(length: number): Uint8Array {\r\n        const { _zeroCount, _bytePosition, _bitPosition, _byte } = this;\r\n        const result = this.readBytes(length);\r\n        Object.assign(this, { _zeroCount, _bytePosition, _bitPosition, _byte });\r\n        return result;\r\n    }\r\n}\r\n","// cspell: ignore golomb\r\n// cspell: ignore qpprime\r\n// cspell: ignore colour\r\n\r\nimport { NaluSodbBitReader, annexBSplitNalu } from \"./nalu.js\";\r\n\r\n// From https://developer.android.com/reference/android/media/MediaCodecInfo.CodecProfileLevel\r\nexport enum AndroidAvcProfile {\r\n    Baseline = 1 << 0,\r\n    Main = 1 << 1,\r\n    Extended = 1 << 2,\r\n    High = 1 << 3,\r\n    High10 = 1 << 4,\r\n    High422 = 1 << 5,\r\n    High444 = 1 << 6,\r\n    ConstrainedBaseline = 1 << 16,\r\n    ConstrainedHigh = 1 << 19,\r\n}\r\n\r\nexport enum AndroidAvcLevel {\r\n    Level1 = 1 << 0,\r\n    Level1b = 1 << 1,\r\n    Level11 = 1 << 2,\r\n    Level12 = 1 << 3,\r\n    Level13 = 1 << 4,\r\n    Level2 = 1 << 5,\r\n    Level21 = 1 << 6,\r\n    Level22 = 1 << 7,\r\n    Level3 = 1 << 8,\r\n    Level31 = 1 << 9,\r\n    Level32 = 1 << 10,\r\n    Level4 = 1 << 11,\r\n    Level41 = 1 << 12,\r\n    Level42 = 1 << 13,\r\n    Level5 = 1 << 14,\r\n    Level51 = 1 << 15,\r\n    Level52 = 1 << 16,\r\n    Level6 = 1 << 17,\r\n    Level61 = 1 << 18,\r\n    Level62 = 1 << 19,\r\n}\r\n\r\n// H.264 has two standards: ITU-T H.264 and ISO/IEC 14496-10\r\n// they have the same content, and refer themselves as \"H.264\".\r\n// The name \"AVC\" (Advanced Video Coding) is only used in ISO spec name,\r\n// and other ISO specs referring to H.264.\r\n// Because this module parses H.264 Annex B format,\r\n// it's named \"h264\" instead of \"avc\".\r\n\r\n// 7.3.2.1.1 Sequence parameter set data syntax\r\n// Variable names in this method uses the snake_case convention as in the spec for easier referencing.\r\nexport function h264ParseSequenceParameterSet(nalu: Uint8Array) {\r\n    const reader = new NaluSodbBitReader(nalu);\r\n    if (reader.next() !== 0) {\r\n        throw new Error(\"Invalid data\");\r\n    }\r\n\r\n    const nal_ref_idc = reader.read(2);\r\n    const nal_unit_type = reader.read(5);\r\n\r\n    if (nal_unit_type !== 7) {\r\n        throw new Error(\"Invalid data\");\r\n    }\r\n\r\n    if (nal_ref_idc === 0) {\r\n        throw new Error(\"Invalid data\");\r\n    }\r\n\r\n    const profile_idc = reader.read(8);\r\n    const constraint_set = reader.peek(8);\r\n\r\n    const constraint_set0_flag = !!reader.next();\r\n    const constraint_set1_flag = !!reader.next();\r\n    const constraint_set2_flag = !!reader.next();\r\n    const constraint_set3_flag = !!reader.next();\r\n    const constraint_set4_flag = !!reader.next();\r\n    const constraint_set5_flag = !!reader.next();\r\n\r\n    // reserved_zero_2bits\r\n    if (reader.read(2) !== 0) {\r\n        throw new Error(\"Invalid data\");\r\n    }\r\n\r\n    const level_idc = reader.read(8);\r\n    const seq_parameter_set_id = reader.decodeExponentialGolombNumber();\r\n\r\n    if (\r\n        profile_idc === 100 ||\r\n        profile_idc === 110 ||\r\n        profile_idc === 122 ||\r\n        profile_idc === 244 ||\r\n        profile_idc === 44 ||\r\n        profile_idc === 83 ||\r\n        profile_idc === 86 ||\r\n        profile_idc === 118 ||\r\n        profile_idc === 128 ||\r\n        profile_idc === 138 ||\r\n        profile_idc === 139 ||\r\n        profile_idc === 134\r\n    ) {\r\n        const chroma_format_idc = reader.decodeExponentialGolombNumber();\r\n        if (chroma_format_idc === 3) {\r\n            // separate_colour_plane_flag\r\n            reader.next();\r\n        }\r\n\r\n        // bit_depth_luma_minus8\r\n        reader.decodeExponentialGolombNumber();\r\n        // bit_depth_chroma_minus8\r\n        reader.decodeExponentialGolombNumber();\r\n\r\n        // qpprime_y_zero_transform_bypass_flag\r\n        reader.next();\r\n\r\n        const seq_scaling_matrix_present_flag = !!reader.next();\r\n        if (seq_scaling_matrix_present_flag) {\r\n            const seq_scaling_list_present_flag: boolean[] = [];\r\n            for (let i = 0; i < (chroma_format_idc !== 3 ? 8 : 12); i += 1) {\r\n                seq_scaling_list_present_flag[i] = !!reader.next();\r\n                if (seq_scaling_list_present_flag[i])\r\n                    if (i < 6) {\r\n                        // TODO\r\n                        // scaling_list( ScalingList4x4[ i ], 16,\r\n                        //               UseDefaultScalingMatrix4x4Flag[ i ])\r\n                    } else {\r\n                        // TODO\r\n                        // scaling_list( ScalingList8x8[ i − 6 ], 64,\r\n                        //               UseDefaultScalingMatrix8x8Flag[ i − 6 ] )\r\n                    }\r\n            }\r\n        }\r\n    }\r\n\r\n    // log2_max_frame_num_minus4\r\n    reader.decodeExponentialGolombNumber();\r\n    const pic_order_cnt_type = reader.decodeExponentialGolombNumber();\r\n    if (pic_order_cnt_type === 0) {\r\n        // log2_max_pic_order_cnt_lsb_minus4\r\n        reader.decodeExponentialGolombNumber();\r\n    } else if (pic_order_cnt_type === 1) {\r\n        // delta_pic_order_always_zero_flag\r\n        reader.next();\r\n        // offset_for_non_ref_pic\r\n        reader.decodeExponentialGolombNumber();\r\n        // offset_for_top_to_bottom_field\r\n        reader.decodeExponentialGolombNumber();\r\n        const num_ref_frames_in_pic_order_cnt_cycle =\r\n            reader.decodeExponentialGolombNumber();\r\n        const offset_for_ref_frame: number[] = [];\r\n        for (let i = 0; i < num_ref_frames_in_pic_order_cnt_cycle; i += 1) {\r\n            offset_for_ref_frame[i] = reader.decodeExponentialGolombNumber();\r\n        }\r\n    }\r\n\r\n    // max_num_ref_frames\r\n    reader.decodeExponentialGolombNumber();\r\n    // gaps_in_frame_num_value_allowed_flag\r\n    reader.next();\r\n    const pic_width_in_mbs_minus1 = reader.decodeExponentialGolombNumber();\r\n    const pic_height_in_map_units_minus1 =\r\n        reader.decodeExponentialGolombNumber();\r\n\r\n    const frame_mbs_only_flag = reader.next();\r\n    if (!frame_mbs_only_flag) {\r\n        // mb_adaptive_frame_field_flag\r\n        reader.next();\r\n    }\r\n\r\n    // direct_8x8_inference_flag\r\n    reader.next();\r\n\r\n    const frame_cropping_flag = !!reader.next();\r\n    let frame_crop_left_offset: number;\r\n    let frame_crop_right_offset: number;\r\n    let frame_crop_top_offset: number;\r\n    let frame_crop_bottom_offset: number;\r\n    if (frame_cropping_flag) {\r\n        frame_crop_left_offset = reader.decodeExponentialGolombNumber();\r\n        frame_crop_right_offset = reader.decodeExponentialGolombNumber();\r\n        frame_crop_top_offset = reader.decodeExponentialGolombNumber();\r\n        frame_crop_bottom_offset = reader.decodeExponentialGolombNumber();\r\n    } else {\r\n        frame_crop_left_offset = 0;\r\n        frame_crop_right_offset = 0;\r\n        frame_crop_top_offset = 0;\r\n        frame_crop_bottom_offset = 0;\r\n    }\r\n\r\n    const vui_parameters_present_flag = !!reader.next();\r\n    if (vui_parameters_present_flag) {\r\n        // TODO\r\n        // vui_parameters( )\r\n    }\r\n\r\n    return {\r\n        profile_idc,\r\n        constraint_set,\r\n        constraint_set0_flag,\r\n        constraint_set1_flag,\r\n        constraint_set2_flag,\r\n        constraint_set3_flag,\r\n        constraint_set4_flag,\r\n        constraint_set5_flag,\r\n        level_idc,\r\n        seq_parameter_set_id,\r\n        pic_width_in_mbs_minus1,\r\n        pic_height_in_map_units_minus1,\r\n        frame_mbs_only_flag,\r\n        frame_cropping_flag,\r\n        frame_crop_left_offset,\r\n        frame_crop_right_offset,\r\n        frame_crop_top_offset,\r\n        frame_crop_bottom_offset,\r\n    };\r\n}\r\n\r\n/**\r\n * Find Sequence Parameter Set (SPS) and Picture Parameter Set (PPS)\r\n * from H.264 Annex B formatted data.\r\n */\r\nexport function h264SearchConfiguration(buffer: Uint8Array) {\r\n    let sequenceParameterSet: Uint8Array | undefined;\r\n    let pictureParameterSet: Uint8Array | undefined;\r\n\r\n    for (const nalu of annexBSplitNalu(buffer)) {\r\n        const naluType = nalu[0]! & 0x1f;\r\n        switch (naluType) {\r\n            case 7: // Sequence parameter set\r\n                sequenceParameterSet = nalu;\r\n                if (pictureParameterSet) {\r\n                    return {\r\n                        sequenceParameterSet,\r\n                        pictureParameterSet,\r\n                    };\r\n                }\r\n                break;\r\n            case 8: // Picture parameter set\r\n                pictureParameterSet = nalu;\r\n                if (sequenceParameterSet) {\r\n                    return {\r\n                        sequenceParameterSet,\r\n                        pictureParameterSet,\r\n                    };\r\n                }\r\n                break;\r\n            default:\r\n                // ignore\r\n                break;\r\n        }\r\n    }\r\n\r\n    throw new Error(\"Invalid data\");\r\n}\r\n\r\nexport interface H264Configuration {\r\n    pictureParameterSet: Uint8Array;\r\n    sequenceParameterSet: Uint8Array;\r\n\r\n    profileIndex: number;\r\n    constraintSet: number;\r\n    levelIndex: number;\r\n\r\n    encodedWidth: number;\r\n    encodedHeight: number;\r\n\r\n    cropLeft: number;\r\n    cropRight: number;\r\n    cropTop: number;\r\n    cropBottom: number;\r\n    croppedWidth: number;\r\n    croppedHeight: number;\r\n}\r\n\r\nexport function h264ParseConfiguration(data: Uint8Array): H264Configuration {\r\n    const { sequenceParameterSet, pictureParameterSet } =\r\n        h264SearchConfiguration(data);\r\n\r\n    const {\r\n        profile_idc: profileIndex,\r\n        constraint_set: constraintSet,\r\n        level_idc: levelIndex,\r\n        pic_width_in_mbs_minus1,\r\n        pic_height_in_map_units_minus1,\r\n        frame_mbs_only_flag,\r\n        frame_crop_left_offset,\r\n        frame_crop_right_offset,\r\n        frame_crop_top_offset,\r\n        frame_crop_bottom_offset,\r\n    } = h264ParseSequenceParameterSet(sequenceParameterSet);\r\n\r\n    const encodedWidth = (pic_width_in_mbs_minus1 + 1) * 16;\r\n    const encodedHeight =\r\n        (pic_height_in_map_units_minus1 + 1) * (2 - frame_mbs_only_flag) * 16;\r\n    const cropLeft = frame_crop_left_offset * 2;\r\n    const cropRight = frame_crop_right_offset * 2;\r\n    const cropTop = frame_crop_top_offset * 2;\r\n    const cropBottom = frame_crop_bottom_offset * 2;\r\n\r\n    const croppedWidth = encodedWidth - cropLeft - cropRight;\r\n    const croppedHeight = encodedHeight - cropTop - cropBottom;\r\n\r\n    return {\r\n        pictureParameterSet,\r\n        sequenceParameterSet,\r\n        profileIndex,\r\n        constraintSet,\r\n        levelIndex,\r\n        encodedWidth,\r\n        encodedHeight,\r\n        cropLeft,\r\n        cropRight,\r\n        cropTop,\r\n        cropBottom,\r\n        croppedWidth,\r\n        croppedHeight,\r\n    };\r\n}\r\n","// cspell: ignore golomb\r\n// cspell: ignore qpprime\r\n// cspell: ignore colour\r\n// cspell: ignore inbld\r\n// cspell: ignore Coef\r\n// cspell: ignore coeffs\r\n// cspell: ignore Pocs\r\n// cspell: ignore overscan\r\n// cspell: ignore disp\r\n// cspell: ignore bitstream\r\n// cspell: ignore scal\r\n// cspell: ignore ivmc\r\n// cspell: ignore dbbp\r\n// cspell: ignore texmc\r\n// cspell: ignore rbsp\r\n// cspell: ignore cprms\r\n\r\nimport { NaluSodbBitReader, annexBSplitNalu } from \"./nalu.js\";\r\n\r\nexport enum AndroidHevcProfile {\r\n    Main = 1 << 0,\r\n    Main10 = 1 << 1,\r\n    MainStill = 1 << 2,\r\n    Main10Hdr10 = 1 << 12,\r\n    Main10Hdr10Plus = 1 << 13,\r\n}\r\n\r\nexport enum AndroidHevcLevel {\r\n    MainTierLevel1 = 1 << 0,\r\n    HighTierLevel1 = 1 << 1,\r\n    MainTierLevel2 = 1 << 2,\r\n    HighTierLevel2 = 1 << 3,\r\n    MainTierLevel21 = 1 << 4,\r\n    HighTierLevel21 = 1 << 5,\r\n    MainTierLevel3 = 1 << 6,\r\n    HighTierLevel3 = 1 << 7,\r\n    MainTierLevel31 = 1 << 8,\r\n    HighTierLevel31 = 1 << 9,\r\n    MainTierLevel4 = 1 << 10,\r\n    HighTierLevel4 = 1 << 11,\r\n    MainTierLevel41 = 1 << 12,\r\n    HighTierLevel41 = 1 << 13,\r\n    MainTierLevel5 = 1 << 14,\r\n    HighTierLevel5 = 1 << 15,\r\n    MainTierLevel51 = 1 << 16,\r\n    HighTierLevel51 = 1 << 17,\r\n    MainTierLevel52 = 1 << 18,\r\n    HighTierLevel52 = 1 << 19,\r\n    MainTierLevel6 = 1 << 20,\r\n    HighTierLevel6 = 1 << 21,\r\n    MainTierLevel61 = 1 << 22,\r\n    HighTierLevel61 = 1 << 23,\r\n    MainTierLevel62 = 1 << 24,\r\n    HighTierLevel62 = 1 << 25,\r\n}\r\n\r\n/**\r\n * 6.2 Source, decoded and output picture formats\r\n */\r\nexport function getSubWidthC(chroma_format_idc: number) {\r\n    switch (chroma_format_idc) {\r\n        case 0:\r\n        case 3:\r\n            return 1;\r\n        case 1:\r\n        case 2:\r\n            return 2;\r\n        default:\r\n            throw new Error(\"Invalid chroma_format_idc\");\r\n    }\r\n}\r\n\r\n/**\r\n * 6.2 Source, decoded and output picture formats\r\n */\r\nexport function getSubHeightC(chroma_format_idc: number) {\r\n    switch (chroma_format_idc) {\r\n        case 0:\r\n        case 2:\r\n        case 3:\r\n            return 1;\r\n        case 1:\r\n            return 2;\r\n        default:\r\n            throw new Error(\"Invalid chroma_format_idc\");\r\n    }\r\n}\r\n\r\n/**\r\n * 7.3.1.1 General NAL unit syntax\r\n */\r\nexport function h265ParseNaluHeader(nalu: Uint8Array) {\r\n    const reader = new NaluSodbBitReader(nalu);\r\n    if (reader.next() !== 0) {\r\n        throw new Error(\"Invalid NALU header\");\r\n    }\r\n\r\n    const nal_unit_type = reader.read(6);\r\n    const nuh_layer_id = reader.read(6);\r\n    const nuh_temporal_id_plus1 = reader.read(3);\r\n\r\n    return {\r\n        nal_unit_type,\r\n        nuh_layer_id,\r\n        nuh_temporal_id_plus1,\r\n    };\r\n}\r\n\r\nexport type H265NaluHeader = ReturnType<typeof h265ParseNaluHeader>;\r\n\r\nexport interface H265NaluRaw extends H265NaluHeader {\r\n    data: Uint8Array;\r\n    rbsp: Uint8Array;\r\n}\r\n\r\n/**\r\n * 7.3.2.1 Video parameter set RBSP syntax\r\n */\r\nexport function h265ParseVideoParameterSet(nalu: Uint8Array) {\r\n    const reader = new NaluSodbBitReader(nalu);\r\n\r\n    const vps_video_parameter_set_id = reader.read(4);\r\n    const vps_base_layer_internal_flag = !!reader.next();\r\n    const vps_base_layer_available_flag = !!reader.next();\r\n    const vps_max_layers_minus1 = reader.read(6);\r\n    const vps_max_sub_layers_minus1 = reader.read(3);\r\n    const vps_temporal_id_nesting_flag = !!reader.next();\r\n    reader.skip(16);\r\n\r\n    const profileTierLevel = h265ParseProfileTierLevel(\r\n        reader,\r\n        true,\r\n        vps_max_sub_layers_minus1\r\n    );\r\n\r\n    const vps_sub_layer_ordering_info_present_flag = !!reader.next();\r\n    const vps_max_dec_pic_buffering_minus1: number[] = [];\r\n    const vps_max_num_reorder_pics: number[] = [];\r\n    const vps_max_latency_increase_plus1: number[] = [];\r\n    for (\r\n        let i = vps_sub_layer_ordering_info_present_flag\r\n            ? 0\r\n            : vps_max_sub_layers_minus1;\r\n        i <= vps_max_sub_layers_minus1;\r\n        i += 1\r\n    ) {\r\n        vps_max_dec_pic_buffering_minus1[i] =\r\n            reader.decodeExponentialGolombNumber();\r\n        vps_max_num_reorder_pics[i] = reader.decodeExponentialGolombNumber();\r\n        vps_max_latency_increase_plus1[i] =\r\n            reader.decodeExponentialGolombNumber();\r\n    }\r\n\r\n    const vps_max_layer_id = reader.read(6);\r\n    const vps_num_layer_sets_minus1 = reader.decodeExponentialGolombNumber();\r\n    const layer_id_included_flag: boolean[][] = [];\r\n    for (let i = 1; i <= vps_num_layer_sets_minus1; i += 1) {\r\n        layer_id_included_flag[i] = [];\r\n        for (let j = 0; j <= vps_max_layer_id; j += 1) {\r\n            layer_id_included_flag[i]![j] = !!reader.next();\r\n        }\r\n    }\r\n\r\n    const vps_timing_info_present_flag = !!reader.next();\r\n    let vps_num_units_in_tick: number | undefined;\r\n    let vps_time_scale: number | undefined;\r\n    let vps_poc_proportional_to_timing_flag: boolean | undefined;\r\n    let vps_num_ticks_poc_diff_one_minus1: number | undefined;\r\n    let vps_num_hrd_parameters: number | undefined;\r\n    let hrd_layer_set_idx: number[] | undefined;\r\n    let cprms_present_flag: boolean[] | undefined;\r\n    let hrdParameters: H265HrdParameters[] | undefined;\r\n    if (vps_timing_info_present_flag) {\r\n        vps_num_units_in_tick = reader.read(32);\r\n        vps_time_scale = reader.read(32);\r\n\r\n        vps_poc_proportional_to_timing_flag = !!reader.next();\r\n        if (vps_poc_proportional_to_timing_flag) {\r\n            vps_num_ticks_poc_diff_one_minus1 =\r\n                reader.decodeExponentialGolombNumber();\r\n        }\r\n\r\n        vps_num_hrd_parameters = reader.decodeExponentialGolombNumber();\r\n\r\n        hrd_layer_set_idx = [];\r\n        cprms_present_flag = [true];\r\n        hrdParameters = [];\r\n        for (let i = 0; i < vps_num_hrd_parameters; i += 1) {\r\n            hrd_layer_set_idx[i] = reader.decodeExponentialGolombNumber();\r\n            if (i > 0) {\r\n                cprms_present_flag[i] = !!reader.next();\r\n            }\r\n            hrdParameters[i] = h265ParseHrdParameters(\r\n                reader,\r\n                cprms_present_flag[i]!,\r\n                vps_max_sub_layers_minus1\r\n            );\r\n        }\r\n    }\r\n\r\n    const vps_extension_flag = !!reader.next();\r\n\r\n    return {\r\n        vps_video_parameter_set_id,\r\n        vps_base_layer_internal_flag,\r\n        vps_base_layer_available_flag,\r\n        vps_max_layers_minus1,\r\n        vps_max_sub_layers_minus1,\r\n        vps_temporal_id_nesting_flag,\r\n        profileTierLevel,\r\n        vps_sub_layer_ordering_info_present_flag,\r\n        vps_max_dec_pic_buffering_minus1,\r\n        vps_max_num_reorder_pics,\r\n        vps_max_latency_increase_plus1,\r\n        vps_max_layer_id,\r\n        vps_num_layer_sets_minus1,\r\n        layer_id_included_flag,\r\n        vps_timing_info_present_flag,\r\n        vps_num_units_in_tick,\r\n        vps_time_scale,\r\n        vps_poc_proportional_to_timing_flag,\r\n        vps_num_ticks_poc_diff_one_minus1,\r\n        vps_num_hrd_parameters,\r\n        hrd_layer_set_idx,\r\n        cprms_present_flag,\r\n        hrdParameters,\r\n        vps_extension_flag,\r\n    };\r\n}\r\n\r\nexport type SubLayerHrdParameters = ReturnType<\r\n    typeof h265ParseSubLayerHrdParameters\r\n>;\r\n\r\n/**\r\n * 7.3.2.2.1 General sequence parameter set RBSP syntax\r\n */\r\nexport function h265ParseSequenceParameterSet(nalu: Uint8Array) {\r\n    const reader = new NaluSodbBitReader(nalu);\r\n\r\n    const sps_video_parameter_set_id = reader.read(4);\r\n    const sps_max_sub_layers_minus1 = reader.read(3);\r\n    const sps_temporal_id_nesting_flag = !!reader.next();\r\n\r\n    const profileTierLevel = h265ParseProfileTierLevel(\r\n        reader,\r\n        true,\r\n        sps_max_sub_layers_minus1\r\n    );\r\n\r\n    const sps_seq_parameter_set_id = reader.decodeExponentialGolombNumber();\r\n    const chroma_format_idc = reader.decodeExponentialGolombNumber();\r\n    let separate_colour_plane_flag: boolean | undefined;\r\n    if (chroma_format_idc === 3) {\r\n        separate_colour_plane_flag = !!reader.next();\r\n    }\r\n\r\n    const pic_width_in_luma_samples = reader.decodeExponentialGolombNumber();\r\n    const pic_height_in_luma_samples = reader.decodeExponentialGolombNumber();\r\n\r\n    const conformance_window_flag = !!reader.next();\r\n    let conf_win_left_offset: number | undefined;\r\n    let conf_win_right_offset: number | undefined;\r\n    let conf_win_top_offset: number | undefined;\r\n    let conf_win_bottom_offset: number | undefined;\r\n    if (conformance_window_flag) {\r\n        conf_win_left_offset = reader.decodeExponentialGolombNumber();\r\n        conf_win_right_offset = reader.decodeExponentialGolombNumber();\r\n        conf_win_top_offset = reader.decodeExponentialGolombNumber();\r\n        conf_win_bottom_offset = reader.decodeExponentialGolombNumber();\r\n    }\r\n\r\n    const bit_depth_luma_minus8 = reader.decodeExponentialGolombNumber();\r\n    const bit_depth_chroma_minus8 = reader.decodeExponentialGolombNumber();\r\n    const log2_max_pic_order_cnt_lsb_minus4 =\r\n        reader.decodeExponentialGolombNumber();\r\n\r\n    let sps_max_dec_pic_buffering_minus1: number[] | undefined;\r\n    let sps_max_num_reorder_pics: number[] | undefined;\r\n    let sps_max_latency_increase_plus1: number[] | undefined;\r\n    const sps_sub_layer_ordering_info_present_flag = !!reader.next();\r\n    for (\r\n        let i = sps_sub_layer_ordering_info_present_flag\r\n            ? 0\r\n            : sps_max_sub_layers_minus1;\r\n        i <= sps_max_sub_layers_minus1;\r\n        i += 1\r\n    ) {\r\n        sps_max_dec_pic_buffering_minus1 = [];\r\n        sps_max_num_reorder_pics = [];\r\n        sps_max_latency_increase_plus1 = [];\r\n        for (let i = 0; i <= sps_max_sub_layers_minus1; i += 1) {\r\n            sps_max_dec_pic_buffering_minus1[i] =\r\n                reader.decodeExponentialGolombNumber();\r\n            sps_max_num_reorder_pics[i] =\r\n                reader.decodeExponentialGolombNumber();\r\n            sps_max_latency_increase_plus1[i] =\r\n                reader.decodeExponentialGolombNumber();\r\n        }\r\n    }\r\n\r\n    const log2_min_luma_coding_block_size_minus3 =\r\n        reader.decodeExponentialGolombNumber();\r\n    const log2_diff_max_min_luma_coding_block_size =\r\n        reader.decodeExponentialGolombNumber();\r\n    const log2_min_luma_transform_block_size_minus2 =\r\n        reader.decodeExponentialGolombNumber();\r\n    const log2_diff_max_min_luma_transform_block_size =\r\n        reader.decodeExponentialGolombNumber();\r\n    const max_transform_hierarchy_depth_inter =\r\n        reader.decodeExponentialGolombNumber();\r\n    const max_transform_hierarchy_depth_intra =\r\n        reader.decodeExponentialGolombNumber();\r\n\r\n    const scaling_list_enabled_flag = !!reader.next();\r\n    let sps_scaling_list_data_present_flag: boolean | undefined;\r\n    let scalingListData: number[][][] | undefined;\r\n    if (scaling_list_enabled_flag) {\r\n        sps_scaling_list_data_present_flag = !!reader.next();\r\n        if (sps_scaling_list_data_present_flag) {\r\n            scalingListData = h265ParseScalingListData(reader);\r\n        }\r\n    }\r\n\r\n    const amp_enabled_flag = !!reader.next();\r\n    const sample_adaptive_offset_enabled_flag = !!reader.next();\r\n    const pcm_enabled_flag = !!reader.next();\r\n    let pcm_sample_bit_depth_luma_minus1: number | undefined;\r\n    let pcm_sample_bit_depth_chroma_minus1: number | undefined;\r\n    let log2_min_pcm_luma_coding_block_size_minus3: number | undefined;\r\n    let log2_diff_max_min_pcm_luma_coding_block_size: number | undefined;\r\n    let pcm_loop_filter_disabled_flag: boolean | undefined;\r\n    if (pcm_enabled_flag) {\r\n        pcm_sample_bit_depth_luma_minus1 = reader.read(4);\r\n        pcm_sample_bit_depth_chroma_minus1 = reader.read(4);\r\n        log2_min_pcm_luma_coding_block_size_minus3 = reader.read(4);\r\n        log2_diff_max_min_pcm_luma_coding_block_size = reader.read(4);\r\n        pcm_loop_filter_disabled_flag = !!reader.next();\r\n    }\r\n\r\n    const num_short_term_ref_pic_sets = reader.decodeExponentialGolombNumber();\r\n    const shortTermRefPicSets: ShortTermReferencePictureSet[] = [];\r\n    for (let i = 0; i < num_short_term_ref_pic_sets; i += 1) {\r\n        shortTermRefPicSets[i] = h265ParseShortTermReferencePictureSet(\r\n            reader,\r\n            i,\r\n            num_short_term_ref_pic_sets,\r\n            shortTermRefPicSets\r\n        );\r\n    }\r\n\r\n    const long_term_ref_pics_present_flag = !!reader.next();\r\n    let num_long_term_ref_pics_sps: number | undefined;\r\n    let lt_ref_pic_poc_lsb_sps: number[] | undefined;\r\n    let used_by_curr_pic_lt_sps_flag: boolean[] | undefined;\r\n    if (long_term_ref_pics_present_flag) {\r\n        num_long_term_ref_pics_sps = reader.decodeExponentialGolombNumber();\r\n        lt_ref_pic_poc_lsb_sps = [];\r\n        used_by_curr_pic_lt_sps_flag = [];\r\n        for (let i = 0; i < num_long_term_ref_pics_sps; i += 1) {\r\n            lt_ref_pic_poc_lsb_sps[i] = reader.read(\r\n                log2_max_pic_order_cnt_lsb_minus4 + 4\r\n            );\r\n            used_by_curr_pic_lt_sps_flag[i] = !!reader.next();\r\n        }\r\n    }\r\n\r\n    const sps_temporal_mvp_enabled_flag = !!reader.next();\r\n    const strong_intra_smoothing_enabled_flag = !!reader.next();\r\n    const vui_parameters_present_flag = !!reader.next();\r\n    let vuiParameters: H265VuiParameters | undefined;\r\n    if (vui_parameters_present_flag) {\r\n        vuiParameters = h265ParseVuiParameters(reader);\r\n    }\r\n\r\n    const sps_extension_present_flag = !!reader.next();\r\n    let sps_range_extension_flag: boolean | undefined;\r\n    let sps_multilayer_extension_flag: boolean | undefined;\r\n    let sps_3d_extension_flag: boolean | undefined;\r\n    let sps_scc_extension_flag: boolean | undefined;\r\n    let sps_extension_4bits: number | undefined;\r\n    if (sps_extension_present_flag) {\r\n        sps_range_extension_flag = !!reader.next();\r\n        sps_multilayer_extension_flag = !!reader.next();\r\n        sps_3d_extension_flag = !!reader.next();\r\n        sps_scc_extension_flag = !!reader.next();\r\n        sps_extension_4bits = reader.read(4);\r\n    }\r\n\r\n    if (sps_range_extension_flag) {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n\r\n    let spsMultilayerExtension: H265SpsMultilayerExtension | undefined;\r\n    if (sps_multilayer_extension_flag) {\r\n        spsMultilayerExtension = h265ParseSpsMultilayerExtension(reader);\r\n    }\r\n\r\n    let sps3dExtension: H265Sps3dExtension | undefined;\r\n    if (sps_3d_extension_flag) {\r\n        sps3dExtension = h265ParseSps3dExtension(reader);\r\n    }\r\n\r\n    if (sps_scc_extension_flag) {\r\n        throw new Error(\"Not implemented\");\r\n    }\r\n\r\n    let sps_extension_data_flag: boolean[] | undefined;\r\n    if (sps_extension_4bits) {\r\n        sps_extension_data_flag = [];\r\n        let i = 0;\r\n        while (!reader.ended) {\r\n            sps_extension_data_flag[i] = !!reader.next();\r\n            i += 1;\r\n        }\r\n    }\r\n\r\n    return {\r\n        sps_video_parameter_set_id,\r\n        sps_max_sub_layers_minus1,\r\n        sps_temporal_id_nesting_flag,\r\n        profileTierLevel,\r\n        sps_seq_parameter_set_id,\r\n        chroma_format_idc,\r\n        separate_colour_plane_flag,\r\n        pic_width_in_luma_samples,\r\n        pic_height_in_luma_samples,\r\n        conformance_window_flag,\r\n        conf_win_left_offset,\r\n        conf_win_right_offset,\r\n        conf_win_top_offset,\r\n        conf_win_bottom_offset,\r\n        bit_depth_luma_minus8,\r\n        bit_depth_chroma_minus8,\r\n        log2_max_pic_order_cnt_lsb_minus4,\r\n        sps_sub_layer_ordering_info_present_flag,\r\n        sps_max_dec_pic_buffering_minus1,\r\n        sps_max_num_reorder_pics,\r\n        sps_max_latency_increase_plus1,\r\n        log2_min_luma_coding_block_size_minus3,\r\n        log2_diff_max_min_luma_coding_block_size,\r\n        log2_min_luma_transform_block_size_minus2,\r\n        log2_diff_max_min_luma_transform_block_size,\r\n        max_transform_hierarchy_depth_inter,\r\n        max_transform_hierarchy_depth_intra,\r\n        scaling_list_enabled_flag,\r\n        sps_scaling_list_data_present_flag,\r\n        scalingListData,\r\n        amp_enabled_flag,\r\n        sample_adaptive_offset_enabled_flag,\r\n        pcm_enabled_flag,\r\n        pcm_sample_bit_depth_luma_minus1,\r\n        pcm_sample_bit_depth_chroma_minus1,\r\n        log2_min_pcm_luma_coding_block_size_minus3,\r\n        log2_diff_max_min_pcm_luma_coding_block_size,\r\n        pcm_loop_filter_disabled_flag,\r\n        num_short_term_ref_pic_sets,\r\n        shortTermRefPicSets,\r\n        long_term_ref_pics_present_flag,\r\n        num_long_term_ref_pics_sps,\r\n        lt_ref_pic_poc_lsb_sps,\r\n        used_by_curr_pic_lt_sps_flag,\r\n        sps_temporal_mvp_enabled_flag,\r\n        strong_intra_smoothing_enabled_flag,\r\n        vui_parameters_present_flag,\r\n        vuiParameters,\r\n        sps_extension_present_flag,\r\n        sps_range_extension_flag,\r\n        sps_multilayer_extension_flag,\r\n        sps_3d_extension_flag,\r\n        sps_scc_extension_flag,\r\n        sps_extension_4bits,\r\n        spsMultilayerExtension,\r\n        sps3dExtension,\r\n        sps_extension_data_flag,\r\n    };\r\n}\r\n\r\n/**\r\n * 7.3.3 Profile, tier and level syntax\r\n *\r\n * Common part between general_profile_tier_level and\r\n * sub_layer_profile_tier_level\r\n */\r\nfunction h265ParseProfileTier(reader: NaluSodbBitReader) {\r\n    const profile_space = reader.read(2);\r\n    const tier_flag = !!reader.next();\r\n    const profile_idc = reader.read(5);\r\n\r\n    const profileCompatibilitySet = reader.peekBytes(4);\r\n    const profile_compatibility_flag: boolean[] = [];\r\n    for (let j = 0; j < 32; j += 1) {\r\n        profile_compatibility_flag[j] = !!reader.next();\r\n    }\r\n\r\n    const constraintSet = reader.peekBytes(6);\r\n\r\n    const progressive_source_flag = !!reader.next();\r\n    const interlaced_source_flag = !!reader.next();\r\n    const non_packed_constraint_flag = !!reader.next();\r\n    const frame_only_constraint_flag = !!reader.next();\r\n\r\n    let max_12bit_constraint_flag: boolean | undefined;\r\n    let max_10bit_constraint_flag: boolean | undefined;\r\n    let max_8bit_constraint_flag: boolean | undefined;\r\n    let max_422chroma_constraint_flag: boolean | undefined;\r\n    let max_420chroma_constraint_flag: boolean | undefined;\r\n    let max_monochrome_constraint_flag: boolean | undefined;\r\n    let intra_constraint_flag: boolean | undefined;\r\n    let one_picture_only_constraint_flag: boolean | undefined;\r\n    let lower_bit_rate_constraint_flag: boolean | undefined;\r\n    let max_14bit_constraint_flag: boolean | undefined;\r\n    if (\r\n        profile_idc === 4 ||\r\n        profile_compatibility_flag[4] ||\r\n        profile_idc === 5 ||\r\n        profile_compatibility_flag[5] ||\r\n        profile_idc === 6 ||\r\n        profile_compatibility_flag[6] ||\r\n        profile_idc === 7 ||\r\n        profile_compatibility_flag[7] ||\r\n        profile_idc === 8 ||\r\n        profile_compatibility_flag[8] ||\r\n        profile_idc === 9 ||\r\n        profile_compatibility_flag[9] ||\r\n        profile_idc === 10 ||\r\n        profile_compatibility_flag[10] ||\r\n        profile_idc === 11 ||\r\n        profile_compatibility_flag[11]\r\n    ) {\r\n        max_12bit_constraint_flag = !!reader.next();\r\n        max_10bit_constraint_flag = !!reader.next();\r\n        max_8bit_constraint_flag = !!reader.next();\r\n        max_422chroma_constraint_flag = !!reader.next();\r\n        max_420chroma_constraint_flag = !!reader.next();\r\n        max_monochrome_constraint_flag = !!reader.next();\r\n        intra_constraint_flag = !!reader.next();\r\n        one_picture_only_constraint_flag = !!reader.next();\r\n        lower_bit_rate_constraint_flag = !!reader.next();\r\n        if (\r\n            profile_idc === 5 ||\r\n            profile_compatibility_flag[5] ||\r\n            profile_idc === 9 ||\r\n            profile_compatibility_flag[9] ||\r\n            profile_idc === 10 ||\r\n            profile_compatibility_flag[10] ||\r\n            profile_idc === 11 ||\r\n            profile_compatibility_flag[11]\r\n        ) {\r\n            max_14bit_constraint_flag = !!reader.next();\r\n            reader.skip(33);\r\n        } else {\r\n            reader.skip(34);\r\n        }\r\n    } else if (profile_idc === 2 || profile_compatibility_flag[2]) {\r\n        reader.skip(7);\r\n        one_picture_only_constraint_flag = !!reader.next();\r\n        reader.skip(35);\r\n    } else {\r\n        reader.skip(43);\r\n    }\r\n\r\n    let inbld_flag: boolean | undefined;\r\n    if (\r\n        profile_idc === 1 ||\r\n        profile_compatibility_flag[1] ||\r\n        profile_idc === 2 ||\r\n        profile_compatibility_flag[2] ||\r\n        profile_idc === 3 ||\r\n        profile_compatibility_flag[3] ||\r\n        profile_idc === 4 ||\r\n        profile_compatibility_flag[4] ||\r\n        profile_idc === 5 ||\r\n        profile_compatibility_flag[5] ||\r\n        profile_idc === 9 ||\r\n        profile_compatibility_flag[9] ||\r\n        profile_idc === 11 ||\r\n        profile_compatibility_flag[11]\r\n    ) {\r\n        inbld_flag = !!reader.next();\r\n    } else {\r\n        reader.skip(1);\r\n    }\r\n\r\n    return {\r\n        profile_space,\r\n        tier_flag,\r\n        profile_idc,\r\n        profileCompatibilitySet,\r\n        profile_compatibility_flag,\r\n        constraintSet,\r\n        progressive_source_flag,\r\n        interlaced_source_flag,\r\n        non_packed_constraint_flag,\r\n        frame_only_constraint_flag,\r\n        max_12bit_constraint_flag,\r\n        max_10bit_constraint_flag,\r\n        max_8bit_constraint_flag,\r\n        max_422chroma_constraint_flag,\r\n        max_420chroma_constraint_flag,\r\n        max_monochrome_constraint_flag,\r\n        intra_constraint_flag,\r\n        one_picture_only_constraint_flag,\r\n        lower_bit_rate_constraint_flag,\r\n        max_14bit_constraint_flag,\r\n        inbld_flag,\r\n    };\r\n}\r\n\r\nexport type H265ProfileTier = ReturnType<typeof h265ParseProfileTier>;\r\n\r\nexport interface H265ProfileTierLevel {\r\n    generalProfileTier: H265ProfileTier | undefined;\r\n    general_level_idc: number;\r\n    sub_layer_profile_present_flag: boolean[];\r\n    sub_layer_level_present_flag: boolean[];\r\n    subLayerProfileTier: H265ProfileTier[];\r\n    sub_layer_level_idc: number[];\r\n}\r\n\r\n/**\r\n * 7.3.3 Profile, tier and level syntax\r\n */\r\nfunction h265ParseProfileTierLevel(\r\n    reader: NaluSodbBitReader,\r\n    profilePresentFlag: true,\r\n    maxNumSubLayersMinus1: number\r\n): H265ProfileTierLevel & { generalProfileTier: H265ProfileTier };\r\nfunction h265ParseProfileTierLevel(\r\n    reader: NaluSodbBitReader,\r\n    profilePresentFlag: false,\r\n    maxNumSubLayersMinus1: number\r\n): H265ProfileTierLevel & { generalProfileTier: undefined };\r\nfunction h265ParseProfileTierLevel(\r\n    reader: NaluSodbBitReader,\r\n    profilePresentFlag: boolean,\r\n    maxNumSubLayersMinus1: number\r\n): H265ProfileTierLevel;\r\nfunction h265ParseProfileTierLevel(\r\n    reader: NaluSodbBitReader,\r\n    profilePresentFlag: boolean,\r\n    maxNumSubLayersMinus1: number\r\n): H265ProfileTierLevel {\r\n    let generalProfileTier: H265ProfileTier | undefined;\r\n    if (profilePresentFlag) {\r\n        generalProfileTier = h265ParseProfileTier(reader);\r\n    }\r\n\r\n    const general_level_idc = reader.read(8);\r\n\r\n    const sub_layer_profile_present_flag: boolean[] = [];\r\n    const sub_layer_level_present_flag: boolean[] = [];\r\n    for (let i = 0; i < maxNumSubLayersMinus1; i += 1) {\r\n        sub_layer_profile_present_flag[i] = !!reader.next();\r\n        sub_layer_level_present_flag[i] = !!reader.next();\r\n    }\r\n\r\n    if (maxNumSubLayersMinus1 > 0) {\r\n        for (let i = maxNumSubLayersMinus1; i < 8; i += 1) {\r\n            reader.read(2);\r\n        }\r\n    }\r\n\r\n    const subLayerProfileTier: H265ProfileTier[] = [];\r\n    const sub_layer_level_idc: number[] = [];\r\n    for (let i = 0; i < maxNumSubLayersMinus1; i += 1) {\r\n        if (sub_layer_profile_present_flag[i]) {\r\n            subLayerProfileTier[i] = h265ParseProfileTier(reader);\r\n        }\r\n        if (sub_layer_level_present_flag[i]) {\r\n            sub_layer_level_idc[i] = reader.read(8);\r\n        }\r\n    }\r\n\r\n    return {\r\n        generalProfileTier,\r\n        general_level_idc,\r\n        sub_layer_profile_present_flag,\r\n        sub_layer_level_present_flag,\r\n        subLayerProfileTier,\r\n        sub_layer_level_idc,\r\n    };\r\n}\r\n\r\n/**\r\n * 7.3.4 Scaling list data syntax\r\n */\r\nexport function h265ParseScalingListData(reader: NaluSodbBitReader) {\r\n    const scaling_list: number[][][] = [];\r\n    for (let sizeId = 0; sizeId < 4; sizeId += 1) {\r\n        scaling_list[sizeId] = [];\r\n        for (let matrixId = 0; matrixId < 6; matrixId += sizeId === 3 ? 3 : 1) {\r\n            const scaling_list_pred_mode_flag = !!reader.next();\r\n            if (!scaling_list_pred_mode_flag) {\r\n                reader.decodeExponentialGolombNumber();\r\n            } else {\r\n                let nextCoef = 8;\r\n                const coefNum = Math.min(64, 1 << (4 + (sizeId << 1)));\r\n                if (sizeId > 1) {\r\n                    const scaling_list_dc_coef_minus8 =\r\n                        reader.decodeExponentialGolombNumber();\r\n                    nextCoef = scaling_list_dc_coef_minus8 + 8;\r\n                }\r\n                scaling_list[sizeId]![matrixId] = [];\r\n                for (let i = 0; i < coefNum; i += 1) {\r\n                    const scaling_list_delta_coef =\r\n                        reader.decodeExponentialGolombNumber();\r\n                    nextCoef = (nextCoef + scaling_list_delta_coef + 256) % 256;\r\n                    scaling_list[sizeId]![matrixId]![i] = nextCoef;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return scaling_list;\r\n}\r\n\r\ninterface ShortTermReferencePictureSet {\r\n    stRpsIdx: number;\r\n    num_short_term_ref_pic_sets: number;\r\n\r\n    inter_ref_pic_set_prediction_flag: boolean;\r\n    delta_idx_minus1: number;\r\n    delta_rps_sign: boolean;\r\n    abs_delta_rps_minus1: number;\r\n    used_by_curr_pic_flag: boolean[];\r\n    use_delta_flag: boolean[];\r\n    num_negative_pics: number;\r\n    num_positive_pics: number;\r\n    delta_poc_s0_minus1: number[];\r\n    used_by_curr_pic_s0_flag: boolean[];\r\n    delta_poc_s1_minus1: number[];\r\n    used_by_curr_pic_s1_flag: boolean[];\r\n}\r\n\r\n/**\r\n * 7.3.7 Short-term reference picture set syntax\r\n */\r\nexport function h265ParseShortTermReferencePictureSet(\r\n    reader: NaluSodbBitReader,\r\n    stRpsIdx: number,\r\n    num_short_term_ref_pic_sets: number,\r\n    sets: ShortTermReferencePictureSet[]\r\n): ShortTermReferencePictureSet {\r\n    let inter_ref_pic_set_prediction_flag = false;\r\n    if (stRpsIdx !== 0) {\r\n        inter_ref_pic_set_prediction_flag = !!reader.next();\r\n    }\r\n    let delta_idx_minus1 = 0;\r\n    let delta_rps_sign = false;\r\n    let abs_delta_rps_minus1 = 0;\r\n    const used_by_curr_pic_flag: boolean[] = [];\r\n    const use_delta_flag: boolean[] = [];\r\n    let num_negative_pics = 0;\r\n    let num_positive_pics = 0;\r\n    const delta_poc_s0_minus1: number[] = [];\r\n    const used_by_curr_pic_s0_flag: boolean[] = [];\r\n    const delta_poc_s1_minus1: number[] = [];\r\n    const used_by_curr_pic_s1_flag: boolean[] = [];\r\n    if (inter_ref_pic_set_prediction_flag) {\r\n        if (stRpsIdx === num_short_term_ref_pic_sets) {\r\n            delta_idx_minus1 = reader.decodeExponentialGolombNumber();\r\n        }\r\n        delta_rps_sign = !!reader.next();\r\n        abs_delta_rps_minus1 = reader.decodeExponentialGolombNumber();\r\n        const RefRpsIdx = stRpsIdx - (delta_idx_minus1 + 1);\r\n        const RefRps = sets[RefRpsIdx]!;\r\n        const NumDeltaPocs_RefRpsIdx =\r\n            RefRps.num_negative_pics + RefRps.num_positive_pics;\r\n        for (let j = 0; j <= NumDeltaPocs_RefRpsIdx; j += 1) {\r\n            used_by_curr_pic_flag[j] = !!reader.next();\r\n            if (!used_by_curr_pic_flag[j]!) {\r\n                use_delta_flag[j] = !!reader.next();\r\n            } else {\r\n                use_delta_flag[j] = true;\r\n            }\r\n        }\r\n\r\n        const DeltaRps =\r\n            (1 - 2 * Number(delta_rps_sign)) * (abs_delta_rps_minus1 + 1);\r\n\r\n        const RefPocS0: number[] = [];\r\n        const RefPocS1: number[] = [];\r\n        const pocS0: number[] = [];\r\n        const pocS1: number[] = [];\r\n\r\n        let dPoc = 0;\r\n        for (let i = 0; i < RefRps.num_negative_pics; i += 1) {\r\n            dPoc -= RefRps.delta_poc_s0_minus1[i]! + 1;\r\n            RefPocS0[i] = dPoc;\r\n        }\r\n        dPoc = 0;\r\n        for (let i = 0; i < RefRps.num_positive_pics; i += 1) {\r\n            dPoc += RefRps.delta_poc_s1_minus1[i]! + 1;\r\n            RefPocS1[i] = dPoc;\r\n        }\r\n\r\n        let i = 0;\r\n        if (RefRps.num_positive_pics > 0) {\r\n            for (let j = RefRps.num_positive_pics - 1; j >= 0; j -= 1) {\r\n                dPoc = RefPocS1[j]! + DeltaRps;\r\n                if (dPoc < 0 && use_delta_flag[RefRps.num_negative_pics + j]) {\r\n                    pocS0[i] = dPoc;\r\n                    used_by_curr_pic_s0_flag[i] =\r\n                        used_by_curr_pic_flag[RefRps.num_negative_pics + j]!;\r\n                    i += 1;\r\n                }\r\n            }\r\n        }\r\n        if (DeltaRps < 0 && use_delta_flag[NumDeltaPocs_RefRpsIdx]) {\r\n            pocS0[i] = DeltaRps;\r\n            used_by_curr_pic_s0_flag[i] =\r\n                used_by_curr_pic_flag[NumDeltaPocs_RefRpsIdx]!;\r\n            i += 1;\r\n        }\r\n        for (let j = 0; j < RefRps.num_negative_pics; j += 1) {\r\n            dPoc = RefPocS0[j]! + DeltaRps;\r\n            if (dPoc < 0 && use_delta_flag[j]) {\r\n                pocS0[i] = dPoc;\r\n                used_by_curr_pic_s0_flag[i] = used_by_curr_pic_flag[j]!;\r\n                i += 1;\r\n            }\r\n        }\r\n\r\n        num_negative_pics = i;\r\n        let prev = 0;\r\n        for (i = 0; i < num_negative_pics; i += 1) {\r\n            const current = pocS0[i]!;\r\n            delta_poc_s0_minus1[i] = -(current - prev - 1);\r\n            prev = current;\r\n        }\r\n\r\n        i = 0;\r\n        if (RefRps.num_negative_pics > 0) {\r\n            for (let j = RefRps.num_negative_pics - 1; j >= 0; j -= 1) {\r\n                dPoc = RefPocS0[j]! + DeltaRps;\r\n                if (dPoc > 0 && use_delta_flag[j]) {\r\n                    pocS1[i] = dPoc;\r\n                    used_by_curr_pic_s1_flag[i] = used_by_curr_pic_flag[j]!;\r\n                    i += 1;\r\n                }\r\n            }\r\n        }\r\n        if (DeltaRps > 0 && use_delta_flag[NumDeltaPocs_RefRpsIdx]) {\r\n            pocS1[i] = DeltaRps;\r\n            used_by_curr_pic_s1_flag[i] =\r\n                used_by_curr_pic_flag[NumDeltaPocs_RefRpsIdx]!;\r\n            i += 1;\r\n        }\r\n        for (let j = 0; j < RefRps.num_positive_pics; j += 1) {\r\n            dPoc = RefPocS1[j]! + DeltaRps;\r\n            if (dPoc > 0 && use_delta_flag[RefRps.num_negative_pics + j]) {\r\n                pocS1[i] = dPoc;\r\n                used_by_curr_pic_s1_flag[i] =\r\n                    used_by_curr_pic_flag[RefRps.num_negative_pics + j]!;\r\n                i += 1;\r\n            }\r\n        }\r\n\r\n        num_positive_pics = i;\r\n        prev = 0;\r\n        for (i = 0; i < num_positive_pics; i += 1) {\r\n            const current = pocS1[i]!;\r\n            delta_poc_s1_minus1[i] = current - prev - 1;\r\n            prev = current;\r\n        }\r\n    } else {\r\n        num_negative_pics = reader.decodeExponentialGolombNumber();\r\n        num_positive_pics = reader.decodeExponentialGolombNumber();\r\n        for (let i = 0; i < num_negative_pics; i += 1) {\r\n            delta_poc_s0_minus1[i] = reader.decodeExponentialGolombNumber();\r\n            used_by_curr_pic_s0_flag[i] = !!reader.next();\r\n        }\r\n        for (let i = 0; i < num_positive_pics; i += 1) {\r\n            delta_poc_s1_minus1[i] = reader.decodeExponentialGolombNumber();\r\n            used_by_curr_pic_s1_flag[i] = !!reader.next();\r\n        }\r\n    }\r\n\r\n    return {\r\n        stRpsIdx,\r\n        num_short_term_ref_pic_sets,\r\n        inter_ref_pic_set_prediction_flag,\r\n        delta_idx_minus1,\r\n        delta_rps_sign,\r\n        abs_delta_rps_minus1,\r\n        used_by_curr_pic_flag,\r\n        use_delta_flag,\r\n        num_negative_pics,\r\n        num_positive_pics,\r\n        delta_poc_s0_minus1,\r\n        used_by_curr_pic_s0_flag,\r\n        delta_poc_s1_minus1,\r\n        used_by_curr_pic_s1_flag,\r\n    };\r\n}\r\n\r\n/**\r\n * E.2.1 VUI parameters syntax\r\n */\r\nexport function h265ParseVuiParameters(reader: NaluSodbBitReader) {\r\n    const aspect_ratio_info_present_flag = !!reader.next();\r\n    let aspect_ratio_idc: number | undefined;\r\n    let sar_width: number | undefined;\r\n    let sar_height: number | undefined;\r\n    if (aspect_ratio_info_present_flag) {\r\n        aspect_ratio_idc = reader.read(8);\r\n        if (aspect_ratio_idc === 255) {\r\n            sar_width = reader.read(16);\r\n            sar_height = reader.read(16);\r\n        }\r\n    }\r\n\r\n    const overscan_info_present_flag = !!reader.next();\r\n    let overscan_appropriate_flag: boolean | undefined;\r\n    if (overscan_info_present_flag) {\r\n        overscan_appropriate_flag = !!reader.next();\r\n    }\r\n\r\n    const video_signal_type_present_flag = !!reader.next();\r\n    let video_format: number | undefined;\r\n    let video_full_range_flag: boolean | undefined;\r\n    let colour_description_present_flag: boolean | undefined;\r\n    let colour_primaries: number | undefined;\r\n    let transfer_characteristics: number | undefined;\r\n    let matrix_coeffs: number | undefined;\r\n    if (video_signal_type_present_flag) {\r\n        video_format = reader.read(3);\r\n        video_full_range_flag = !!reader.next();\r\n        colour_description_present_flag = !!reader.next();\r\n        if (colour_description_present_flag) {\r\n            colour_primaries = reader.read(8);\r\n            transfer_characteristics = reader.read(8);\r\n            matrix_coeffs = reader.read(8);\r\n        }\r\n    }\r\n\r\n    const chroma_loc_info_present_flag = !!reader.next();\r\n    let chroma_sample_loc_type_top_field: number | undefined;\r\n    let chroma_sample_loc_type_bottom_field: number | undefined;\r\n    if (chroma_loc_info_present_flag) {\r\n        chroma_sample_loc_type_top_field =\r\n            reader.decodeExponentialGolombNumber();\r\n        chroma_sample_loc_type_bottom_field =\r\n            reader.decodeExponentialGolombNumber();\r\n    }\r\n\r\n    const neutral_chroma_indication_flag = !!reader.next();\r\n    const field_seq_flag = !!reader.next();\r\n    const frame_field_info_present_flag = !!reader.next();\r\n\r\n    const default_display_window_flag = !!reader.next();\r\n    let def_disp_win_left_offset: number | undefined;\r\n    let def_disp_win_right_offset: number | undefined;\r\n    let def_disp_win_top_offset: number | undefined;\r\n    let def_disp_win_bottom_offset: number | undefined;\r\n    if (default_display_window_flag) {\r\n        def_disp_win_left_offset = reader.decodeExponentialGolombNumber();\r\n        def_disp_win_right_offset = reader.decodeExponentialGolombNumber();\r\n        def_disp_win_top_offset = reader.decodeExponentialGolombNumber();\r\n        def_disp_win_bottom_offset = reader.decodeExponentialGolombNumber();\r\n    }\r\n\r\n    const vui_timing_info_present_flag = !!reader.next();\r\n    let vui_num_units_in_tick: number | undefined;\r\n    let vui_time_scale: number | undefined;\r\n    let vui_poc_proportional_to_timing_flag: boolean | undefined;\r\n    let vui_num_ticks_poc_diff_one_minus1: number | undefined;\r\n    let vui_hrd_parameters_present_flag: boolean | undefined;\r\n    if (vui_timing_info_present_flag) {\r\n        vui_num_units_in_tick = reader.read(32);\r\n        vui_time_scale = reader.read(32);\r\n        vui_poc_proportional_to_timing_flag = !!reader.next();\r\n        if (vui_poc_proportional_to_timing_flag) {\r\n            vui_num_ticks_poc_diff_one_minus1 =\r\n                reader.decodeExponentialGolombNumber();\r\n        }\r\n        vui_hrd_parameters_present_flag = !!reader.next();\r\n        if (vui_hrd_parameters_present_flag) {\r\n            throw new Error(\"Not implemented\");\r\n        }\r\n    }\r\n\r\n    const bitstream_restriction_flag = !!reader.next();\r\n    let tiles_fixed_structure_flag: boolean | undefined;\r\n    let motion_vectors_over_pic_boundaries_flag: boolean | undefined;\r\n    let restricted_ref_pic_lists_flag: boolean | undefined;\r\n    let min_spatial_segmentation_idc: number | undefined;\r\n    let max_bytes_per_pic_denom: number | undefined;\r\n    let max_bits_per_min_cu_denom: number | undefined;\r\n    let log2_max_mv_length_horizontal: number | undefined;\r\n    let log2_max_mv_length_vertical: number | undefined;\r\n    if (bitstream_restriction_flag) {\r\n        tiles_fixed_structure_flag = !!reader.next();\r\n        motion_vectors_over_pic_boundaries_flag = !!reader.next();\r\n        restricted_ref_pic_lists_flag = !!reader.next();\r\n        min_spatial_segmentation_idc = reader.decodeExponentialGolombNumber();\r\n        max_bytes_per_pic_denom = reader.decodeExponentialGolombNumber();\r\n        max_bits_per_min_cu_denom = reader.decodeExponentialGolombNumber();\r\n        log2_max_mv_length_horizontal = reader.decodeExponentialGolombNumber();\r\n        log2_max_mv_length_vertical = reader.decodeExponentialGolombNumber();\r\n    }\r\n\r\n    return {\r\n        aspect_ratio_info_present_flag,\r\n        aspect_ratio_idc,\r\n        sar_width,\r\n        sar_height,\r\n\r\n        overscan_info_present_flag,\r\n        overscan_appropriate_flag,\r\n\r\n        video_signal_type_present_flag,\r\n        video_format,\r\n        video_full_range_flag,\r\n        colour_description_present_flag,\r\n        colour_primaries,\r\n        transfer_characteristics,\r\n        matrix_coeffs,\r\n\r\n        chroma_loc_info_present_flag,\r\n        chroma_sample_loc_type_top_field,\r\n        chroma_sample_loc_type_bottom_field,\r\n\r\n        neutral_chroma_indication_flag,\r\n        field_seq_flag,\r\n        frame_field_info_present_flag,\r\n\r\n        default_display_window_flag,\r\n        def_disp_win_left_offset,\r\n        def_disp_win_right_offset,\r\n        def_disp_win_top_offset,\r\n        def_disp_win_bottom_offset,\r\n\r\n        vui_timing_info_present_flag,\r\n        vui_num_units_in_tick,\r\n        vui_time_scale,\r\n        vui_poc_proportional_to_timing_flag,\r\n        vui_num_ticks_poc_diff_one_minus1,\r\n        vui_hrd_parameters_present_flag,\r\n\r\n        bitstream_restriction_flag,\r\n        tiles_fixed_structure_flag,\r\n        motion_vectors_over_pic_boundaries_flag,\r\n        restricted_ref_pic_lists_flag,\r\n        min_spatial_segmentation_idc,\r\n        max_bytes_per_pic_denom,\r\n        max_bits_per_min_cu_denom,\r\n        log2_max_mv_length_horizontal,\r\n        log2_max_mv_length_vertical,\r\n    };\r\n}\r\n\r\nexport type H265VuiParameters = ReturnType<typeof h265ParseVuiParameters>;\r\n\r\n/**\r\n * E.2.2 HRD parameters syntax\r\n */\r\nexport function h265ParseHrdParameters(\r\n    reader: NaluSodbBitReader,\r\n    commonInfPresentFlag: boolean,\r\n    maxNumSubLayersMinus1: number\r\n) {\r\n    let nal_hrd_parameters_present_flag: boolean | undefined;\r\n    let vcl_hrd_parameters_present_flag: boolean | undefined;\r\n    let sub_pic_hrd_params_present_flag: boolean | undefined;\r\n    let tick_divisor_minus2: number | undefined;\r\n    let du_cpb_removal_delay_increment_length_minus1: number | undefined;\r\n    let sub_pic_cpb_params_in_pic_timing_sei_flag: boolean | undefined;\r\n    let dpb_output_delay_du_length_minus1: number | undefined;\r\n    let bit_rate_scale: number | undefined;\r\n    let cpb_size_scale: number | undefined;\r\n    let cpb_size_du_scale: number | undefined;\r\n    let initial_cpb_removal_delay_length_minus1: number | undefined;\r\n    let au_cpb_removal_delay_length_minus1: number | undefined;\r\n    let dpb_output_delay_length_minus1: number | undefined;\r\n    if (commonInfPresentFlag) {\r\n        nal_hrd_parameters_present_flag = !!reader.next();\r\n        vcl_hrd_parameters_present_flag = !!reader.next();\r\n        if (\r\n            nal_hrd_parameters_present_flag ||\r\n            vcl_hrd_parameters_present_flag\r\n        ) {\r\n            sub_pic_hrd_params_present_flag = !!reader.next();\r\n            if (sub_pic_hrd_params_present_flag) {\r\n                tick_divisor_minus2 = reader.read(8);\r\n                du_cpb_removal_delay_increment_length_minus1 = reader.read(5);\r\n                sub_pic_cpb_params_in_pic_timing_sei_flag = !!reader.next();\r\n                dpb_output_delay_du_length_minus1 = reader.read(5);\r\n            }\r\n            bit_rate_scale = reader.read(4);\r\n            cpb_size_scale = reader.read(4);\r\n            if (sub_pic_hrd_params_present_flag) {\r\n                cpb_size_du_scale = reader.read(4);\r\n            }\r\n            initial_cpb_removal_delay_length_minus1 = reader.read(5);\r\n            au_cpb_removal_delay_length_minus1 = reader.read(5);\r\n            dpb_output_delay_length_minus1 = reader.read(5);\r\n        }\r\n    }\r\n\r\n    const fixed_pic_rate_general_flag: boolean[] = [];\r\n    const fixed_pic_rate_within_cvs_flag: boolean[] = [];\r\n    const elemental_duration_in_tc_minus1: number[] = [];\r\n    const low_delay_hrd_flag: boolean[] = [];\r\n    const cpb_cnt_minus1: number[] = [];\r\n    const nalHrdParameters: SubLayerHrdParameters[] = [];\r\n    const vclHrdParameters: SubLayerHrdParameters[] = [];\r\n    for (let i = 0; i <= maxNumSubLayersMinus1; i += 1) {\r\n        fixed_pic_rate_general_flag[i] = !!reader.next();\r\n        if (!fixed_pic_rate_general_flag[i]) {\r\n            fixed_pic_rate_within_cvs_flag[i] = !!reader.next();\r\n        }\r\n        if (fixed_pic_rate_within_cvs_flag[i]) {\r\n            elemental_duration_in_tc_minus1[i] =\r\n                reader.decodeExponentialGolombNumber();\r\n        } else {\r\n            low_delay_hrd_flag[i] = !!reader.next();\r\n        }\r\n\r\n        if (!low_delay_hrd_flag[i]) {\r\n            cpb_cnt_minus1[i] = reader.decodeExponentialGolombNumber();\r\n        }\r\n\r\n        if (nal_hrd_parameters_present_flag) {\r\n            nalHrdParameters[i] = h265ParseSubLayerHrdParameters(\r\n                reader,\r\n                i,\r\n                getCpbCnt(cpb_cnt_minus1[i]!)\r\n            );\r\n        }\r\n        if (vcl_hrd_parameters_present_flag) {\r\n            vclHrdParameters[i] = h265ParseSubLayerHrdParameters(\r\n                reader,\r\n                i,\r\n                getCpbCnt(cpb_cnt_minus1[i]!)\r\n            );\r\n        }\r\n    }\r\n\r\n    return {\r\n        nal_hrd_parameters_present_flag,\r\n        vcl_hrd_parameters_present_flag,\r\n        sub_pic_hrd_params_present_flag,\r\n        tick_divisor_minus2,\r\n        du_cpb_removal_delay_increment_length_minus1,\r\n        sub_pic_cpb_params_in_pic_timing_sei_flag,\r\n        dpb_output_delay_du_length_minus1,\r\n        bit_rate_scale,\r\n        cpb_size_scale,\r\n        cpb_size_du_scale,\r\n        initial_cpb_removal_delay_length_minus1,\r\n        au_cpb_removal_delay_length_minus1,\r\n        dpb_output_delay_length_minus1,\r\n        fixed_pic_rate_general_flag,\r\n        fixed_pic_rate_within_cvs_flag,\r\n        elemental_duration_in_tc_minus1,\r\n        low_delay_hrd_flag,\r\n        cpb_cnt_minus1,\r\n        nalHrdParameters,\r\n        vclHrdParameters,\r\n    };\r\n}\r\n\r\nexport type H265HrdParameters = ReturnType<typeof h265ParseHrdParameters>;\r\n\r\n/**\r\n * E.2.3 Sub-layer HRD parameters syntax\r\n */\r\nexport function h265ParseSubLayerHrdParameters(\r\n    reader: NaluSodbBitReader,\r\n    subLayerId: number,\r\n    CpbCnt: number\r\n) {\r\n    const bit_rate_value_minus1: number[] = [];\r\n    const cpb_size_value_minus1: number[] = [];\r\n    const cpb_size_du_value_minus1: number[] = [];\r\n    const bit_rate_du_value_minus1: number[] = [];\r\n    const cbr_flag: boolean[] = [];\r\n    for (let i = 0; i < CpbCnt; i += 1) {\r\n        bit_rate_value_minus1[i] = reader.decodeExponentialGolombNumber();\r\n        cpb_size_value_minus1[i] = reader.decodeExponentialGolombNumber();\r\n        if (subLayerId > 0) {\r\n            cbr_flag[i] = !!reader.next();\r\n        }\r\n    }\r\n    return {\r\n        bit_rate_value_minus1,\r\n        cpb_size_value_minus1,\r\n        cpb_size_du_value_minus1,\r\n        bit_rate_du_value_minus1,\r\n        cbr_flag,\r\n    };\r\n}\r\n\r\n/**\r\n * E.3.3 Sub-layer HRD parameters semantics\r\n */\r\nfunction getCpbCnt(cpb_cnt_minus_1: number) {\r\n    return cpb_cnt_minus_1 + 1;\r\n}\r\n\r\nexport function h265SearchConfiguration(buffer: Uint8Array) {\r\n    let videoParameterSet!: H265NaluRaw;\r\n    let sequenceParameterSet!: H265NaluRaw;\r\n    let pictureParameterSet!: H265NaluRaw;\r\n    let count = 0;\r\n\r\n    for (const nalu of annexBSplitNalu(buffer)) {\r\n        const header = h265ParseNaluHeader(nalu);\r\n        const raw: H265NaluRaw = {\r\n            ...header,\r\n            data: nalu,\r\n            rbsp: nalu.subarray(2),\r\n        };\r\n        switch (header.nal_unit_type) {\r\n            case 32:\r\n                videoParameterSet = raw;\r\n                break;\r\n            case 33:\r\n                sequenceParameterSet = raw;\r\n                break;\r\n            case 34:\r\n                pictureParameterSet = raw;\r\n                break;\r\n            default:\r\n                continue;\r\n        }\r\n\r\n        count += 1;\r\n        if (count === 3) {\r\n            return {\r\n                videoParameterSet,\r\n                sequenceParameterSet,\r\n                pictureParameterSet,\r\n            };\r\n        }\r\n    }\r\n\r\n    throw new Error(\"Invalid data\");\r\n}\r\n\r\nexport function h265ParseSpsMultilayerExtension(reader: NaluSodbBitReader) {\r\n    const inter_view_mv_vert_constraint_flag = !!reader.next();\r\n    return {\r\n        inter_view_mv_vert_constraint_flag,\r\n    };\r\n}\r\n\r\nexport type H265SpsMultilayerExtension = ReturnType<\r\n    typeof h265ParseSpsMultilayerExtension\r\n>;\r\n\r\nexport function h265ParseSps3dExtension(reader: NaluSodbBitReader) {\r\n    const iv_di_mc_enabled_flag: boolean[] = [];\r\n    const iv_mv_scal_enabled_flag: boolean[] = [];\r\n\r\n    iv_di_mc_enabled_flag[0] = !!reader.next();\r\n    iv_mv_scal_enabled_flag[0] = !!reader.next();\r\n\r\n    const log2_ivmc_sub_pb_size_minus3 = reader.decodeExponentialGolombNumber();\r\n    const iv_res_pred_enabled_flag = !!reader.next();\r\n    const depth_ref_enabled_flag = !!reader.next();\r\n    const vsp_mc_enabled_flag = !!reader.next();\r\n    const dbbp_enabled_flag = !!reader.next();\r\n\r\n    iv_di_mc_enabled_flag[1] = !!reader.next();\r\n    iv_mv_scal_enabled_flag[1] = !!reader.next();\r\n\r\n    const tex_mc_enabled_flag = !!reader.next();\r\n    const log2_texmc_sub_pb_size_minus3 =\r\n        reader.decodeExponentialGolombNumber();\r\n    const intra_contour_enabled_flag = !!reader.next();\r\n    const intra_dc_only_wedge_enabled_flag = !!reader.next();\r\n    const cqt_cu_part_pred_enabled_flag = !!reader.next();\r\n    const inter_dc_only_enabled_flag = !!reader.next();\r\n    const skip_intra_enabled_flag = !!reader.next();\r\n\r\n    return {\r\n        iv_di_mc_enabled_flag,\r\n        iv_mv_scal_enabled_flag,\r\n        log2_ivmc_sub_pb_size_minus3,\r\n        iv_res_pred_enabled_flag,\r\n        depth_ref_enabled_flag,\r\n        vsp_mc_enabled_flag,\r\n        dbbp_enabled_flag,\r\n        tex_mc_enabled_flag,\r\n        log2_texmc_sub_pb_size_minus3,\r\n        intra_contour_enabled_flag,\r\n        intra_dc_only_wedge_enabled_flag,\r\n        cqt_cu_part_pred_enabled_flag,\r\n        inter_dc_only_enabled_flag,\r\n        skip_intra_enabled_flag,\r\n    };\r\n}\r\n\r\nexport type H265Sps3dExtension = ReturnType<typeof h265ParseSps3dExtension>;\r\n\r\nexport interface H265Configuration {\r\n    videoParameterSet: H265NaluRaw;\r\n    sequenceParameterSet: H265NaluRaw;\r\n    pictureParameterSet: H265NaluRaw;\r\n\r\n    generalProfileSpace: number;\r\n    generalProfileIndex: number;\r\n    generalProfileCompatibilitySet: Uint8Array;\r\n    generalTierFlag: boolean;\r\n    generalLevelIndex: number;\r\n    generalConstraintSet: Uint8Array;\r\n\r\n    encodedWidth: number;\r\n    encodedHeight: number;\r\n\r\n    cropLeft: number;\r\n    cropRight: number;\r\n    cropTop: number;\r\n    cropBottom: number;\r\n    croppedWidth: number;\r\n    croppedHeight: number;\r\n}\r\n\r\nexport function h265ParseConfiguration(data: Uint8Array): H265Configuration {\r\n    const { videoParameterSet, sequenceParameterSet, pictureParameterSet } =\r\n        h265SearchConfiguration(data);\r\n\r\n    const {\r\n        profileTierLevel: {\r\n            generalProfileTier: {\r\n                profile_space: generalProfileSpace,\r\n                tier_flag: generalTierFlag,\r\n                profile_idc: generalProfileIndex,\r\n                profileCompatibilitySet: generalProfileCompatibilitySet,\r\n                constraintSet: generalConstraintSet,\r\n            },\r\n            general_level_idc: generalLevelIndex,\r\n        },\r\n    } = h265ParseVideoParameterSet(videoParameterSet.rbsp);\r\n\r\n    const {\r\n        chroma_format_idc,\r\n        pic_width_in_luma_samples: encodedWidth,\r\n        pic_height_in_luma_samples: encodedHeight,\r\n        conf_win_left_offset: cropLeft = 0,\r\n        conf_win_right_offset: cropRight = 0,\r\n        conf_win_top_offset: cropTop = 0,\r\n        conf_win_bottom_offset: cropBottom = 0,\r\n    } = h265ParseSequenceParameterSet(sequenceParameterSet.rbsp);\r\n\r\n    const SubWidthC = getSubWidthC(chroma_format_idc);\r\n    const SubHeightC = getSubHeightC(chroma_format_idc);\r\n\r\n    const croppedWidth = encodedWidth - SubWidthC * (cropLeft + cropRight);\r\n    const croppedHeight = encodedHeight - SubHeightC * (cropTop + cropBottom);\r\n\r\n    return {\r\n        videoParameterSet,\r\n        sequenceParameterSet,\r\n        pictureParameterSet,\r\n\r\n        generalProfileSpace,\r\n        generalProfileIndex,\r\n        generalProfileCompatibilitySet,\r\n        generalTierFlag,\r\n        generalLevelIndex,\r\n        generalConstraintSet,\r\n\r\n        encodedWidth,\r\n        encodedHeight,\r\n        cropLeft,\r\n        cropRight,\r\n        cropTop,\r\n        cropBottom,\r\n        croppedWidth,\r\n        croppedHeight,\r\n    };\r\n}\r\n","export * from \"./av1.js\";\r\nexport * from \"./h264.js\";\r\nexport * from \"./h265.js\";\r\nexport * from \"./nalu.js\";\r\n","import { Struct } from \"@yume-chan/struct\";\r\n\r\nexport const BasicControlMessage = new Struct().uint8(\"type\");\r\n","import type { ScrcpyInjectTouchControlMessage2_0 } from \"../options/index.js\";\r\n\r\n// https://developer.android.com/reference/android/view/MotionEvent#constants_1\r\nexport enum AndroidMotionEventAction {\r\n    Down,\r\n    Up,\r\n    Move,\r\n    Cancel,\r\n    Outside,\r\n    PointerDown,\r\n    PointerUp,\r\n    HoverMove,\r\n    Scroll,\r\n    HoverEnter,\r\n    HoverExit,\r\n    ButtonPress,\r\n    ButtonRelease,\r\n}\r\n\r\nexport enum AndroidMotionEventButton {\r\n    Primary = 0x01,\r\n    Secondary = 0x02,\r\n    Tertiary = 0x04,\r\n    Back = 0x08,\r\n    Forward = 0x10,\r\n    StylusPrimary = 0x20,\r\n    StylusSecondary = 0x40,\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-namespace\r\nexport namespace ScrcpyPointerId {\r\n    export const Mouse = -1n;\r\n    export const Finger = -2n;\r\n    export const VirtualMouse = -3n;\r\n    export const VirtualFinger = -4n;\r\n}\r\n\r\nexport type ScrcpyInjectTouchControlMessage =\r\n    ScrcpyInjectTouchControlMessage2_0;\r\n","// https://github.com/Genymobile/scrcpy/blob/fa5b2a29e983a46b49531def9cf3d80c40c3de37/app/src/control_msg.h#L23\r\n// For their message bodies, see https://github.com/Genymobile/scrcpy/blob/5c62f3419d252d10cd8c9cbb7c918b358b81f2d0/app/src/control_msg.c#L92\r\n\r\nimport type { ScrcpyOptions } from \"../options/index.js\";\r\n\r\n// Their IDs change between versions, so always use `options.getControlMessageTypes()`\r\nexport enum ScrcpyControlMessageType {\r\n    InjectKeyCode,\r\n    InjectText,\r\n    InjectTouch,\r\n    InjectScroll,\r\n    BackOrScreenOn,\r\n    ExpandNotificationPanel,\r\n    ExpandSettingPanel,\r\n    CollapseNotificationPanel,\r\n    GetClipboard,\r\n    SetClipboard,\r\n    SetScreenPowerMode,\r\n    RotateDevice,\r\n}\r\n\r\n/**\r\n * Scrcpy control message types have different values between versions.\r\n *\r\n * This class provides a way to get the actual value for a given type.\r\n */\r\nexport class ScrcpyControlMessageTypeValue {\r\n    private types: readonly ScrcpyControlMessageType[];\r\n\r\n    public constructor(options: ScrcpyOptions<object>) {\r\n        this.types = options.controlMessageTypes;\r\n    }\r\n\r\n    public get(type: ScrcpyControlMessageType): number {\r\n        const value = this.types.indexOf(type);\r\n        if (value === -1) {\r\n            throw new Error(\"Not supported\");\r\n        }\r\n        return value;\r\n    }\r\n\r\n    public fillMessageType<T extends { type: ScrcpyControlMessageType }>(\r\n        message: Omit<T, \"type\">,\r\n        type: T[\"type\"]\r\n    ): T {\r\n        (message as T).type = this.get(type);\r\n        return message as T;\r\n    }\r\n}\r\n","import type { ScrcpyInjectTouchControlMessage } from \"./inject-touch.js\";\r\nimport { AndroidMotionEventAction } from \"./inject-touch.js\";\r\nimport { ScrcpyControlMessageType } from \"./type.js\";\r\n\r\n/**\r\n * On both Android and Windows, while both mouse and touch are supported input devices,\r\n * only one of them can be active at a time. Touch the screen with a finger will deactivate mouse,\r\n * and move the mouse will deactivate touch.\r\n *\r\n * On Android, this is achieved by dispatching a `MotionEvent.ACTION_UP` event for the previous input type.\r\n * But on Chrome, there is no such event, causing both mouse and touch to be active at the same time.\r\n * This can cause the new input to appear as \"ignored\".\r\n *\r\n * This helper class synthesis `ACTION_UP` events when a different pointer type appears,\r\n * so Scrcpy server can remove the previously hovering pointer.\r\n */\r\nexport class ScrcpyHoverHelper {\r\n    // AFAIK, only mouse and pen can have hover state\r\n    // and you can't have two mouses or pens.\r\n    // So remember the last hovering pointer is enough.\r\n    private lastHoverMessage: ScrcpyInjectTouchControlMessage | undefined;\r\n\r\n    public process(\r\n        message: Omit<ScrcpyInjectTouchControlMessage, \"type\">\r\n    ): ScrcpyInjectTouchControlMessage[] {\r\n        const result: ScrcpyInjectTouchControlMessage[] = [];\r\n\r\n        // A different pointer appeared,\r\n        // Cancel previously hovering pointer so Scrcpy server can free up the pointer ID.\r\n        if (\r\n            this.lastHoverMessage &&\r\n            this.lastHoverMessage.pointerId !== message.pointerId\r\n        ) {\r\n            // TODO: Inject MotionEvent.ACTION_HOVER_EXIT\r\n            // From testing, it seems no App cares about this event.\r\n            result.push({\r\n                ...this.lastHoverMessage,\r\n                action: AndroidMotionEventAction.Up,\r\n            });\r\n            this.lastHoverMessage = undefined;\r\n        }\r\n\r\n        if (message.action === AndroidMotionEventAction.HoverMove) {\r\n            // TODO: Inject MotionEvent.ACTION_HOVER_ENTER\r\n            this.lastHoverMessage = message as ScrcpyInjectTouchControlMessage;\r\n        }\r\n\r\n        (message as ScrcpyInjectTouchControlMessage).type =\r\n            ScrcpyControlMessageType.InjectTouch;\r\n        result.push(message as ScrcpyInjectTouchControlMessage);\r\n\r\n        return result;\r\n    }\r\n}\r\n","import Struct, { placeholder } from \"@yume-chan/struct\";\r\n\r\nexport enum AndroidKeyEventAction {\r\n    Down = 0,\r\n    Up = 1,\r\n}\r\n\r\n// https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/view/KeyEvent.java;l=993;drc=95c1165bb895dd844e1793460710f7163dd330a3\r\nexport enum AndroidKeyEventMeta {\r\n    AltOn = 0x02,\r\n    AltLeftOn = 0x10,\r\n    AltRightOn = 0x20,\r\n    ShiftOn = 0x01,\r\n    ShiftLeftOn = 0x40,\r\n    ShiftRightOn = 0x80,\r\n    CtrlOn = 0x1000,\r\n    CtrlLeftOn = 0x2000,\r\n    CtrlRightOn = 0x4000,\r\n    MetaOn = 0x10000,\r\n    MetaLeftOn = 0x20000,\r\n    MetaRightOn = 0x40000,\r\n    CapsLockOn = 0x100000,\r\n    NumLockOn = 0x200000,\r\n    ScrollLockOn = 0x400000,\r\n}\r\n\r\n// https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/view/KeyEvent.java;l=97;drc=95c1165bb895dd844e1793460710f7163dd330a3\r\n// Most names follow Web API `KeyboardEvent.code`,\r\n// Android-only (not exist in HID keyboard standard) keys are prefixed by `Android`.\r\nexport enum AndroidKeyCode {\r\n    AndroidHome = 3,\r\n    AndroidBack = 4,\r\n    AndroidCall,\r\n    AndroidEndCall,\r\n\r\n    Digit0,\r\n    Digit1,\r\n    Digit2,\r\n    Digit3,\r\n    Digit4,\r\n    Digit5,\r\n    Digit6,\r\n    Digit7,\r\n    Digit8,\r\n    Digit9,\r\n    /**\r\n     * '*' key.\r\n     */\r\n    Star, // Name not verified\r\n    /**\r\n     * '#' key.\r\n     */\r\n    Pound, // Name not verified\r\n\r\n    /**\r\n     * Directional Pad Up key.\r\n     */\r\n    ArrowUp,\r\n    /**\r\n     * Directional Pad Down key.\r\n     */\r\n    ArrowDown,\r\n    /**\r\n     * Directional Pad Left key.\r\n     */\r\n    ArrowLeft,\r\n    /**\r\n     * Directional Pad Right key.\r\n     */\r\n    ArrowRight,\r\n    /**\r\n     * Directional Pad Center key.\r\n     */\r\n    AndroidDPadCenter,\r\n\r\n    VolumeUp, // Name not verified\r\n    VolumeDown, // Name not verified\r\n    Power, // Name not verified\r\n    AndroidCamera,\r\n    Clear, // Name not verified\r\n\r\n    KeyA,\r\n    KeyB,\r\n    KeyC,\r\n    KeyD,\r\n    KeyE,\r\n    KeyF,\r\n    KeyG,\r\n    KeyH,\r\n    KeyI,\r\n    KeyJ,\r\n    KeyK,\r\n    KeyL,\r\n    KeyM,\r\n    KeyN,\r\n    KeyO,\r\n    KeyP,\r\n    KeyQ,\r\n    KeyR,\r\n    KeyS,\r\n    KeyT,\r\n    KeyU,\r\n    KeyV,\r\n    KeyW,\r\n    KeyX,\r\n    KeyY,\r\n    KeyZ,\r\n    Comma,\r\n    Period,\r\n    AltLeft,\r\n    AltRight,\r\n    ShiftLeft,\r\n    ShiftRight,\r\n    Tab,\r\n    Space,\r\n    AndroidSymbol,\r\n    AndroidExplorer,\r\n    AndroidEnvelope,\r\n    Enter,\r\n    Backspace,\r\n    Backquote,\r\n    Minus,\r\n    Equal,\r\n    BracketLeft,\r\n    BracketRight,\r\n    Backslash,\r\n    Semicolon,\r\n    Quote,\r\n    Slash,\r\n    At, // Name not verified\r\n\r\n    AndroidNum,\r\n    AndroidHeadsetHook,\r\n    /**\r\n     * Camera Focus key。\r\n     */\r\n    AndroidFocus,\r\n\r\n    Plus, // Name not verified\r\n    ContextMenu,\r\n    AndroidNotification,\r\n    AndroidSearch,\r\n\r\n    PageUp = 92,\r\n    PageDown,\r\n\r\n    Escape = 111,\r\n    Delete,\r\n    ControlLeft,\r\n    ControlRight,\r\n    CapsLock,\r\n    ScrollLock,\r\n    MetaLeft,\r\n    MetaRight,\r\n    AndroidFunction,\r\n    PrintScreen,\r\n    Pause,\r\n\r\n    Home,\r\n    End,\r\n    Insert,\r\n    AndroidForward,\r\n\r\n    F1 = 131,\r\n    F2,\r\n    F3,\r\n    F4,\r\n    F5,\r\n    F6,\r\n    F7,\r\n    F8,\r\n    F9,\r\n    F10,\r\n    F11,\r\n    F12,\r\n\r\n    NumLock,\r\n    Numpad0,\r\n    Numpad1,\r\n    Numpad2,\r\n    Numpad3,\r\n    Numpad4,\r\n    Numpad5,\r\n    Numpad6,\r\n    Numpad7,\r\n    Numpad8,\r\n    Numpad9,\r\n    NumpadDivide,\r\n    NumpadMultiply,\r\n    NumpadSubtract,\r\n    NumpadAdd,\r\n    NumpadDecimal,\r\n    NumpadComma, // Name not verified\r\n    NumpadEnter,\r\n    NumpadEquals, // Name not verified\r\n    NumpadLeftParen, // Name not verified\r\n    NumpadRightParen, // Name not verified\r\n\r\n    VolumeMute = 164, // Name not verified\r\n    AndroidAppSwitch = 187,\r\n\r\n    AndroidCut = 277,\r\n    AndroidCopy,\r\n    AndroidPaste,\r\n}\r\n\r\nexport const ScrcpyInjectKeyCodeControlMessage = new Struct()\r\n    .uint8(\"type\")\r\n    .uint8(\"action\", placeholder<AndroidKeyEventAction>())\r\n    .uint32(\"keyCode\")\r\n    .uint32(\"repeat\")\r\n    .uint32(\"metaState\");\r\n\r\nexport type ScrcpyInjectKeyCodeControlMessage =\r\n    (typeof ScrcpyInjectKeyCodeControlMessage)[\"TInit\"];\r\n","import Struct from \"@yume-chan/struct\";\r\n\r\nexport const ScrcpyInjectTextControlMessage = new Struct()\r\n    .uint8(\"type\")\r\n    .uint32(\"length\")\r\n    .string(\"text\", { lengthField: \"length\" });\r\n\r\nexport type ScrcpyInjectTextControlMessage =\r\n    (typeof ScrcpyInjectTextControlMessage)[\"TInit\"];\r\n","import { BasicControlMessage } from \"./basic.js\";\r\n\r\nexport const ScrcpyRotateDeviceControlMessage = BasicControlMessage;\r\n\r\nexport type ScrcpyRotateDeviceControlMessage =\r\n    (typeof ScrcpyRotateDeviceControlMessage)[\"TInit\"];\r\n","import Struct, { placeholder } from \"@yume-chan/struct\";\r\n\r\n// https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/view/SurfaceControl.java;l=659;drc=20303e05bf73796124ab70a279cf849b61b97905\r\nexport enum AndroidScreenPowerMode {\r\n    Off = 0,\r\n    Normal = 2,\r\n}\r\n\r\nexport const ScrcpySetScreenPowerModeControlMessage = new Struct()\r\n    .uint8(\"type\")\r\n    .uint8(\"mode\", placeholder<AndroidScreenPowerMode>());\r\n\r\nexport type ScrcpySetScreenPowerModeControlMessage =\r\n    (typeof ScrcpySetScreenPowerModeControlMessage)[\"TInit\"];\r\n","import type {\r\n    ScrcpyOptions,\r\n    ScrcpyScrollController,\r\n} from \"../options/index.js\";\r\n\r\nimport type { AndroidKeyEventAction } from \"./inject-keycode.js\";\r\nimport { ScrcpyInjectKeyCodeControlMessage } from \"./inject-keycode.js\";\r\nimport type { ScrcpyInjectScrollControlMessage } from \"./inject-scroll.js\";\r\nimport { ScrcpyInjectTextControlMessage } from \"./inject-text.js\";\r\nimport type { ScrcpyInjectTouchControlMessage } from \"./inject-touch.js\";\r\nimport { ScrcpyRotateDeviceControlMessage } from \"./rotate-device.js\";\r\nimport type { AndroidScreenPowerMode } from \"./set-screen-power-mode.js\";\r\nimport { ScrcpySetScreenPowerModeControlMessage } from \"./set-screen-power-mode.js\";\r\nimport {\r\n    ScrcpyControlMessageType,\r\n    ScrcpyControlMessageTypeValue,\r\n} from \"./type.js\";\r\n\r\nexport class ScrcpyControlMessageSerializer {\r\n    private _options: ScrcpyOptions<object>;\r\n    private _typeValues: ScrcpyControlMessageTypeValue;\r\n    private _scrollController: ScrcpyScrollController;\r\n\r\n    public constructor(options: ScrcpyOptions<object>) {\r\n        this._options = options;\r\n        this._typeValues = new ScrcpyControlMessageTypeValue(options);\r\n        this._scrollController = options.createScrollController();\r\n    }\r\n\r\n    public injectKeyCode(\r\n        message: Omit<ScrcpyInjectKeyCodeControlMessage, \"type\">\r\n    ) {\r\n        return ScrcpyInjectKeyCodeControlMessage.serialize(\r\n            this._typeValues.fillMessageType(\r\n                message,\r\n                ScrcpyControlMessageType.InjectKeyCode\r\n            )\r\n        );\r\n    }\r\n\r\n    public injectText(text: string) {\r\n        return ScrcpyInjectTextControlMessage.serialize({\r\n            text,\r\n            type: this._typeValues.get(ScrcpyControlMessageType.InjectText),\r\n        });\r\n    }\r\n\r\n    /**\r\n     * `pressure` is a float value between 0 and 1.\r\n     */\r\n    public injectTouch(message: Omit<ScrcpyInjectTouchControlMessage, \"type\">) {\r\n        return this._options.serializeInjectTouchControlMessage(\r\n            this._typeValues.fillMessageType(\r\n                message,\r\n                ScrcpyControlMessageType.InjectTouch\r\n            )\r\n        );\r\n    }\r\n\r\n    /**\r\n     * `scrollX` and `scrollY` are float values between 0 and 1.\r\n     */\r\n    public injectScroll(\r\n        message: Omit<ScrcpyInjectScrollControlMessage, \"type\">\r\n    ) {\r\n        return this._scrollController.serializeScrollMessage(\r\n            this._typeValues.fillMessageType(\r\n                message,\r\n                ScrcpyControlMessageType.InjectScroll\r\n            )\r\n        );\r\n    }\r\n\r\n    public backOrScreenOn(action: AndroidKeyEventAction) {\r\n        return this._options.serializeBackOrScreenOnControlMessage({\r\n            action,\r\n            type: this._typeValues.get(ScrcpyControlMessageType.BackOrScreenOn),\r\n        });\r\n    }\r\n\r\n    public setScreenPowerMode(mode: AndroidScreenPowerMode) {\r\n        return ScrcpySetScreenPowerModeControlMessage.serialize({\r\n            mode,\r\n            type: this._typeValues.get(\r\n                ScrcpyControlMessageType.SetScreenPowerMode\r\n            ),\r\n        });\r\n    }\r\n\r\n    public rotateDevice() {\r\n        return ScrcpyRotateDeviceControlMessage.serialize({\r\n            type: this._typeValues.get(ScrcpyControlMessageType.RotateDevice),\r\n        });\r\n    }\r\n}\r\n","import type {\r\n    Consumable,\r\n    WritableStreamDefaultWriter,\r\n} from \"@yume-chan/stream-extra\";\r\nimport { ConsumableWritableStream } from \"@yume-chan/stream-extra\";\r\n\r\nimport type { ScrcpyOptions } from \"../options/index.js\";\r\n\r\nimport type {\r\n    AndroidKeyEventAction,\r\n    ScrcpyInjectKeyCodeControlMessage,\r\n} from \"./inject-keycode.js\";\r\nimport type { ScrcpyInjectScrollControlMessage } from \"./inject-scroll.js\";\r\nimport type { ScrcpyInjectTouchControlMessage } from \"./inject-touch.js\";\r\nimport { ScrcpyControlMessageSerializer } from \"./serializer.js\";\r\nimport type { AndroidScreenPowerMode } from \"./set-screen-power-mode.js\";\r\n\r\nexport class ScrcpyControlMessageWriter {\r\n    private _writer: WritableStreamDefaultWriter<Consumable<Uint8Array>>;\r\n    private _serializer: ScrcpyControlMessageSerializer;\r\n\r\n    public constructor(\r\n        writer: WritableStreamDefaultWriter<Consumable<Uint8Array>>,\r\n        options: ScrcpyOptions<object>\r\n    ) {\r\n        this._writer = writer;\r\n        this._serializer = new ScrcpyControlMessageSerializer(options);\r\n    }\r\n\r\n    private async write(message: Uint8Array) {\r\n        await ConsumableWritableStream.write(this._writer, message);\r\n    }\r\n\r\n    public async injectKeyCode(\r\n        message: Omit<ScrcpyInjectKeyCodeControlMessage, \"type\">\r\n    ) {\r\n        await this.write(this._serializer.injectKeyCode(message));\r\n    }\r\n\r\n    public async injectText(text: string) {\r\n        await this.write(this._serializer.injectText(text));\r\n    }\r\n\r\n    /**\r\n     * `pressure` is a float value between 0 and 1.\r\n     */\r\n    public async injectTouch(\r\n        message: Omit<ScrcpyInjectTouchControlMessage, \"type\">\r\n    ) {\r\n        await this.write(this._serializer.injectTouch(message));\r\n    }\r\n\r\n    /**\r\n     * `scrollX` and `scrollY` are float values between 0 and 1.\r\n     */\r\n    public async injectScroll(\r\n        message: Omit<ScrcpyInjectScrollControlMessage, \"type\">\r\n    ) {\r\n        const data = this._serializer.injectScroll(message);\r\n        if (data) {\r\n            await this.write(data);\r\n        }\r\n    }\r\n\r\n    public async backOrScreenOn(action: AndroidKeyEventAction) {\r\n        const data = this._serializer.backOrScreenOn(action);\r\n        if (data) {\r\n            await this.write(data);\r\n        }\r\n    }\r\n\r\n    public async setScreenPowerMode(mode: AndroidScreenPowerMode) {\r\n        await this.write(this._serializer.setScreenPowerMode(mode));\r\n    }\r\n\r\n    public async rotateDevice() {\r\n        await this.write(this._serializer.rotateDevice());\r\n    }\r\n\r\n    public releaseLock() {\r\n        this._writer.releaseLock();\r\n    }\r\n\r\n    public async close() {\r\n        await this._writer.close();\r\n    }\r\n}\r\n","export * from \"./back-or-screen-on.js\";\r\nexport * from \"./basic.js\";\r\nexport * from \"./hover-helper.js\";\r\nexport * from \"./inject-keycode.js\";\r\nexport * from \"./inject-scroll.js\";\r\nexport * from \"./inject-text.js\";\r\nexport * from \"./inject-touch.js\";\r\nexport * from \"./rotate-device.js\";\r\nexport * from \"./serializer.js\";\r\nexport * from \"./set-clipboard.js\";\r\nexport * from \"./set-screen-power-mode.js\";\r\nexport * from \"./type.js\";\r\nexport * from \"./writer.js\";\r\n","// https://github.com/Genymobile/scrcpy/blob/41abe021e2a73efd4899b0efcd0b9eef9ec68c9b/server/src/main/java/com/genymobile/scrcpy/DeviceMessage.java#L5\r\nexport enum ScrcpyDeviceMessageType {\r\n    Clipboard,\r\n    AckClipboard,\r\n}\r\n","import Struct from \"@yume-chan/struct\";\r\n\r\nimport { ScrcpyDeviceMessageType } from \"./type.js\";\r\n\r\nexport const ScrcpyAckClipboardDeviceMessage = new Struct()\r\n    .uint64(\"sequence\")\r\n    .extra({ type: ScrcpyDeviceMessageType.AckClipboard as const });\r\n\r\nexport type ScrcpyAckClipboardDeviceMessage =\r\n    (typeof ScrcpyAckClipboardDeviceMessage)[\"TDeserializeResult\"];\r\n","import Struct from \"@yume-chan/struct\";\r\n\r\nimport { ScrcpyDeviceMessageType } from \"./type.js\";\r\n\r\nexport const ScrcpyClipboardDeviceMessage = new Struct()\r\n    .uint32(\"length\")\r\n    .string(\"content\", { lengthField: \"length\" })\r\n    .extra({ type: ScrcpyDeviceMessageType.Clipboard as const });\r\n\r\nexport type ScrcpyClipboardDeviceMessage =\r\n    (typeof ScrcpyClipboardDeviceMessage)[\"TDeserializeResult\"];\r\n","import { BufferedTransformStream } from \"@yume-chan/stream-extra\";\r\nimport {\r\n    ExactReadableEndedError,\r\n    StructEmptyError,\r\n    StructNotEnoughDataError,\r\n} from \"@yume-chan/struct\";\r\n\r\nimport { ScrcpyAckClipboardDeviceMessage } from \"./ack-clipboard.js\";\r\nimport { ScrcpyClipboardDeviceMessage } from \"./clipboard.js\";\r\nimport { ScrcpyDeviceMessageType } from \"./type.js\";\r\n\r\nexport type ScrcpyDeviceMessage =\r\n    | ScrcpyClipboardDeviceMessage\r\n    | ScrcpyAckClipboardDeviceMessage;\r\n\r\nexport class ScrcpyDeviceMessageDeserializeStream extends BufferedTransformStream<ScrcpyDeviceMessage> {\r\n    constructor() {\r\n        super(async (stream) => {\r\n            try {\r\n                const type = await stream.readExactly(1);\r\n                switch (type[0]) {\r\n                    case ScrcpyDeviceMessageType.Clipboard:\r\n                        return await ScrcpyClipboardDeviceMessage.deserialize(\r\n                            stream\r\n                        );\r\n                    case ScrcpyDeviceMessageType.AckClipboard:\r\n                        return await ScrcpyAckClipboardDeviceMessage.deserialize(\r\n                            stream\r\n                        );\r\n                    default:\r\n                        throw new Error(\"Unsupported control message type\");\r\n                }\r\n            } catch (e) {\r\n                // Can't read the `type` byte\r\n                if (e instanceof ExactReadableEndedError) {\r\n                    throw new StructEmptyError();\r\n                }\r\n\r\n                // Can't read struct body,\r\n                // treat as not enough data because `type` byte is already read\r\n                if (e instanceof StructEmptyError) {\r\n                    throw new StructNotEnoughDataError();\r\n                }\r\n\r\n                throw e;\r\n            }\r\n        });\r\n    }\r\n}\r\n","export * from \"./ack-clipboard.js\";\r\nexport * from \"./clipboard.js\";\r\nexport * from \"./stream.js\";\r\nexport * from \"./type.js\";\r\n","import type { ScrcpyOptionValue } from \"../types.js\";\r\n\r\n/**\r\n * If the option you need is not in this type,\r\n * please file an issue on GitHub.\r\n */\r\nexport interface CodecOptionsInit {\r\n    profile: number;\r\n    level: number;\r\n\r\n    iFrameInterval: number;\r\n    maxBframes: number;\r\n    repeatPreviousFrameAfter: number;\r\n    maxPtsGapToEncoder: number;\r\n    intraRefreshPeriod: number;\r\n}\r\n\r\nfunction toDashCase(input: string) {\r\n    return input.replace(/([A-Z])/g, \"-$1\").toLowerCase();\r\n}\r\n\r\nconst CODEC_OPTION_TYPES: Partial<\r\n    Record<keyof CodecOptionsInit, \"long\" | \"float\" | \"string\">\r\n> = {\r\n    repeatPreviousFrameAfter: \"long\",\r\n    maxPtsGapToEncoder: \"long\",\r\n};\r\n\r\nexport class CodecOptions implements ScrcpyOptionValue {\r\n    public value: Partial<CodecOptionsInit>;\r\n\r\n    public constructor(value: Partial<CodecOptionsInit> = {}) {\r\n        this.value = value;\r\n    }\r\n\r\n    public toOptionValue(): string | undefined {\r\n        const entries = Object.entries(this.value).filter(\r\n            ([, value]) => value !== undefined\r\n        );\r\n\r\n        if (entries.length === 0) {\r\n            return undefined;\r\n        }\r\n\r\n        return entries\r\n            .map(([key, value]) => {\r\n                const type = CODEC_OPTION_TYPES[key as keyof CodecOptionsInit];\r\n                return `${toDashCase(key)}${type ? `:${type}` : \"\"}=${value}`;\r\n            })\r\n            .join(\",\");\r\n    }\r\n}\r\n","import { NumberFieldDefinition, NumberFieldType } from \"@yume-chan/struct\";\r\n\r\nexport function clamp(value: number, min: number, max: number): number {\r\n    if (value < min) {\r\n        return min;\r\n    }\r\n\r\n    if (value > max) {\r\n        return max;\r\n    }\r\n\r\n    return value;\r\n}\r\n\r\nexport const ScrcpyFloatToUint16NumberType: NumberFieldType = {\r\n    size: 2,\r\n    signed: false,\r\n    deserialize(array, littleEndian) {\r\n        const value = NumberFieldType.Uint16.deserialize(array, littleEndian);\r\n        // https://github.com/Genymobile/scrcpy/blob/1f138aef41de651668043b32c4effc2d4adbfc44/server/src/main/java/com/genymobile/scrcpy/Binary.java#L22\r\n        return value === 0xffff ? 1 : value / 0x10000;\r\n    },\r\n    serialize(dataView, offset, value, littleEndian) {\r\n        // https://github.com/Genymobile/scrcpy/blob/1f138aef41de651668043b32c4effc2d4adbfc44/app/src/util/binary.h#L51\r\n        value = clamp(value, -1, 1);\r\n        value = value === 1 ? 0xffff : value * 0x10000;\r\n        NumberFieldType.Uint16.serialize(dataView, offset, value, littleEndian);\r\n    },\r\n};\r\n\r\nexport const ScrcpyFloatToUint16FieldDefinition = new NumberFieldDefinition(\r\n    ScrcpyFloatToUint16NumberType\r\n);\r\n","import type { CodecOptions } from \"./codec-options.js\";\r\n\r\nexport enum ScrcpyLogLevel1_16 {\r\n    Debug = \"debug\",\r\n    Info = \"info\",\r\n    Warn = \"warn\",\r\n    Error = \"error\",\r\n}\r\n\r\nexport enum ScrcpyVideoOrientation1_16 {\r\n    Unlocked = -1,\r\n    Portrait = 0,\r\n    Landscape = 1,\r\n    PortraitFlipped = 2,\r\n    LandscapeFlipped = 3,\r\n}\r\n\r\nexport interface ScrcpyOptionsInit1_16 {\r\n    logLevel?: ScrcpyLogLevel1_16;\r\n\r\n    /**\r\n     * The maximum value of both width and height.\r\n     */\r\n    maxSize?: number;\r\n\r\n    bitRate?: number;\r\n\r\n    /**\r\n     * 0 for unlimited.\r\n     *\r\n     * @default 0\r\n     */\r\n    maxFps?: number;\r\n\r\n    /**\r\n     * The orientation of the video stream.\r\n     *\r\n     * It will not keep the device screen in specific orientation,\r\n     * only the captured video will in this orientation.\r\n     */\r\n    lockVideoOrientation?: ScrcpyVideoOrientation1_16;\r\n\r\n    /**\r\n     * Use ADB forward tunnel instead of reverse tunnel.\r\n     *\r\n     * This option is mainly used for working around the bug that on Android <9,\r\n     * ADB daemon can't create reverse tunnels if connected wirelessly (ADB over WiFi).\r\n     *\r\n     * When using `AdbScrcpyClient`, it can detect this situation and enable this option automatically.\r\n     */\r\n    tunnelForward?: boolean;\r\n\r\n    crop?: string | undefined;\r\n\r\n    /**\r\n     * Send PTS so that the client may record properly\r\n     *\r\n     * Note: When `sendFrameMeta: false` is specified,\r\n     * the video stream will not contain `configuration` typed packets,\r\n     * which means it can't be decoded by the companion decoders.\r\n     * It's still possible to record the stream into a file,\r\n     * or to decode it with a more tolerant decoder like FFMpeg.\r\n     *\r\n     * @default true\r\n     */\r\n    sendFrameMeta?: boolean;\r\n\r\n    /**\r\n     * @default true\r\n     */\r\n    control?: boolean;\r\n\r\n    displayId?: number;\r\n\r\n    showTouches?: boolean;\r\n\r\n    stayAwake?: boolean;\r\n\r\n    codecOptions?: CodecOptions;\r\n}\r\n","import Struct, { placeholder } from \"@yume-chan/struct\";\r\n\r\nimport type { AndroidMotionEventAction } from \"../../control/index.js\";\r\nimport {\r\n    BasicControlMessage,\r\n    ScrcpyControlMessageType,\r\n} from \"../../control/index.js\";\r\n\r\nimport { ScrcpyFloatToUint16FieldDefinition } from \"./float-to-uint16.js\";\r\n\r\nexport const SCRCPY_CONTROL_MESSAGE_TYPES_1_16: readonly ScrcpyControlMessageType[] =\r\n    [\r\n        /*  0 */ ScrcpyControlMessageType.InjectKeyCode,\r\n        /*  1 */ ScrcpyControlMessageType.InjectText,\r\n        /*  2 */ ScrcpyControlMessageType.InjectTouch,\r\n        /*  3 */ ScrcpyControlMessageType.InjectScroll,\r\n        /*  4 */ ScrcpyControlMessageType.BackOrScreenOn,\r\n        /*  5 */ ScrcpyControlMessageType.ExpandNotificationPanel,\r\n        /*  6 */ ScrcpyControlMessageType.CollapseNotificationPanel,\r\n        /*  7 */ ScrcpyControlMessageType.GetClipboard,\r\n        /*  8 */ ScrcpyControlMessageType.SetClipboard,\r\n        /*  9 */ ScrcpyControlMessageType.SetScreenPowerMode,\r\n        /* 10 */ ScrcpyControlMessageType.RotateDevice,\r\n    ];\r\n\r\nexport const ScrcpyMediaStreamRawPacket = new Struct()\r\n    .uint64(\"pts\")\r\n    .uint32(\"size\")\r\n    .uint8Array(\"data\", { lengthField: \"size\" });\r\n\r\nexport const SCRCPY_MEDIA_PACKET_FLAG_CONFIG = 1n << 63n;\r\n\r\nexport const ScrcpyInjectTouchControlMessage1_16 = new Struct()\r\n    .uint8(\"type\")\r\n    .uint8(\"action\", placeholder<AndroidMotionEventAction>())\r\n    .uint64(\"pointerId\")\r\n    .uint32(\"pointerX\")\r\n    .uint32(\"pointerY\")\r\n    .uint16(\"screenWidth\")\r\n    .uint16(\"screenHeight\")\r\n    .field(\"pressure\", ScrcpyFloatToUint16FieldDefinition)\r\n    .uint32(\"buttons\");\r\n\r\nexport type ScrcpyInjectTouchControlMessage1_16 =\r\n    (typeof ScrcpyInjectTouchControlMessage1_16)[\"TInit\"];\r\n\r\nexport const ScrcpyBackOrScreenOnControlMessage1_16 = BasicControlMessage;\r\n\r\nexport const ScrcpySetClipboardControlMessage1_15 = new Struct()\r\n    .uint8(\"type\")\r\n    .uint32(\"length\")\r\n    .string(\"content\", { lengthField: \"length\" });\r\n\r\nexport type ScrcpySetClipboardControlMessage1_15 =\r\n    (typeof ScrcpySetClipboardControlMessage1_15)[\"TInit\"];\r\n","import type { ReadableStream } from \"@yume-chan/stream-extra\";\r\n\r\nimport type { ScrcpyOptionValue } from \"./types.js\";\r\n\r\nexport enum ScrcpyVideoCodecId {\r\n    H264 = 0x68_32_36_34,\r\n    H265 = 0x68_32_36_35,\r\n    AV1 = 0x00_61_76_31,\r\n}\r\n\r\nexport interface ScrcpyVideoStreamMetadata {\r\n    deviceName?: string | undefined;\r\n    width?: number | undefined;\r\n    height?: number | undefined;\r\n    codec: ScrcpyVideoCodecId;\r\n}\r\n\r\nexport interface ScrcpyVideoStream {\r\n    readonly stream: ReadableStream<Uint8Array>;\r\n    readonly metadata: ScrcpyVideoStreamMetadata;\r\n}\r\n\r\nexport class ScrcpyAudioCodec implements ScrcpyOptionValue {\r\n    public static readonly OPUS = new ScrcpyAudioCodec(\r\n        \"opus\",\r\n        0x6f_70_75_73,\r\n        \"audio/opus\",\r\n        \"opus\"\r\n    );\r\n    public static readonly AAC = new ScrcpyAudioCodec(\r\n        \"aac\",\r\n        0x00_61_61_63,\r\n        \"audio/aac\",\r\n        \"mp4a.66\"\r\n    );\r\n    public static readonly RAW = new ScrcpyAudioCodec(\r\n        \"raw\",\r\n        0x00_72_61_77,\r\n        \"audio/raw\",\r\n        \"1\"\r\n    );\r\n\r\n    public readonly optionValue: string;\r\n    public readonly metadataValue: number;\r\n    public readonly mimeType: string;\r\n    public readonly webCodecId: string;\r\n\r\n    public constructor(\r\n        optionValue: string,\r\n        metadataValue: number,\r\n        mimeType: string,\r\n        webCodecId: string\r\n    ) {\r\n        this.optionValue = optionValue;\r\n        this.metadataValue = metadataValue;\r\n        this.mimeType = mimeType;\r\n        this.webCodecId = webCodecId;\r\n    }\r\n\r\n    public toOptionValue(): string {\r\n        return this.optionValue;\r\n    }\r\n}\r\n\r\nexport interface ScrcpyAudioStreamDisabledMetadata {\r\n    readonly type: \"disabled\";\r\n}\r\n\r\nexport interface ScrcpyAudioStreamErroredMetadata {\r\n    readonly type: \"errored\";\r\n}\r\n\r\nexport interface ScrcpyAudioStreamSuccessMetadata {\r\n    readonly type: \"success\";\r\n    readonly codec: ScrcpyAudioCodec;\r\n    readonly stream: ReadableStream<Uint8Array>;\r\n}\r\n\r\nexport type ScrcpyAudioStreamMetadata =\r\n    | ScrcpyAudioStreamDisabledMetadata\r\n    | ScrcpyAudioStreamErroredMetadata\r\n    | ScrcpyAudioStreamSuccessMetadata;\r\n\r\nexport interface ScrcpyMediaStreamConfigurationPacket {\r\n    type: \"configuration\";\r\n    data: Uint8Array;\r\n}\r\n\r\nexport interface ScrcpyMediaStreamDataPacket {\r\n    type: \"data\";\r\n    keyframe?: boolean;\r\n    pts?: bigint;\r\n    data: Uint8Array;\r\n}\r\n\r\nexport type ScrcpyMediaStreamPacket =\r\n    | ScrcpyMediaStreamConfigurationPacket\r\n    | ScrcpyMediaStreamDataPacket;\r\n","import type { ReadableStream, TransformStream } from \"@yume-chan/stream-extra\";\r\nimport type { ValueOrPromise } from \"@yume-chan/struct\";\r\n\r\nimport type {\r\n    ScrcpyBackOrScreenOnControlMessage,\r\n    ScrcpyControlMessageType,\r\n    ScrcpyInjectTouchControlMessage,\r\n    ScrcpySetClipboardControlMessage,\r\n} from \"../control/index.js\";\r\n\r\nimport type { ScrcpyScrollController } from \"./1_16/scroll.js\";\r\nimport type {\r\n    ScrcpyAudioStreamMetadata,\r\n    ScrcpyMediaStreamPacket,\r\n    ScrcpyVideoStream,\r\n} from \"./codec.js\";\r\n\r\nexport const DEFAULT_SERVER_PATH = \"/data/local/tmp/scrcpy-server.jar\";\r\n\r\nexport interface ScrcpyOptionValue {\r\n    toOptionValue(): string | undefined;\r\n}\r\n\r\nexport function isScrcpyOptionValue(\r\n    value: unknown\r\n): value is ScrcpyOptionValue {\r\n    return (\r\n        typeof value === \"object\" &&\r\n        value !== null &&\r\n        \"toOptionValue\" in value &&\r\n        typeof value.toOptionValue === \"function\"\r\n    );\r\n}\r\n\r\nexport function toScrcpyOptionValue<T>(value: unknown, empty: T): string | T {\r\n    if (isScrcpyOptionValue(value)) {\r\n        value = value.toOptionValue();\r\n    }\r\n\r\n    // `value` may become `undefined` after `toOptionValue`\r\n    if (value === undefined) {\r\n        return empty;\r\n    }\r\n\r\n    return String(value);\r\n}\r\n\r\nexport interface ScrcpyEncoder {\r\n    type: \"video\" | \"audio\";\r\n    codec?: string;\r\n    name: string;\r\n}\r\n\r\nexport interface ScrcpyDisplay {\r\n    id: number;\r\n    resolution?: string;\r\n}\r\n\r\nexport interface ScrcpyOptions<T extends object> {\r\n    readonly defaults: Required<T>;\r\n\r\n    readonly controlMessageTypes: readonly ScrcpyControlMessageType[];\r\n\r\n    readonly value: Required<T>;\r\n\r\n    serialize(): string[];\r\n\r\n    /**\r\n     * Set the essential options to let Scrcpy server print out available encoders.\r\n     */\r\n    setListEncoders(): void;\r\n\r\n    /**\r\n     * Set the essential options to let Scrcpy server print out available displays.\r\n     */\r\n    setListDisplays(): void;\r\n\r\n    /**\r\n     * Parse encoder information from Scrcpy server output\r\n     * @param line One line of Scrcpy server output\r\n     */\r\n    parseEncoder(line: string): ScrcpyEncoder | undefined;\r\n\r\n    /**\r\n     * Parse display information from Scrcpy server output\r\n     * @param line One line of Scrcpy server output\r\n     */\r\n    parseDisplay(line: string): ScrcpyDisplay | undefined;\r\n\r\n    /**\r\n     * Parse the device metadata from video stream according to the current version and options.\r\n     * @param stream The video stream.\r\n     * @returns\r\n     * A tuple of the video stream and the metadata.\r\n     *\r\n     * The returned video stream may be different from the input stream, and should be used for further processing.\r\n     */\r\n    parseVideoStreamMetadata(\r\n        stream: ReadableStream<Uint8Array>\r\n    ): ValueOrPromise<ScrcpyVideoStream>;\r\n\r\n    parseAudioStreamMetadata(\r\n        stream: ReadableStream<Uint8Array>\r\n    ): ValueOrPromise<ScrcpyAudioStreamMetadata>;\r\n\r\n    createMediaStreamTransformer(): TransformStream<\r\n        Uint8Array,\r\n        ScrcpyMediaStreamPacket\r\n    >;\r\n\r\n    serializeInjectTouchControlMessage(\r\n        message: ScrcpyInjectTouchControlMessage\r\n    ): Uint8Array;\r\n\r\n    serializeBackOrScreenOnControlMessage(\r\n        message: ScrcpyBackOrScreenOnControlMessage\r\n    ): Uint8Array | undefined;\r\n\r\n    serializeSetClipboardControlMessage(\r\n        message: ScrcpySetClipboardControlMessage\r\n    ): Uint8Array;\r\n\r\n    createScrollController(): ScrcpyScrollController;\r\n}\r\n\r\nexport abstract class ScrcpyOptionsBase<\r\n    T extends object,\r\n    B extends ScrcpyOptions<object>\r\n> implements ScrcpyOptions<T>\r\n{\r\n    protected _base: B;\r\n\r\n    public abstract get defaults(): Required<T>;\r\n\r\n    public get controlMessageTypes(): readonly ScrcpyControlMessageType[] {\r\n        return this._base.controlMessageTypes;\r\n    }\r\n\r\n    public readonly value: Required<T>;\r\n\r\n    public constructor(base: B, value: Required<T>) {\r\n        this._base = base;\r\n        this.value = value;\r\n    }\r\n\r\n    public abstract serialize(): string[];\r\n\r\n    public setListEncoders(): void {\r\n        this._base.setListEncoders();\r\n    }\r\n\r\n    public setListDisplays(): void {\r\n        this._base.setListDisplays();\r\n    }\r\n\r\n    public parseEncoder(line: string): ScrcpyEncoder | undefined {\r\n        return this._base.parseEncoder(line);\r\n    }\r\n\r\n    public parseDisplay(line: string): ScrcpyDisplay | undefined {\r\n        return this._base.parseDisplay(line);\r\n    }\r\n\r\n    /**\r\n     * Parse the device metadata from video stream according to the current version and options.\r\n     * @param stream The video stream.\r\n     * @returns\r\n     * A tuple of the video stream and the metadata.\r\n     *\r\n     * The returned video stream may be different from the input stream, and should be used for further processing.\r\n     */\r\n    public parseVideoStreamMetadata(\r\n        stream: ReadableStream<Uint8Array>\r\n    ): ValueOrPromise<ScrcpyVideoStream> {\r\n        return this._base.parseVideoStreamMetadata(stream);\r\n    }\r\n\r\n    public parseAudioStreamMetadata(\r\n        stream: ReadableStream<Uint8Array>\r\n    ): ValueOrPromise<ScrcpyAudioStreamMetadata> {\r\n        return this._base.parseAudioStreamMetadata(stream);\r\n    }\r\n\r\n    public createMediaStreamTransformer(): TransformStream<\r\n        Uint8Array,\r\n        ScrcpyMediaStreamPacket\r\n    > {\r\n        return this._base.createMediaStreamTransformer();\r\n    }\r\n\r\n    public serializeInjectTouchControlMessage(\r\n        message: ScrcpyInjectTouchControlMessage\r\n    ): Uint8Array {\r\n        return this._base.serializeInjectTouchControlMessage(message);\r\n    }\r\n\r\n    public serializeBackOrScreenOnControlMessage(\r\n        message: ScrcpyBackOrScreenOnControlMessage\r\n    ): Uint8Array | undefined {\r\n        return this._base.serializeBackOrScreenOnControlMessage(message);\r\n    }\r\n\r\n    public serializeSetClipboardControlMessage(\r\n        message: ScrcpySetClipboardControlMessage\r\n    ): Uint8Array {\r\n        return this._base.serializeSetClipboardControlMessage(message);\r\n    }\r\n\r\n    public createScrollController(): ScrcpyScrollController {\r\n        return this._base.createScrollController();\r\n    }\r\n}\r\n","import Struct from \"@yume-chan/struct\";\r\n\r\nimport type { ScrcpyInjectScrollControlMessage } from \"../../control/index.js\";\r\n\r\nexport interface ScrcpyScrollController {\r\n    serializeScrollMessage(\r\n        message: ScrcpyInjectScrollControlMessage\r\n    ): Uint8Array | undefined;\r\n}\r\n\r\nexport const ScrcpyInjectScrollControlMessage1_16 = new Struct()\r\n    .uint8(\"type\")\r\n    .uint32(\"pointerX\")\r\n    .uint32(\"pointerY\")\r\n    .uint16(\"screenWidth\")\r\n    .uint16(\"screenHeight\")\r\n    .int32(\"scrollX\")\r\n    .int32(\"scrollY\");\r\n\r\n/**\r\n * Old version of Scrcpy server only supports integer values for scroll.\r\n *\r\n * Accumulate scroll values and send scroll message when accumulated value\r\n * reaches 1 or -1.\r\n */\r\nexport class ScrcpyScrollController1_16 implements ScrcpyScrollController {\r\n    private accumulatedX = 0;\r\n    private accumulatedY = 0;\r\n\r\n    protected processMessage(\r\n        message: ScrcpyInjectScrollControlMessage\r\n    ): ScrcpyInjectScrollControlMessage | undefined {\r\n        this.accumulatedX += message.scrollX;\r\n        this.accumulatedY += message.scrollY;\r\n\r\n        let scrollX = 0;\r\n        let scrollY = 0;\r\n        if (this.accumulatedX >= 1) {\r\n            scrollX = 1;\r\n            this.accumulatedX = 0;\r\n        } else if (this.accumulatedX <= -1) {\r\n            scrollX = -1;\r\n            this.accumulatedX = 0;\r\n        }\r\n\r\n        if (this.accumulatedY >= 1) {\r\n            scrollY = 1;\r\n            this.accumulatedY = 0;\r\n        } else if (this.accumulatedY <= -1) {\r\n            scrollY = -1;\r\n            this.accumulatedY = 0;\r\n        }\r\n\r\n        if (scrollX === 0 && scrollY === 0) {\r\n            return undefined;\r\n        }\r\n\r\n        message.scrollX = scrollX;\r\n        message.scrollY = scrollY;\r\n        return message;\r\n    }\r\n\r\n    public serializeScrollMessage(\r\n        message: ScrcpyInjectScrollControlMessage\r\n    ): Uint8Array | undefined {\r\n        const processed = this.processMessage(message);\r\n        if (!processed) {\r\n            return undefined;\r\n        }\r\n\r\n        return ScrcpyInjectScrollControlMessage1_16.serialize(processed);\r\n    }\r\n}\r\n","import type { ReadableStream } from \"@yume-chan/stream-extra\";\r\nimport {\r\n    BufferedReadableStream,\r\n    StructDeserializeStream,\r\n    TransformStream,\r\n} from \"@yume-chan/stream-extra\";\r\nimport type { AsyncExactReadable, ValueOrPromise } from \"@yume-chan/struct\";\r\nimport { NumberFieldType, decodeUtf8 } from \"@yume-chan/struct\";\r\n\r\nimport type {\r\n    ScrcpyBackOrScreenOnControlMessage,\r\n    ScrcpyControlMessageType,\r\n    ScrcpyInjectTouchControlMessage,\r\n    ScrcpySetClipboardControlMessage,\r\n} from \"../../control/index.js\";\r\nimport { AndroidKeyEventAction } from \"../../control/index.js\";\r\nimport type {\r\n    ScrcpyMediaStreamPacket,\r\n    ScrcpyVideoStream,\r\n    ScrcpyVideoStreamMetadata,\r\n} from \"../codec.js\";\r\nimport { ScrcpyVideoCodecId } from \"../codec.js\";\r\nimport type { ScrcpyDisplay, ScrcpyEncoder, ScrcpyOptions } from \"../types.js\";\r\nimport { toScrcpyOptionValue } from \"../types.js\";\r\n\r\nimport { CodecOptions } from \"./codec-options.js\";\r\nimport type { ScrcpyOptionsInit1_16 } from \"./init.js\";\r\nimport { ScrcpyLogLevel1_16, ScrcpyVideoOrientation1_16 } from \"./init.js\";\r\nimport {\r\n    SCRCPY_CONTROL_MESSAGE_TYPES_1_16,\r\n    SCRCPY_MEDIA_PACKET_FLAG_CONFIG,\r\n    ScrcpyBackOrScreenOnControlMessage1_16,\r\n    ScrcpyInjectTouchControlMessage1_16,\r\n    ScrcpyMediaStreamRawPacket,\r\n    ScrcpySetClipboardControlMessage1_15,\r\n} from \"./message.js\";\r\nimport type { ScrcpyScrollController } from \"./scroll.js\";\r\nimport { ScrcpyScrollController1_16 } from \"./scroll.js\";\r\n\r\nexport class ScrcpyOptions1_16 implements ScrcpyOptions<ScrcpyOptionsInit1_16> {\r\n    public static readonly DEFAULTS = {\r\n        logLevel: ScrcpyLogLevel1_16.Debug,\r\n        maxSize: 0,\r\n        bitRate: 8_000_000,\r\n        maxFps: 0,\r\n        lockVideoOrientation: ScrcpyVideoOrientation1_16.Unlocked,\r\n        tunnelForward: false,\r\n        crop: undefined,\r\n        sendFrameMeta: true,\r\n        control: true,\r\n        displayId: 0,\r\n        showTouches: false,\r\n        stayAwake: false,\r\n        codecOptions: new CodecOptions(),\r\n    } as const satisfies Required<ScrcpyOptionsInit1_16>;\r\n\r\n    public static readonly SERIALIZE_ORDER = [\r\n        \"logLevel\",\r\n        \"maxSize\",\r\n        \"bitRate\",\r\n        \"maxFps\",\r\n        \"lockVideoOrientation\",\r\n        \"tunnelForward\",\r\n        \"crop\",\r\n        \"sendFrameMeta\",\r\n        \"control\",\r\n        \"displayId\",\r\n        \"showTouches\",\r\n        \"stayAwake\",\r\n        \"codecOptions\",\r\n    ] as const satisfies readonly (keyof ScrcpyOptionsInit1_16)[];\r\n\r\n    public static serialize<T>(options: T, order: readonly (keyof T)[]) {\r\n        return order.map((key) => toScrcpyOptionValue(options[key], \"-\"));\r\n    }\r\n\r\n    public static async parseCString(\r\n        stream: AsyncExactReadable,\r\n        maxLength: number\r\n    ): Promise<string> {\r\n        let result = decodeUtf8(await stream.readExactly(maxLength));\r\n        result = result.substring(0, result.indexOf(\"\\0\"));\r\n        return result;\r\n    }\r\n\r\n    public static async parseUint16BE(\r\n        stream: AsyncExactReadable\r\n    ): Promise<number> {\r\n        const buffer = await stream.readExactly(NumberFieldType.Uint16.size);\r\n        return NumberFieldType.Uint16.deserialize(buffer, false);\r\n    }\r\n\r\n    public static async parseUint32BE(\r\n        stream: AsyncExactReadable\r\n    ): Promise<number> {\r\n        const buffer = await stream.readExactly(NumberFieldType.Uint32.size);\r\n        return NumberFieldType.Uint32.deserialize(buffer, false);\r\n    }\r\n\r\n    public value: Required<ScrcpyOptionsInit1_16>;\r\n\r\n    public readonly defaults: Required<ScrcpyOptionsInit1_16> =\r\n        ScrcpyOptions1_16.DEFAULTS;\r\n\r\n    public readonly controlMessageTypes: readonly ScrcpyControlMessageType[] =\r\n        SCRCPY_CONTROL_MESSAGE_TYPES_1_16;\r\n\r\n    public constructor(init: ScrcpyOptionsInit1_16) {\r\n        this.value = { ...ScrcpyOptions1_16.DEFAULTS, ...init };\r\n    }\r\n\r\n    public serialize(): string[] {\r\n        return ScrcpyOptions1_16.serialize(\r\n            this.value,\r\n            ScrcpyOptions1_16.SERIALIZE_ORDER\r\n        );\r\n    }\r\n\r\n    public setListEncoders(): void {\r\n        throw new Error(\"Not supported\");\r\n    }\r\n\r\n    public setListDisplays(): void {\r\n        // Set to an invalid value\r\n        // Server will print valid values before crashing\r\n        // (server will crash before opening sockets)\r\n        this.value.displayId = -1;\r\n    }\r\n\r\n    public parseEncoder(): ScrcpyEncoder | undefined {\r\n        throw new Error(\"Not supported\");\r\n    }\r\n\r\n    public parseDisplay(line: string): ScrcpyDisplay | undefined {\r\n        const displayIdRegex = /\\s+scrcpy --display (\\d+)/;\r\n        const match = line.match(displayIdRegex);\r\n        if (match) {\r\n            return {\r\n                id: Number.parseInt(match[1]!, 10),\r\n            };\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    public parseVideoStreamMetadata(\r\n        stream: ReadableStream<Uint8Array>\r\n    ): ValueOrPromise<ScrcpyVideoStream> {\r\n        return (async () => {\r\n            const buffered = new BufferedReadableStream(stream);\r\n            const metadata: ScrcpyVideoStreamMetadata = {\r\n                codec: ScrcpyVideoCodecId.H264,\r\n            };\r\n            metadata.deviceName = await ScrcpyOptions1_16.parseCString(\r\n                buffered,\r\n                64\r\n            );\r\n            metadata.width = await ScrcpyOptions1_16.parseUint16BE(buffered);\r\n            metadata.height = await ScrcpyOptions1_16.parseUint16BE(buffered);\r\n            return { stream: buffered.release(), metadata };\r\n        })();\r\n    }\r\n\r\n    public parseAudioStreamMetadata(): never {\r\n        throw new Error(\"Not supported\");\r\n    }\r\n\r\n    public createMediaStreamTransformer(): TransformStream<\r\n        Uint8Array,\r\n        ScrcpyMediaStreamPacket\r\n    > {\r\n        // Optimized path for video frames only\r\n        if (!this.value.sendFrameMeta) {\r\n            return new TransformStream({\r\n                transform(chunk, controller) {\r\n                    controller.enqueue({\r\n                        type: \"data\",\r\n                        data: chunk,\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        const deserializeStream = new StructDeserializeStream(\r\n            ScrcpyMediaStreamRawPacket\r\n        );\r\n        return {\r\n            writable: deserializeStream.writable,\r\n            readable: deserializeStream.readable.pipeThrough(\r\n                new TransformStream({\r\n                    transform(packet, controller) {\r\n                        if (packet.pts === SCRCPY_MEDIA_PACKET_FLAG_CONFIG) {\r\n                            controller.enqueue({\r\n                                type: \"configuration\",\r\n                                data: packet.data,\r\n                            });\r\n                            return;\r\n                        }\r\n\r\n                        controller.enqueue({\r\n                            type: \"data\",\r\n                            pts: packet.pts,\r\n                            data: packet.data,\r\n                        });\r\n                    },\r\n                })\r\n            ),\r\n        };\r\n    }\r\n\r\n    public serializeInjectTouchControlMessage(\r\n        message: ScrcpyInjectTouchControlMessage\r\n    ): Uint8Array {\r\n        return ScrcpyInjectTouchControlMessage1_16.serialize(message);\r\n    }\r\n\r\n    public serializeBackOrScreenOnControlMessage(\r\n        message: ScrcpyBackOrScreenOnControlMessage\r\n    ) {\r\n        if (message.action === AndroidKeyEventAction.Down) {\r\n            return ScrcpyBackOrScreenOnControlMessage1_16.serialize(message);\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    public serializeSetClipboardControlMessage(\r\n        message: ScrcpySetClipboardControlMessage\r\n    ): Uint8Array {\r\n        return ScrcpySetClipboardControlMessage1_15.serialize(message);\r\n    }\r\n\r\n    public createScrollController(): ScrcpyScrollController {\r\n        return new ScrcpyScrollController1_16();\r\n    }\r\n}\r\n","export * from \"./codec-options.js\";\r\nexport * from \"./float-to-uint16.js\";\r\nexport * from \"./init.js\";\r\nexport * from \"./message.js\";\r\nexport * from \"./options.js\";\r\nexport * from \"./scroll.js\";\r\n","import type { ScrcpyOptionsInit1_16 } from \"./1_16/index.js\";\r\nimport { ScrcpyOptions1_16 } from \"./1_16/index.js\";\r\nimport type { ScrcpyEncoder } from \"./types.js\";\r\nimport { ScrcpyOptionsBase } from \"./types.js\";\r\n\r\nexport interface ScrcpyOptionsInit1_17 extends ScrcpyOptionsInit1_16 {\r\n    encoderName?: string | undefined;\r\n}\r\n\r\nexport class ScrcpyOptions1_17 extends ScrcpyOptionsBase<\r\n    ScrcpyOptionsInit1_17,\r\n    ScrcpyOptions1_16\r\n> {\r\n    public static readonly DEFAULTS = {\r\n        ...ScrcpyOptions1_16.DEFAULTS,\r\n        encoderName: undefined,\r\n    } as const satisfies Required<ScrcpyOptionsInit1_17>;\r\n\r\n    public static readonly SERIALIZE_ORDER = [\r\n        ...ScrcpyOptions1_16.SERIALIZE_ORDER,\r\n        \"encoderName\",\r\n    ] as const satisfies readonly (keyof ScrcpyOptionsInit1_17)[];\r\n\r\n    public static parseEncoder(\r\n        line: string,\r\n        encoderNameRegex: RegExp\r\n    ): ScrcpyEncoder | undefined {\r\n        const match = line.match(encoderNameRegex);\r\n        if (match) {\r\n            return { type: \"video\", name: match[1]! };\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    public override get defaults(): Required<ScrcpyOptionsInit1_17> {\r\n        return ScrcpyOptions1_17.DEFAULTS;\r\n    }\r\n\r\n    public constructor(init: ScrcpyOptionsInit1_17) {\r\n        super(new ScrcpyOptions1_16(init), {\r\n            ...ScrcpyOptions1_17.DEFAULTS,\r\n            ...init,\r\n        });\r\n    }\r\n\r\n    public override serialize(): string[] {\r\n        return ScrcpyOptions1_16.serialize(\r\n            this.value,\r\n            ScrcpyOptions1_17.SERIALIZE_ORDER\r\n        );\r\n    }\r\n\r\n    public override setListEncoders() {\r\n        // Set to an invalid value\r\n        // Server will print valid values before crashing\r\n        // (server will crash after opening video and control sockets)\r\n        this.value.encoderName = \"_\";\r\n    }\r\n\r\n    public override parseEncoder(line: string): ScrcpyEncoder | undefined {\r\n        return ScrcpyOptions1_17.parseEncoder(\r\n            line,\r\n            /\\s+scrcpy --encoder-name '(.*?)'/\r\n        );\r\n    }\r\n}\r\n","import Struct, { placeholder } from \"@yume-chan/struct\";\r\n\r\nimport type {\r\n    AndroidKeyEventAction,\r\n    ScrcpyBackOrScreenOnControlMessage,\r\n} from \"../control/index.js\";\r\nimport { ScrcpyControlMessageType } from \"../control/index.js\";\r\n\r\nimport {\r\n    SCRCPY_CONTROL_MESSAGE_TYPES_1_16,\r\n    ScrcpyBackOrScreenOnControlMessage1_16,\r\n    ScrcpyLogLevel1_16,\r\n    ScrcpyOptions1_16,\r\n    ScrcpyVideoOrientation1_16,\r\n} from \"./1_16/index.js\";\r\nimport type { ScrcpyOptionsInit1_17 } from \"./1_17.js\";\r\nimport { ScrcpyOptions1_17 } from \"./1_17.js\";\r\nimport type { ScrcpyEncoder } from \"./types.js\";\r\nimport { ScrcpyOptionsBase } from \"./types.js\";\r\n\r\nexport enum ScrcpyLogLevel1_18 {\r\n    Verbose = \"verbose\",\r\n    Debug = \"debug\",\r\n    Info = \"info\",\r\n    Warn = \"warn\",\r\n    Error = \"error\",\r\n}\r\n\r\nexport enum ScrcpyVideoOrientation1_18 {\r\n    Initial = -2,\r\n    Unlocked = -1,\r\n    Portrait = 0,\r\n    Landscape = 1,\r\n    PortraitFlipped = 2,\r\n    LandscapeFlipped = 3,\r\n}\r\n\r\nexport interface ScrcpyOptionsInit1_18\r\n    extends Omit<ScrcpyOptionsInit1_17, \"logLevel\" | \"lockVideoOrientation\"> {\r\n    logLevel?: ScrcpyLogLevel1_18;\r\n\r\n    lockVideoOrientation?: ScrcpyVideoOrientation1_18;\r\n\r\n    powerOffOnClose?: boolean;\r\n}\r\n\r\nexport const ScrcpyBackOrScreenOnControlMessage1_18 = new Struct()\r\n    .concat(ScrcpyBackOrScreenOnControlMessage1_16)\r\n    .uint8(\"action\", placeholder<AndroidKeyEventAction>());\r\n\r\nexport type ScrcpyBackOrScreenOnControlMessage1_18 =\r\n    (typeof ScrcpyBackOrScreenOnControlMessage1_18)[\"TInit\"];\r\n\r\nexport const SCRCPY_CONTROL_MESSAGE_TYPES_1_18 =\r\n    SCRCPY_CONTROL_MESSAGE_TYPES_1_16.slice();\r\nSCRCPY_CONTROL_MESSAGE_TYPES_1_18.splice(\r\n    6,\r\n    0,\r\n    ScrcpyControlMessageType.ExpandSettingPanel\r\n);\r\n\r\nconst LOG_LEVEL_MAP = {\r\n    [ScrcpyLogLevel1_18.Verbose]: ScrcpyLogLevel1_16.Debug,\r\n    [ScrcpyLogLevel1_18.Debug]: ScrcpyLogLevel1_16.Debug,\r\n    [ScrcpyLogLevel1_18.Info]: ScrcpyLogLevel1_16.Info,\r\n    [ScrcpyLogLevel1_18.Warn]: ScrcpyLogLevel1_16.Warn,\r\n    [ScrcpyLogLevel1_18.Error]: ScrcpyLogLevel1_16.Error,\r\n};\r\n\r\nconst VIDEO_ORIENTATION_MAP = {\r\n    [ScrcpyVideoOrientation1_18.Initial]: ScrcpyVideoOrientation1_16.Unlocked,\r\n    [ScrcpyVideoOrientation1_18.Unlocked]: ScrcpyVideoOrientation1_16.Unlocked,\r\n    [ScrcpyVideoOrientation1_18.Portrait]: ScrcpyVideoOrientation1_16.Portrait,\r\n    [ScrcpyVideoOrientation1_18.Landscape]:\r\n        ScrcpyVideoOrientation1_16.Landscape,\r\n    [ScrcpyVideoOrientation1_18.PortraitFlipped]:\r\n        ScrcpyVideoOrientation1_16.PortraitFlipped,\r\n    [ScrcpyVideoOrientation1_18.LandscapeFlipped]:\r\n        ScrcpyVideoOrientation1_16.LandscapeFlipped,\r\n};\r\nexport class ScrcpyOptions1_18 extends ScrcpyOptionsBase<\r\n    ScrcpyOptionsInit1_18,\r\n    ScrcpyOptions1_17\r\n> {\r\n    public static readonly DEFAULTS = {\r\n        ...ScrcpyOptions1_17.DEFAULTS,\r\n        logLevel: ScrcpyLogLevel1_18.Debug,\r\n        lockVideoOrientation: ScrcpyVideoOrientation1_18.Unlocked,\r\n        powerOffOnClose: false,\r\n    } as const satisfies Required<ScrcpyOptionsInit1_18>;\r\n\r\n    public static readonly SERIALIZE_ORDER = [\r\n        ...ScrcpyOptions1_17.SERIALIZE_ORDER,\r\n        \"powerOffOnClose\",\r\n    ] as const satisfies readonly (keyof ScrcpyOptionsInit1_18)[];\r\n\r\n    public override get defaults(): Required<ScrcpyOptionsInit1_18> {\r\n        return ScrcpyOptions1_18.DEFAULTS;\r\n    }\r\n\r\n    public override get controlMessageTypes() {\r\n        return SCRCPY_CONTROL_MESSAGE_TYPES_1_18;\r\n    }\r\n\r\n    constructor(init: ScrcpyOptionsInit1_18) {\r\n        const value = { ...ScrcpyOptions1_18.DEFAULTS, ...init };\r\n        super(\r\n            new ScrcpyOptions1_17({\r\n                ...init,\r\n                logLevel: LOG_LEVEL_MAP[value.logLevel],\r\n                lockVideoOrientation:\r\n                    VIDEO_ORIENTATION_MAP[value.lockVideoOrientation],\r\n            }),\r\n            value\r\n        );\r\n    }\r\n\r\n    public override serialize(): string[] {\r\n        return ScrcpyOptions1_16.serialize(\r\n            this.value,\r\n            ScrcpyOptions1_18.SERIALIZE_ORDER\r\n        );\r\n    }\r\n\r\n    public override parseEncoder(line: string): ScrcpyEncoder | undefined {\r\n        return ScrcpyOptions1_17.parseEncoder(\r\n            line,\r\n            /\\s+scrcpy --encoder '(.*?)'/\r\n        );\r\n    }\r\n\r\n    public override serializeBackOrScreenOnControlMessage(\r\n        message: ScrcpyBackOrScreenOnControlMessage\r\n    ) {\r\n        return ScrcpyBackOrScreenOnControlMessage1_18.serialize(message);\r\n    }\r\n}\r\n","// cspell: ignore autosync\r\n\r\nimport Struct, { placeholder } from \"@yume-chan/struct\";\r\n\r\nimport type { ScrcpySetClipboardControlMessage } from \"../control/index.js\";\r\n\r\nimport type { ScrcpyOptionsInit1_18 } from \"./1_18.js\";\r\nimport { ScrcpyOptions1_18 } from \"./1_18.js\";\r\nimport { ScrcpyOptionsBase, toScrcpyOptionValue } from \"./types.js\";\r\n\r\nexport interface ScrcpyOptionsInit1_21 extends ScrcpyOptionsInit1_18 {\r\n    clipboardAutosync?: boolean;\r\n}\r\n\r\nfunction toSnakeCase(input: string): string {\r\n    return input.replace(/([A-Z])/g, \"_$1\").toLowerCase();\r\n}\r\n\r\nexport const ScrcpySetClipboardControlMessage1_21 = new Struct()\r\n    .uint8(\"type\")\r\n    .uint64(\"sequence\")\r\n    .int8(\"paste\", placeholder<boolean>())\r\n    .uint32(\"length\")\r\n    .string(\"content\", { lengthField: \"length\" });\r\n\r\nexport type ScrcpySetClipboardControlMessage1_21 =\r\n    (typeof ScrcpySetClipboardControlMessage1_21)[\"TInit\"];\r\n\r\nexport class ScrcpyOptions1_21 extends ScrcpyOptionsBase<\r\n    ScrcpyOptionsInit1_21,\r\n    ScrcpyOptions1_18\r\n> {\r\n    public static readonly DEFAULTS = {\r\n        ...ScrcpyOptions1_18.DEFAULTS,\r\n        clipboardAutosync: true,\r\n    } as const satisfies Required<ScrcpyOptionsInit1_21>;\r\n\r\n    public static serialize<T extends object>(\r\n        options: T,\r\n        defaults: Required<T>\r\n    ): string[] {\r\n        // 1.21 changed the format of arguments\r\n        const result: string[] = [];\r\n        for (const [key, value] of Object.entries(options)) {\r\n            const serializedValue = toScrcpyOptionValue(value, undefined);\r\n            if (!serializedValue) {\r\n                continue;\r\n            }\r\n\r\n            const defaultValue = toScrcpyOptionValue(\r\n                defaults[key as keyof T],\r\n                undefined\r\n            );\r\n            if (serializedValue == defaultValue) {\r\n                continue;\r\n            }\r\n\r\n            result.push(`${toSnakeCase(key)}=${serializedValue}`);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public override get defaults(): Required<ScrcpyOptionsInit1_21> {\r\n        return ScrcpyOptions1_21.DEFAULTS;\r\n    }\r\n\r\n    public constructor(init: ScrcpyOptionsInit1_21) {\r\n        super(new ScrcpyOptions1_18(init), {\r\n            ...ScrcpyOptions1_21.DEFAULTS,\r\n            ...init,\r\n        });\r\n    }\r\n\r\n    public override serialize(): string[] {\r\n        return ScrcpyOptions1_21.serialize(this.value, this.defaults);\r\n    }\r\n\r\n    public override serializeSetClipboardControlMessage(\r\n        message: ScrcpySetClipboardControlMessage\r\n    ): Uint8Array {\r\n        return ScrcpySetClipboardControlMessage1_21.serialize(message);\r\n    }\r\n}\r\n","import Struct from \"@yume-chan/struct\";\r\n\r\nimport {\r\n    ScrcpyInjectScrollControlMessage1_16,\r\n    ScrcpyScrollController1_16,\r\n} from \"../1_16/index.js\";\r\n\r\nexport const ScrcpyInjectScrollControlMessage1_22 = new Struct()\r\n    .concat(ScrcpyInjectScrollControlMessage1_16)\r\n    .int32(\"buttons\");\r\n\r\nexport type ScrcpyInjectScrollControlMessage1_22 =\r\n    (typeof ScrcpyInjectScrollControlMessage1_22)[\"TInit\"];\r\n\r\nexport class ScrcpyScrollController1_22 extends ScrcpyScrollController1_16 {\r\n    public override serializeScrollMessage(\r\n        message: ScrcpyInjectScrollControlMessage1_22\r\n    ): Uint8Array | undefined {\r\n        const processed = this.processMessage(message);\r\n        if (!processed) {\r\n            return undefined;\r\n        }\r\n\r\n        return ScrcpyInjectScrollControlMessage1_22.serialize(processed);\r\n    }\r\n}\r\n","import type { ReadableStream } from \"@yume-chan/stream-extra\";\r\nimport type { ValueOrPromise } from \"@yume-chan/struct\";\r\n\r\nimport type { ScrcpyScrollController } from \"../1_16/index.js\";\r\nimport { ScrcpyOptions1_21 } from \"../1_21.js\";\r\nimport type { ScrcpyVideoStream } from \"../codec.js\";\r\nimport { ScrcpyVideoCodecId } from \"../codec.js\";\r\nimport { ScrcpyOptionsBase } from \"../types.js\";\r\n\r\nimport type { ScrcpyOptionsInit1_22 } from \"./init.js\";\r\nimport { ScrcpyScrollController1_22 } from \"./scroll.js\";\r\n\r\nexport class ScrcpyOptions1_22 extends ScrcpyOptionsBase<\r\n    ScrcpyOptionsInit1_22,\r\n    ScrcpyOptions1_21\r\n> {\r\n    public static readonly DEFAULTS = {\r\n        ...ScrcpyOptions1_21.DEFAULTS,\r\n        downsizeOnError: true,\r\n        sendDeviceMeta: true,\r\n        sendDummyByte: true,\r\n    } as const satisfies Required<ScrcpyOptionsInit1_22>;\r\n\r\n    public override get defaults(): Required<ScrcpyOptionsInit1_22> {\r\n        return ScrcpyOptions1_22.DEFAULTS;\r\n    }\r\n\r\n    public constructor(init: ScrcpyOptionsInit1_22) {\r\n        super(new ScrcpyOptions1_21(init), {\r\n            ...ScrcpyOptions1_22.DEFAULTS,\r\n            ...init,\r\n        });\r\n    }\r\n\r\n    public override parseVideoStreamMetadata(\r\n        stream: ReadableStream<Uint8Array>\r\n    ): ValueOrPromise<ScrcpyVideoStream> {\r\n        if (!this.value.sendDeviceMeta) {\r\n            return { stream, metadata: { codec: ScrcpyVideoCodecId.H264 } };\r\n        } else {\r\n            return this._base.parseVideoStreamMetadata(stream);\r\n        }\r\n    }\r\n\r\n    public override serialize(): string[] {\r\n        return ScrcpyOptions1_21.serialize(this.value, this.defaults);\r\n    }\r\n\r\n    public override createScrollController(): ScrcpyScrollController {\r\n        return new ScrcpyScrollController1_22();\r\n    }\r\n}\r\n","export * from \"./init.js\";\r\nexport * from \"./options.js\";\r\nexport * from \"./scroll.js\";\r\n","import { TransformStream } from \"@yume-chan/stream-extra\";\r\n\r\nimport { ScrcpyOptions1_21 } from \"./1_21.js\";\r\nimport type { ScrcpyOptionsInit1_22 } from \"./1_22/index.js\";\r\nimport { ScrcpyOptions1_22 } from \"./1_22/index.js\";\r\nimport type { ScrcpyMediaStreamPacket } from \"./codec.js\";\r\nimport { ScrcpyOptionsBase } from \"./types.js\";\r\n\r\nexport interface ScrcpyOptionsInit1_23 extends ScrcpyOptionsInit1_22 {\r\n    cleanup?: boolean;\r\n}\r\n\r\nconst KEYFRAME_PTS = 1n << 62n;\r\n\r\nexport class ScrcpyOptions1_23 extends ScrcpyOptionsBase<\r\n    ScrcpyOptionsInit1_23,\r\n    ScrcpyOptions1_22\r\n> {\r\n    public static readonly DEFAULTS = {\r\n        ...ScrcpyOptions1_22.DEFAULTS,\r\n        cleanup: true,\r\n    } as const satisfies Required<ScrcpyOptionsInit1_23>;\r\n\r\n    public override get defaults(): Required<ScrcpyOptionsInit1_23> {\r\n        return ScrcpyOptions1_23.DEFAULTS;\r\n    }\r\n\r\n    public constructor(init: ScrcpyOptionsInit1_22) {\r\n        super(new ScrcpyOptions1_22(init), {\r\n            ...ScrcpyOptions1_23.DEFAULTS,\r\n            ...init,\r\n        });\r\n    }\r\n\r\n    public override serialize(): string[] {\r\n        return ScrcpyOptions1_21.serialize(this.value, this.defaults);\r\n    }\r\n\r\n    public override createMediaStreamTransformer(): TransformStream<\r\n        Uint8Array,\r\n        ScrcpyMediaStreamPacket\r\n    > {\r\n        const stream = this._base.createMediaStreamTransformer();\r\n        return {\r\n            writable: stream.writable,\r\n            readable: stream.readable.pipeThrough(\r\n                new TransformStream({\r\n                    transform(packet, controller): void {\r\n                        if (packet.type !== \"data\") {\r\n                            controller.enqueue(packet);\r\n                            return;\r\n                        }\r\n\r\n                        if (\r\n                            packet.pts !== undefined &&\r\n                            packet.pts & KEYFRAME_PTS\r\n                        ) {\r\n                            packet.keyframe = true;\r\n                            packet.pts &= ~KEYFRAME_PTS;\r\n                        }\r\n\r\n                        controller.enqueue(packet);\r\n                    },\r\n                })\r\n            ),\r\n        };\r\n    }\r\n}\r\n","import { ScrcpyOptions1_21 } from \"./1_21.js\";\r\nimport type { ScrcpyOptionsInit1_23 } from \"./1_23.js\";\r\nimport { ScrcpyOptions1_23 } from \"./1_23.js\";\r\nimport { ScrcpyOptionsBase } from \"./types.js\";\r\n\r\nexport interface ScrcpyOptionsInit1_24 extends ScrcpyOptionsInit1_23 {\r\n    powerOn?: boolean;\r\n}\r\n\r\nexport class ScrcpyOptions1_24 extends ScrcpyOptionsBase<\r\n    ScrcpyOptionsInit1_24,\r\n    ScrcpyOptions1_23\r\n> {\r\n    public static readonly DEFAULTS = {\r\n        ...ScrcpyOptions1_23.DEFAULTS,\r\n        powerOn: true,\r\n    } as const satisfies Required<ScrcpyOptionsInit1_24>;\r\n\r\n    public override get defaults(): Required<ScrcpyOptionsInit1_24> {\r\n        return ScrcpyOptions1_24.DEFAULTS;\r\n    }\r\n\r\n    public constructor(init: ScrcpyOptionsInit1_24) {\r\n        super(new ScrcpyOptions1_23(init), {\r\n            ...ScrcpyOptions1_24.DEFAULTS,\r\n            ...init,\r\n        });\r\n    }\r\n\r\n    public override serialize(): string[] {\r\n        return ScrcpyOptions1_21.serialize(this.value, this.defaults);\r\n    }\r\n}\r\n","import Struct, {\r\n    NumberFieldDefinition,\r\n    NumberFieldType,\r\n} from \"@yume-chan/struct\";\r\n\r\nimport type { ScrcpyInjectScrollControlMessage } from \"../../control/index.js\";\r\nimport { ScrcpyControlMessageType } from \"../../control/index.js\";\r\nimport type { ScrcpyScrollController } from \"../1_16/index.js\";\r\nimport { clamp } from \"../1_16/index.js\";\r\n\r\nexport const ScrcpyFloatToInt16NumberType: NumberFieldType = {\r\n    size: 2,\r\n    signed: true,\r\n    deserialize(array, littleEndian) {\r\n        const value = NumberFieldType.Int16.deserialize(array, littleEndian);\r\n        // https://github.com/Genymobile/scrcpy/blob/1f138aef41de651668043b32c4effc2d4adbfc44/server/src/main/java/com/genymobile/scrcpy/Binary.java#L34\r\n        return value === 0x7fff ? 1 : value / 0x8000;\r\n    },\r\n    serialize(dataView, offset, value, littleEndian) {\r\n        // https://github.com/Genymobile/scrcpy/blob/1f138aef41de651668043b32c4effc2d4adbfc44/app/src/util/binary.h#L65\r\n        value = clamp(value, -1, 1);\r\n        value = value === 1 ? 0x7fff : value * 0x8000;\r\n        NumberFieldType.Int16.serialize(dataView, offset, value, littleEndian);\r\n    },\r\n};\r\n\r\nconst ScrcpyFloatToInt16FieldDefinition = new NumberFieldDefinition(\r\n    ScrcpyFloatToInt16NumberType\r\n);\r\n\r\nexport const ScrcpyInjectScrollControlMessage1_25 = new Struct()\r\n    .uint8(\"type\", ScrcpyControlMessageType.InjectScroll as const)\r\n    .uint32(\"pointerX\")\r\n    .uint32(\"pointerY\")\r\n    .uint16(\"screenWidth\")\r\n    .uint16(\"screenHeight\")\r\n    .field(\"scrollX\", ScrcpyFloatToInt16FieldDefinition)\r\n    .field(\"scrollY\", ScrcpyFloatToInt16FieldDefinition)\r\n    .int32(\"buttons\");\r\n\r\nexport type ScrcpyInjectScrollControlMessage1_25 =\r\n    (typeof ScrcpyInjectScrollControlMessage1_25)[\"TInit\"];\r\n\r\nexport class ScrcpyScrollController1_25 implements ScrcpyScrollController {\r\n    serializeScrollMessage(\r\n        message: ScrcpyInjectScrollControlMessage\r\n    ): Uint8Array | undefined {\r\n        return ScrcpyInjectScrollControlMessage1_25.serialize(message);\r\n    }\r\n}\r\n","import type { ScrcpyScrollController } from \"../1_16/index.js\";\r\nimport { ScrcpyOptions1_21 } from \"../1_21.js\";\r\nimport type { ScrcpyOptionsInit1_24 } from \"../1_24.js\";\r\nimport { ScrcpyOptions1_24 } from \"../1_24.js\";\r\nimport { ScrcpyOptionsBase } from \"../types.js\";\r\n\r\nimport { ScrcpyScrollController1_25 } from \"./scroll.js\";\r\n\r\nexport class ScrcpyOptions1_25 extends ScrcpyOptionsBase<\r\n    ScrcpyOptionsInit1_24,\r\n    ScrcpyOptions1_24\r\n> {\r\n    public override get defaults(): Required<ScrcpyOptionsInit1_24> {\r\n        return ScrcpyOptions1_24.DEFAULTS;\r\n    }\r\n\r\n    public constructor(init: ScrcpyOptionsInit1_24) {\r\n        super(new ScrcpyOptions1_24(init), {\r\n            ...ScrcpyOptions1_24.DEFAULTS,\r\n            ...init,\r\n        });\r\n    }\r\n\r\n    public override serialize(): string[] {\r\n        return ScrcpyOptions1_21.serialize(this.value, this.defaults);\r\n    }\r\n\r\n    public override createScrollController(): ScrcpyScrollController {\r\n        return new ScrcpyScrollController1_25();\r\n    }\r\n}\r\n","export * from \"./options.js\";\r\nexport * from \"./scroll.js\";\r\n","import type { ReadableStream } from \"@yume-chan/stream-extra\";\r\nimport {\r\n    BufferedReadableStream,\r\n    PushReadableStream,\r\n} from \"@yume-chan/stream-extra\";\r\nimport type { ValueOrPromise } from \"@yume-chan/struct\";\r\nimport Struct, { NumberFieldType, placeholder } from \"@yume-chan/struct\";\r\n\r\nimport type {\r\n    AndroidMotionEventAction,\r\n    ScrcpyInjectTouchControlMessage,\r\n} from \"../control/index.js\";\r\n\r\nimport {\r\n    CodecOptions,\r\n    ScrcpyFloatToUint16FieldDefinition,\r\n    ScrcpyOptions1_16,\r\n} from \"./1_16/index.js\";\r\nimport { ScrcpyOptions1_21 } from \"./1_21.js\";\r\nimport type { ScrcpyOptionsInit1_24 } from \"./1_24.js\";\r\nimport { ScrcpyOptions1_24 } from \"./1_24.js\";\r\nimport { ScrcpyOptions1_25 } from \"./1_25/index.js\";\r\nimport type { ScrcpyAudioStreamMetadata, ScrcpyVideoStream } from \"./codec.js\";\r\nimport { ScrcpyAudioCodec, ScrcpyVideoCodecId } from \"./codec.js\";\r\nimport type {\r\n    ScrcpyDisplay,\r\n    ScrcpyEncoder,\r\n    ScrcpyOptionValue,\r\n} from \"./types.js\";\r\nimport { ScrcpyOptionsBase } from \"./types.js\";\r\n\r\nexport const ScrcpyInjectTouchControlMessage2_0 = new Struct()\r\n    .uint8(\"type\")\r\n    .uint8(\"action\", placeholder<AndroidMotionEventAction>())\r\n    .uint64(\"pointerId\")\r\n    .uint32(\"pointerX\")\r\n    .uint32(\"pointerY\")\r\n    .uint16(\"screenWidth\")\r\n    .uint16(\"screenHeight\")\r\n    .field(\"pressure\", ScrcpyFloatToUint16FieldDefinition)\r\n    .uint32(\"actionButton\")\r\n    .uint32(\"buttons\");\r\n\r\nexport type ScrcpyInjectTouchControlMessage2_0 =\r\n    (typeof ScrcpyInjectTouchControlMessage2_0)[\"TInit\"];\r\n\r\nexport class ScrcpyInstanceId implements ScrcpyOptionValue {\r\n    public static readonly NONE = new ScrcpyInstanceId(-1);\r\n\r\n    public static random(): ScrcpyInstanceId {\r\n        // A random 31-bit unsigned integer\r\n        return new ScrcpyInstanceId((Math.random() * 0x80000000) | 0);\r\n    }\r\n\r\n    public value: number;\r\n\r\n    public constructor(value: number) {\r\n        this.value = value;\r\n    }\r\n\r\n    public toOptionValue(): string | undefined {\r\n        if (this.value < 0) {\r\n            return undefined;\r\n        }\r\n        return this.value.toString(16);\r\n    }\r\n}\r\n\r\nexport interface ScrcpyOptionsInit2_0\r\n    extends Omit<\r\n        ScrcpyOptionsInit1_24,\r\n        \"bitRate\" | \"codecOptions\" | \"encoderName\"\r\n    > {\r\n    scid?: ScrcpyInstanceId;\r\n\r\n    videoCodec?: \"h264\" | \"h265\" | \"av1\";\r\n    videoBitRate?: number;\r\n    videoCodecOptions?: CodecOptions;\r\n    videoEncoder?: string;\r\n\r\n    audio?: boolean;\r\n    audioCodec?: \"opus\" | \"aac\" | \"raw\";\r\n    audioBitRate?: number;\r\n    audioCodecOptions?: CodecOptions;\r\n    audioEncoder?: string;\r\n\r\n    listEncoders?: boolean;\r\n    listDisplays?: boolean;\r\n    sendCodecMeta?: boolean;\r\n}\r\n\r\nfunction omit<T extends object, K extends keyof T>(\r\n    obj: T,\r\n    keys: K[]\r\n): Omit<T, K> {\r\n    const result: Record<PropertyKey, unknown> = {};\r\n    for (const key in obj) {\r\n        if (!keys.includes(key as keyof T as K)) {\r\n            result[key] = obj[key];\r\n        }\r\n    }\r\n    return result as Omit<T, K>;\r\n}\r\n\r\nexport class ScrcpyOptions2_0 extends ScrcpyOptionsBase<\r\n    ScrcpyOptionsInit2_0,\r\n    ScrcpyOptions1_25\r\n> {\r\n    public static readonly DEFAULTS = {\r\n        ...omit(ScrcpyOptions1_24.DEFAULTS, [\r\n            \"bitRate\",\r\n            \"codecOptions\",\r\n            \"encoderName\",\r\n        ]),\r\n        scid: ScrcpyInstanceId.NONE,\r\n\r\n        videoCodec: \"h264\",\r\n        videoBitRate: 8000000,\r\n        videoCodecOptions: new CodecOptions(),\r\n        videoEncoder: \"\",\r\n\r\n        audio: true,\r\n        audioCodec: \"opus\",\r\n        audioBitRate: 128000,\r\n        audioCodecOptions: new CodecOptions(),\r\n        audioEncoder: \"\",\r\n\r\n        listEncoders: false,\r\n        listDisplays: false,\r\n        sendCodecMeta: true,\r\n    } as const satisfies Required<ScrcpyOptionsInit2_0>;\r\n\r\n    public override get defaults(): Required<ScrcpyOptionsInit2_0> {\r\n        return ScrcpyOptions2_0.DEFAULTS;\r\n    }\r\n\r\n    public constructor(init: ScrcpyOptionsInit2_0) {\r\n        super(new ScrcpyOptions1_25(init), {\r\n            ...ScrcpyOptions2_0.DEFAULTS,\r\n            ...init,\r\n        });\r\n    }\r\n\r\n    public override serialize(): string[] {\r\n        return ScrcpyOptions1_21.serialize(this.value, this.defaults);\r\n    }\r\n\r\n    public override setListEncoders(): void {\r\n        this.value.listEncoders = true;\r\n    }\r\n\r\n    public override setListDisplays(): void {\r\n        this.value.listDisplays = true;\r\n    }\r\n\r\n    public override parseEncoder(line: string): ScrcpyEncoder | undefined {\r\n        let match = line.match(\r\n            /\\s+--video-codec=(.*)\\s+--video-encoder='(.*)'/\r\n        );\r\n        if (match) {\r\n            return {\r\n                type: \"video\",\r\n                codec: match[1]!,\r\n                name: match[2]!,\r\n            };\r\n        }\r\n\r\n        match = line.match(/\\s+--audio-codec=(.*)\\s+--audio-encoder='(.*)'/);\r\n        if (match) {\r\n            return {\r\n                type: \"audio\",\r\n                codec: match[1]!,\r\n                name: match[2]!,\r\n            };\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    public override parseDisplay(line: string): ScrcpyDisplay | undefined {\r\n        const match = line.match(/\\s+--display=(\\d+)\\s+\\((.*?)\\)/);\r\n        if (match) {\r\n            const display: ScrcpyDisplay = {\r\n                id: Number.parseInt(match[1]!, 10),\r\n            };\r\n            if (match[2] !== \"size unknown\") {\r\n                display.resolution = match[2]!;\r\n            }\r\n            return display;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    public override parseVideoStreamMetadata(\r\n        stream: ReadableStream<Uint8Array>\r\n    ): ValueOrPromise<ScrcpyVideoStream> {\r\n        const { sendDeviceMeta, sendCodecMeta } = this.value;\r\n        if (!sendDeviceMeta && !sendCodecMeta) {\r\n            let codec: ScrcpyVideoCodecId;\r\n            switch (this.value.videoCodec) {\r\n                case \"h264\":\r\n                    codec = ScrcpyVideoCodecId.H264;\r\n                    break;\r\n                case \"h265\":\r\n                    codec = ScrcpyVideoCodecId.H265;\r\n                    break;\r\n                case \"av1\":\r\n                    codec = ScrcpyVideoCodecId.AV1;\r\n                    break;\r\n            }\r\n            return { stream, metadata: { codec } };\r\n        }\r\n\r\n        return (async () => {\r\n            const buffered = new BufferedReadableStream(stream);\r\n\r\n            // `sendDeviceMeta` now only contains device name,\r\n            // can't use `super.parseVideoStreamMetadata` here\r\n            let deviceName: string | undefined;\r\n            if (sendDeviceMeta) {\r\n                deviceName = await ScrcpyOptions1_16.parseCString(buffered, 64);\r\n            }\r\n\r\n            let codec: ScrcpyVideoCodecId;\r\n            let width: number | undefined;\r\n            let height: number | undefined;\r\n            if (sendCodecMeta) {\r\n                codec = await ScrcpyOptions1_16.parseUint32BE(buffered);\r\n                width = await ScrcpyOptions1_16.parseUint32BE(buffered);\r\n                height = await ScrcpyOptions1_16.parseUint32BE(buffered);\r\n            } else {\r\n                switch (this.value.videoCodec) {\r\n                    case \"h264\":\r\n                        codec = ScrcpyVideoCodecId.H264;\r\n                        break;\r\n                    case \"h265\":\r\n                        codec = ScrcpyVideoCodecId.H265;\r\n                        break;\r\n                    case \"av1\":\r\n                        codec = ScrcpyVideoCodecId.AV1;\r\n                        break;\r\n                }\r\n            }\r\n\r\n            return {\r\n                stream: buffered.release(),\r\n                metadata: { deviceName, codec, width, height },\r\n            };\r\n        })();\r\n    }\r\n\r\n    public override parseAudioStreamMetadata(\r\n        stream: ReadableStream<Uint8Array>\r\n    ): ValueOrPromise<ScrcpyAudioStreamMetadata> {\r\n        return (async (): Promise<ScrcpyAudioStreamMetadata> => {\r\n            const buffered = new BufferedReadableStream(stream);\r\n            const buffer = await buffered.readExactly(\r\n                NumberFieldType.Uint32.size\r\n            );\r\n\r\n            const codecMetadataValue = NumberFieldType.Uint32.deserialize(\r\n                buffer,\r\n                false\r\n            );\r\n            // Server will send `0x00_00_00_00` and `0x00_00_00_01` even if `sendCodecMeta` is false\r\n            switch (codecMetadataValue) {\r\n                case 0x00_00_00_00:\r\n                    return {\r\n                        type: \"disabled\",\r\n                    };\r\n                case 0x00_00_00_01:\r\n                    return {\r\n                        type: \"errored\",\r\n                    };\r\n            }\r\n\r\n            if (this.value.sendCodecMeta) {\r\n                let codec: ScrcpyAudioCodec;\r\n                switch (codecMetadataValue) {\r\n                    case ScrcpyAudioCodec.OPUS.metadataValue:\r\n                        codec = ScrcpyAudioCodec.OPUS;\r\n                        break;\r\n                    case ScrcpyAudioCodec.AAC.metadataValue:\r\n                        codec = ScrcpyAudioCodec.AAC;\r\n                        break;\r\n                    case ScrcpyAudioCodec.RAW.metadataValue:\r\n                        codec = ScrcpyAudioCodec.RAW;\r\n                        break;\r\n                    default:\r\n                        throw new Error(\r\n                            `Unknown audio codec metadata value: ${codecMetadataValue}`\r\n                        );\r\n                }\r\n                return {\r\n                    type: \"success\",\r\n                    codec,\r\n                    stream: buffered.release(),\r\n                };\r\n            }\r\n\r\n            // Infer codec from `audioCodec` option\r\n            let codec: ScrcpyAudioCodec;\r\n            switch (this.value.audioCodec) {\r\n                case \"opus\":\r\n                    codec = ScrcpyAudioCodec.OPUS;\r\n                    break;\r\n                case \"aac\":\r\n                    codec = ScrcpyAudioCodec.AAC;\r\n                    break;\r\n                case \"raw\":\r\n                    codec = ScrcpyAudioCodec.RAW;\r\n                    break;\r\n            }\r\n            return {\r\n                type: \"success\",\r\n                codec,\r\n                stream: new PushReadableStream<Uint8Array>(\r\n                    async (controller) => {\r\n                        // Put the first 4 bytes back\r\n                        await controller.enqueue(buffer);\r\n\r\n                        const stream = buffered.release();\r\n                        const reader = stream.getReader();\r\n                        while (true) {\r\n                            const { done, value } = await reader.read();\r\n                            if (done) {\r\n                                break;\r\n                            }\r\n                            await controller.enqueue(value);\r\n                        }\r\n                    }\r\n                ),\r\n            };\r\n        })();\r\n    }\r\n\r\n    public override serializeInjectTouchControlMessage(\r\n        message: ScrcpyInjectTouchControlMessage\r\n    ): Uint8Array {\r\n        return ScrcpyInjectTouchControlMessage2_0.serialize(message);\r\n    }\r\n}\r\n","import { ScrcpyOptions1_21 } from \"./1_21.js\";\r\nimport type { ScrcpyOptionsInit2_0 } from \"./2_0.js\";\r\nimport { ScrcpyOptions2_0 } from \"./2_0.js\";\r\nimport { ScrcpyOptionsBase } from \"./types.js\";\r\n\r\nexport interface ScrcpyOptionsInit2_1 extends ScrcpyOptionsInit2_0 {\r\n    video?: boolean;\r\n    audioSource?: \"output\" | \"mic\";\r\n}\r\n\r\nexport class ScrcpyOptions2_1 extends ScrcpyOptionsBase<\r\n    ScrcpyOptionsInit2_1,\r\n    ScrcpyOptions2_0\r\n> {\r\n    public static readonly DEFAULTS = {\r\n        ...ScrcpyOptions2_0.DEFAULTS,\r\n        video: true,\r\n        audioSource: \"output\",\r\n    } as const satisfies Required<ScrcpyOptionsInit2_1>;\r\n\r\n    public override get defaults(): Required<ScrcpyOptionsInit2_1> {\r\n        return ScrcpyOptions2_1.DEFAULTS;\r\n    }\r\n\r\n    public constructor(init: ScrcpyOptionsInit2_1) {\r\n        super(new ScrcpyOptions2_0(init), {\r\n            ...ScrcpyOptions2_1.DEFAULTS,\r\n            ...init,\r\n        });\r\n    }\r\n\r\n    public override serialize(): string[] {\r\n        return ScrcpyOptions1_21.serialize(this.value, this.defaults);\r\n    }\r\n}\r\n","import { ScrcpyLogLevel1_18, ScrcpyVideoOrientation1_18 } from \"./1_18.js\";\r\nimport type { ScrcpyOptionsInit2_1 } from \"./2_1.js\";\r\nimport { ScrcpyOptions2_1 } from \"./2_1.js\";\r\n\r\nexport const ScrcpyLogLevel = ScrcpyLogLevel1_18;\r\nexport type ScrcpyLogLevel = ScrcpyLogLevel1_18;\r\n\r\nexport const ScrcpyVideoOrientation = ScrcpyVideoOrientation1_18;\r\nexport type ScrcpyVideoOrientation = ScrcpyVideoOrientation1_18;\r\n\r\nexport type ScrcpyOptionsInitLatest = ScrcpyOptionsInit2_1;\r\nexport class ScrcpyOptionsLatest extends ScrcpyOptions2_1 {}\r\n\r\nexport const ScrcpyLatestVersion = \"2.1\";\r\n","export * from \"./1_16/index.js\";\r\nexport * from \"./1_17.js\";\r\nexport * from \"./1_18.js\";\r\nexport * from \"./1_21.js\";\r\nexport * from \"./1_22/index.js\";\r\nexport * from \"./1_23.js\";\r\nexport * from \"./1_24.js\";\r\nexport * from \"./1_25/index.js\";\r\nexport * from \"./2_0.js\";\r\nexport * from \"./2_1.js\";\r\nexport * from \"./codec.js\";\r\nexport * from \"./latest.js\";\r\nexport * from \"./types.js\";\r\n","export * from \"./codec/index.js\";\r\nexport * from \"./control/index.js\";\r\nexport * from \"./device-message/index.js\";\r\nexport * from \"./options/index.js\";\r\n","import type {\r\n    ScrcpyMediaStreamDataPacket,\r\n    ScrcpyMediaStreamPacket,\r\n} from \"@yume-chan/scrcpy\";\r\nimport {\r\n    ScrcpyVideoCodecId,\r\n    h264ParseConfiguration,\r\n    h265ParseConfiguration,\r\n} from \"@yume-chan/scrcpy\";\r\nimport type {\r\n    ScrcpyVideoDecoder,\r\n    ScrcpyVideoDecoderCapability,\r\n} from \"@yume-chan/scrcpy-decoder-tinyh264\";\r\nimport { WritableStream } from \"@yume-chan/stream-extra\";\r\n\r\nfunction toHex(value: number) {\r\n    return value.toString(16).padStart(2, \"0\").toUpperCase();\r\n}\r\n\r\nfunction toUint32Le(data: Uint8Array, offset: number) {\r\n    return (\r\n        data[offset]! |\r\n        (data[offset + 1]! << 8) |\r\n        (data[offset + 2]! << 16) |\r\n        (data[offset + 3]! << 24)\r\n    );\r\n}\r\n\r\nexport class WebCodecsDecoder implements ScrcpyVideoDecoder {\r\n    public static isSupported() {\r\n        return typeof globalThis.VideoDecoder !== \"undefined\";\r\n    }\r\n\r\n    public static readonly capabilities: Record<\r\n        string,\r\n        ScrcpyVideoDecoderCapability\r\n    > = {\r\n        h264: {},\r\n        h265: {},\r\n    };\r\n\r\n    private _codec: ScrcpyVideoCodecId;\r\n    public get codec() {\r\n        return this._codec;\r\n    }\r\n\r\n    private _writable: WritableStream<ScrcpyMediaStreamPacket>;\r\n    public get writable() {\r\n        return this._writable;\r\n    }\r\n\r\n    private _renderer: HTMLCanvasElement;\r\n    public get renderer() {\r\n        return this._renderer;\r\n    }\r\n\r\n    private _frameRendered = 0;\r\n    public get frameRendered() {\r\n        return this._frameRendered;\r\n    }\r\n\r\n    private _frameSkipped = 0;\r\n    public get frameSkipped() {\r\n        return this._frameSkipped;\r\n    }\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private decoder: VideoDecoder;\r\n    private _config: Uint8Array | undefined;\r\n\r\n    private currentFrameRendered = false;\r\n    private animationFrameId = 0;\r\n\r\n    public constructor(codec: ScrcpyVideoCodecId) {\r\n        this._codec = codec;\r\n\r\n        this._renderer = document.createElement(\"canvas\");\r\n\r\n        this.context = this._renderer.getContext(\"2d\")!;\r\n        this.decoder = new VideoDecoder({\r\n            output: (frame) => {\r\n                if (this.currentFrameRendered) {\r\n                    this._frameSkipped += 1;\r\n                } else {\r\n                    this.currentFrameRendered = true;\r\n                    this._frameRendered += 1;\r\n                }\r\n\r\n                // PERF: H.264 renderer may draw multiple frames in one vertical sync interval to minimize latency.\r\n                // When multiple frames are drawn in one vertical sync interval,\r\n                // only the last one is visible to users.\r\n                // But this ensures users can always see the most up-to-date screen.\r\n                // This is also the behavior of official Scrcpy client.\r\n                // https://github.com/Genymobile/scrcpy/issues/3679\r\n                this.context.drawImage(frame, 0, 0);\r\n                frame.close();\r\n            },\r\n            error(e) {\r\n                void e;\r\n            },\r\n        });\r\n\r\n        this._writable = new WritableStream<ScrcpyMediaStreamPacket>({\r\n            write: (packet) => {\r\n                switch (packet.type) {\r\n                    case \"configuration\":\r\n                        this.configure(packet.data);\r\n                        break;\r\n                    case \"data\":\r\n                        this.decode(packet);\r\n                        break;\r\n                }\r\n            },\r\n        });\r\n\r\n        this.onFramePresented();\r\n    }\r\n\r\n    private onFramePresented = () => {\r\n        this.currentFrameRendered = false;\r\n        this.animationFrameId = requestAnimationFrame(this.onFramePresented);\r\n    };\r\n\r\n    private configure(data: Uint8Array) {\r\n        switch (this._codec) {\r\n            case ScrcpyVideoCodecId.H264: {\r\n                const {\r\n                    profileIndex,\r\n                    constraintSet,\r\n                    levelIndex,\r\n                    croppedWidth,\r\n                    croppedHeight,\r\n                } = h264ParseConfiguration(data);\r\n\r\n                this._renderer.width = croppedWidth;\r\n                this._renderer.height = croppedHeight;\r\n\r\n                // https://www.rfc-editor.org/rfc/rfc6381#section-3.3\r\n                // ISO Base Media File Format Name Space\r\n                const codec = `avc1.${[profileIndex, constraintSet, levelIndex]\r\n                    .map(toHex)\r\n                    .join(\"\")}`;\r\n                this.decoder.configure({\r\n                    codec: codec,\r\n                    optimizeForLatency: true,\r\n                });\r\n                break;\r\n            }\r\n            case ScrcpyVideoCodecId.H265: {\r\n                const {\r\n                    generalProfileSpace,\r\n                    generalProfileIndex,\r\n                    generalProfileCompatibilitySet,\r\n                    generalTierFlag,\r\n                    generalLevelIndex,\r\n                    generalConstraintSet,\r\n                    croppedWidth,\r\n                    croppedHeight,\r\n                } = h265ParseConfiguration(data);\r\n\r\n                this._renderer.width = croppedWidth;\r\n                this._renderer.height = croppedHeight;\r\n\r\n                const codec = [\r\n                    \"hev1\",\r\n                    [\"\", \"A\", \"B\", \"C\"][generalProfileSpace]! +\r\n                        generalProfileIndex.toString(),\r\n                    toUint32Le(generalProfileCompatibilitySet, 0).toString(16),\r\n                    (generalTierFlag ? \"H\" : \"L\") +\r\n                        generalLevelIndex.toString(),\r\n                    toUint32Le(generalConstraintSet, 0)\r\n                        .toString(16)\r\n                        .toUpperCase(),\r\n                    toUint32Le(generalConstraintSet, 4)\r\n                        .toString(16)\r\n                        .toUpperCase(),\r\n                ].join(\".\");\r\n                this.decoder.configure({\r\n                    codec,\r\n                    optimizeForLatency: true,\r\n                });\r\n                break;\r\n            }\r\n        }\r\n        this._config = data;\r\n    }\r\n\r\n    private decode(packet: ScrcpyMediaStreamDataPacket) {\r\n        if (this.decoder.state !== \"configured\") {\r\n            return;\r\n        }\r\n\r\n        // WebCodecs requires configuration data to be with the first frame.\r\n        // https://www.w3.org/TR/webcodecs-avc-codec-registration/#encodedvideochunk-type\r\n        let data: Uint8Array;\r\n        if (this._config !== undefined) {\r\n            data = new Uint8Array(\r\n                this._config.byteLength + packet.data.byteLength\r\n            );\r\n            data.set(this._config, 0);\r\n            data.set(packet.data, this._config.byteLength);\r\n            this._config = undefined;\r\n        } else {\r\n            data = packet.data;\r\n        }\r\n\r\n        this.decoder.decode(\r\n            new EncodedVideoChunk({\r\n                // Treat `undefined` as `key`, otherwise won't decode.\r\n                type: packet.keyframe === false ? \"delta\" : \"key\",\r\n                timestamp: 0,\r\n                data,\r\n            })\r\n        );\r\n    }\r\n\r\n    public dispose() {\r\n        cancelAnimationFrame(this.animationFrameId);\r\n        if (this.decoder.state !== \"closed\") {\r\n            this.decoder.close();\r\n        }\r\n    }\r\n}\r\n","// cspell: ignore MPEGH\r\n// cspell: ignore rbsp\r\n// cspell: ignore Nalus\r\n\r\nimport {\r\n    H265NaluRaw,\r\n    ScrcpyAudioCodec,\r\n    ScrcpyMediaStreamDataPacket,\r\n    ScrcpyMediaStreamPacket,\r\n    ScrcpyVideoCodecId,\r\n    ScrcpyVideoStreamMetadata,\r\n    annexBSplitNalu,\r\n    h264SearchConfiguration,\r\n    h265ParseSequenceParameterSet,\r\n    h265ParseVideoParameterSet,\r\n    h265SearchConfiguration,\r\n} from \"@yume-chan/scrcpy\";\r\nimport { action, makeAutoObservable, reaction } from \"mobx\";\r\nimport { ArrayBufferTarget, Muxer as WebMMuxer } from \"webm-muxer\";\r\nimport { saveFile } from \"../../utils\";\r\n\r\n// https://ffmpeg.org/doxygen/0.11/avc_8c-source.html#l00106\r\nfunction h264ConfigurationToAvcDecoderConfigurationRecord(\r\n    sequenceParameterSet: Uint8Array,\r\n    pictureParameterSet: Uint8Array\r\n) {\r\n    const buffer = new Uint8Array(\r\n        11 + sequenceParameterSet.byteLength + pictureParameterSet.byteLength\r\n    );\r\n    buffer[0] = 1;\r\n    buffer[1] = sequenceParameterSet[1];\r\n    buffer[2] = sequenceParameterSet[2];\r\n    buffer[3] = sequenceParameterSet[3];\r\n    buffer[4] = 0xff;\r\n    buffer[5] = 0xe1;\r\n    buffer[6] = sequenceParameterSet.byteLength >> 8;\r\n    buffer[7] = sequenceParameterSet.byteLength & 0xff;\r\n    buffer.set(sequenceParameterSet, 8);\r\n    buffer[8 + sequenceParameterSet.byteLength] = 1;\r\n    buffer[9 + sequenceParameterSet.byteLength] =\r\n        pictureParameterSet.byteLength >> 8;\r\n    buffer[10 + sequenceParameterSet.byteLength] =\r\n        pictureParameterSet.byteLength & 0xff;\r\n    buffer.set(pictureParameterSet, 11 + sequenceParameterSet.byteLength);\r\n    return buffer;\r\n}\r\n\r\nfunction h265ConfigurationToHevcDecoderConfigurationRecord(\r\n    videoParameterSet: H265NaluRaw,\r\n    sequenceParameterSet: H265NaluRaw,\r\n    pictureParameterSet: H265NaluRaw\r\n) {\r\n    const {\r\n        profileTierLevel: {\r\n            generalProfileTier: {\r\n                profile_space: general_profile_space,\r\n                tier_flag: general_tier_flag,\r\n                profile_idc: general_profile_idc,\r\n                profileCompatibilitySet: generalProfileCompatibilitySet,\r\n                constraintSet: generalConstraintSet,\r\n            },\r\n            general_level_idc,\r\n        },\r\n        vps_max_layers_minus1,\r\n        vps_temporal_id_nesting_flag,\r\n    } = h265ParseVideoParameterSet(videoParameterSet.rbsp);\r\n\r\n    const {\r\n        chroma_format_idc,\r\n        bit_depth_luma_minus8,\r\n        bit_depth_chroma_minus8,\r\n        vuiParameters: { min_spatial_segmentation_idc = 0 } = {},\r\n    } = h265ParseSequenceParameterSet(sequenceParameterSet.rbsp);\r\n\r\n    const buffer = new Uint8Array(\r\n        23 +\r\n            5 * 3 +\r\n            videoParameterSet.data.length +\r\n            sequenceParameterSet.data.length +\r\n            pictureParameterSet.data.length\r\n    );\r\n\r\n    /* unsigned int(8) configurationVersion = 1; */\r\n    buffer[0] = 1;\r\n\r\n    /*\r\n     * unsigned int(2) general_profile_space;\r\n     * unsigned int(1) general_tier_flag;\r\n     * unsigned int(5) general_profile_idc;\r\n     */\r\n    buffer[1] =\r\n        (general_profile_space << 6) |\r\n        (Number(general_tier_flag) << 5) |\r\n        general_profile_idc;\r\n\r\n    /* unsigned int(32) general_profile_compatibility_flags; */\r\n    buffer[2] = generalProfileCompatibilitySet[0];\r\n    buffer[3] = generalProfileCompatibilitySet[1];\r\n    buffer[4] = generalProfileCompatibilitySet[2];\r\n    buffer[5] = generalProfileCompatibilitySet[3];\r\n\r\n    /* unsigned int(48) general_constraint_indicator_flags; */\r\n    buffer[6] = generalConstraintSet[0];\r\n    buffer[7] = generalConstraintSet[1];\r\n    buffer[8] = generalConstraintSet[2];\r\n    buffer[9] = generalConstraintSet[3];\r\n    buffer[10] = generalConstraintSet[4];\r\n    buffer[11] = generalConstraintSet[5];\r\n\r\n    /* unsigned int(8) general_level_idc; */\r\n    buffer[12] = general_level_idc;\r\n\r\n    /*\r\n     * bit(4) reserved = '1111'b;\r\n     * unsigned int(12) min_spatial_segmentation_idc;\r\n     */\r\n    buffer[13] = 0xf0 | (min_spatial_segmentation_idc >> 8);\r\n    buffer[14] = min_spatial_segmentation_idc;\r\n\r\n    /*\r\n     * bit(6) reserved = '111111'b;\r\n     * unsigned int(2) parallelismType;\r\n     */\r\n    buffer[15] = 0xfc;\r\n\r\n    /*\r\n     * bit(6) reserved = '111111'b;\r\n     * unsigned int(2) chromaFormat;\r\n     */\r\n    buffer[16] = 0xfc | chroma_format_idc;\r\n\r\n    /*\r\n     * bit(5) reserved = '11111'b;\r\n     * unsigned int(3) bitDepthLumaMinus8;\r\n     */\r\n    buffer[17] = 0xf8 | bit_depth_luma_minus8;\r\n\r\n    /*\r\n     * bit(5) reserved = '11111'b;\r\n     * unsigned int(3) bitDepthChromaMinus8;\r\n     */\r\n    buffer[18] = 0xf8 | bit_depth_chroma_minus8;\r\n\r\n    /* bit(16) avgFrameRate; */\r\n    buffer[19] = 0;\r\n    buffer[20] = 0;\r\n\r\n    /*\r\n     * bit(2) constantFrameRate;\r\n     * bit(3) numTemporalLayers;\r\n     * bit(1) temporalIdNested;\r\n     * unsigned int(2) lengthSizeMinusOne;\r\n     */\r\n    buffer[21] =\r\n        ((vps_max_layers_minus1 + 1) << 3) |\r\n        (Number(vps_temporal_id_nesting_flag) << 2) |\r\n        3;\r\n\r\n    /* unsigned int(8) numOfArrays; */\r\n    buffer[22] = 3;\r\n\r\n    let i = 23;\r\n\r\n    for (const nalu of [\r\n        videoParameterSet,\r\n        sequenceParameterSet,\r\n        pictureParameterSet,\r\n    ]) {\r\n        /*\r\n         * bit(1) array_completeness;\r\n         * unsigned int(1) reserved = 0;\r\n         * unsigned int(6) NAL_unit_type;\r\n         */\r\n        buffer[i] = nalu.nal_unit_type;\r\n        i += 1;\r\n\r\n        /* unsigned int(16) numNalus; */\r\n        buffer[i] = 0;\r\n        i += 1;\r\n        buffer[i] = 1;\r\n        i += 1;\r\n\r\n        /* unsigned int(16) nalUnitLength; */\r\n        buffer[i] = nalu.data.length >> 8;\r\n        i += 1;\r\n        buffer[i] = nalu.data.length;\r\n        i += 1;\r\n\r\n        buffer.set(nalu.data, i);\r\n        i += nalu.data.length;\r\n    }\r\n\r\n    return buffer;\r\n}\r\n\r\nfunction h264StreamToAvcSample(buffer: Uint8Array) {\r\n    const nalUnits: Uint8Array[] = [];\r\n    let totalLength = 0;\r\n\r\n    for (const unit of annexBSplitNalu(buffer)) {\r\n        nalUnits.push(unit);\r\n        totalLength += unit.byteLength + 4;\r\n    }\r\n\r\n    const sample = new Uint8Array(totalLength);\r\n    let offset = 0;\r\n    for (const nalu of nalUnits) {\r\n        sample[offset] = nalu.byteLength >> 24;\r\n        sample[offset + 1] = nalu.byteLength >> 16;\r\n        sample[offset + 2] = nalu.byteLength >> 8;\r\n        sample[offset + 3] = nalu.byteLength & 0xff;\r\n        sample.set(nalu, offset + 4);\r\n        offset += 4 + nalu.byteLength;\r\n    }\r\n    return sample;\r\n}\r\n\r\n// https://github.com/FFmpeg/FFmpeg/blob/adb5f7b41faf354a3e0bf722f44aeb230aefa310/libavformat/matroska.c\r\nconst MatroskaVideoCodecNameMap: Record<ScrcpyVideoCodecId, string> = {\r\n    [ScrcpyVideoCodecId.H264]: \"V_MPEG4/ISO/AVC\",\r\n    [ScrcpyVideoCodecId.H265]: \"V_MPEGH/ISO/HEVC\",\r\n    [ScrcpyVideoCodecId.AV1]: \"V_AV1\",\r\n};\r\n\r\nconst MatroskaAudioCodecNameMap: Record<string, string> = {\r\n    [ScrcpyAudioCodec.RAW.mimeType]: \"A_PCM/INT/LIT\",\r\n    [ScrcpyAudioCodec.AAC.mimeType]: \"A_AAC\",\r\n    [ScrcpyAudioCodec.OPUS.mimeType]: \"A_OPUS\",\r\n};\r\n\r\nexport class MatroskaMuxingRecorder {\r\n    public running = false;\r\n\r\n    public videoMetadata: ScrcpyVideoStreamMetadata | undefined;\r\n    public audioCodec: ScrcpyAudioCodec | undefined;\r\n\r\n    private muxer: WebMMuxer<ArrayBufferTarget> | undefined;\r\n    private videoCodecDescription: Uint8Array | undefined;\r\n    private configurationWritten = false;\r\n    private _firstTimestamp = -1;\r\n    private _packetsFromLastKeyframe: {\r\n        type: \"video\" | \"audio\";\r\n        packet: ScrcpyMediaStreamDataPacket;\r\n    }[] = [];\r\n\r\n    private addVideoChunk(packet: ScrcpyMediaStreamDataPacket) {\r\n        if (this._firstTimestamp === -1) {\r\n            this._firstTimestamp = Number(packet.pts!);\r\n        }\r\n\r\n        const sample = h264StreamToAvcSample(packet.data);\r\n        this.muxer!.addVideoChunkRaw(\r\n            sample,\r\n            packet.keyframe ? \"key\" : \"delta\",\r\n            Number(packet.pts) - this._firstTimestamp,\r\n            this.configurationWritten\r\n                ? undefined\r\n                : {\r\n                      decoderConfig: {\r\n                          // Not used\r\n                          codec: \"\",\r\n                          description: this.videoCodecDescription,\r\n                      },\r\n                  }\r\n        );\r\n        this.configurationWritten = true;\r\n    }\r\n\r\n    public addVideoPacket(packet: ScrcpyMediaStreamPacket) {\r\n        if (!this.videoMetadata) {\r\n            throw new Error(\"videoMetadata must be set\");\r\n        }\r\n\r\n        try {\r\n            if (packet.type === \"configuration\") {\r\n                switch (this.videoMetadata.codec) {\r\n                    case ScrcpyVideoCodecId.H264: {\r\n                        const { sequenceParameterSet, pictureParameterSet } =\r\n                            h264SearchConfiguration(packet.data);\r\n                        this.videoCodecDescription =\r\n                            h264ConfigurationToAvcDecoderConfigurationRecord(\r\n                                sequenceParameterSet,\r\n                                pictureParameterSet\r\n                            );\r\n                        this.configurationWritten = false;\r\n                        break;\r\n                    }\r\n                    case ScrcpyVideoCodecId.H265: {\r\n                        const {\r\n                            videoParameterSet,\r\n                            sequenceParameterSet,\r\n                            pictureParameterSet,\r\n                        } = h265SearchConfiguration(packet.data);\r\n                        this.videoCodecDescription =\r\n                            h265ConfigurationToHevcDecoderConfigurationRecord(\r\n                                videoParameterSet,\r\n                                sequenceParameterSet,\r\n                                pictureParameterSet\r\n                            );\r\n                        this.configurationWritten = false;\r\n                        break;\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n\r\n            // To ensure the first frame is a keyframe\r\n            // save the last keyframe and the following frames\r\n            if (packet.keyframe === true) {\r\n                this._packetsFromLastKeyframe.length = 0;\r\n            }\r\n            this._packetsFromLastKeyframe.push({ type: \"video\", packet });\r\n\r\n            if (!this.muxer) {\r\n                return;\r\n            }\r\n\r\n            this.addVideoChunk(packet);\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    private addAudioChunk(chunk: ScrcpyMediaStreamDataPacket) {\r\n        if (this._firstTimestamp === -1) {\r\n            return;\r\n        }\r\n\r\n        const timestamp = Number(chunk.pts) - this._firstTimestamp;\r\n        if (timestamp < 0) {\r\n            return;\r\n        }\r\n\r\n        if (!this.muxer) {\r\n            return;\r\n        }\r\n\r\n        this.muxer.addAudioChunkRaw(chunk.data, \"key\", timestamp);\r\n    }\r\n\r\n    public addAudioPacket(packet: ScrcpyMediaStreamDataPacket) {\r\n        this._packetsFromLastKeyframe.push({ type: \"audio\", packet });\r\n        this.addAudioChunk(packet);\r\n    }\r\n\r\n    public start() {\r\n        if (!this.videoMetadata) {\r\n            throw new Error(\"videoMetadata must be set\");\r\n        }\r\n\r\n        this.running = true;\r\n\r\n        const options: ConstructorParameters<typeof WebMMuxer>[0] = {\r\n            target: new ArrayBufferTarget(),\r\n            type: \"matroska\",\r\n            firstTimestampBehavior: \"permissive\",\r\n            video: {\r\n                codec: MatroskaVideoCodecNameMap[this.videoMetadata.codec!],\r\n                width: this.videoMetadata.width ?? 0,\r\n                height: this.videoMetadata.height ?? 0,\r\n            },\r\n        };\r\n\r\n        if (this.audioCodec) {\r\n            options.audio = {\r\n                codec: MatroskaAudioCodecNameMap[this.audioCodec.mimeType!],\r\n                sampleRate: 48000,\r\n                numberOfChannels: 2,\r\n                bitDepth:\r\n                    this.audioCodec === ScrcpyAudioCodec.RAW ? 16 : undefined,\r\n            };\r\n        }\r\n\r\n        this.muxer = new WebMMuxer(options as any);\r\n\r\n        if (this._packetsFromLastKeyframe.length > 0) {\r\n            for (const { type, packet } of this._packetsFromLastKeyframe) {\r\n                if (type === \"video\") {\r\n                    this.addVideoChunk(packet);\r\n                } else {\r\n                    this.addAudioChunk(packet);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public stop() {\r\n        if (!this.muxer) {\r\n            return;\r\n        }\r\n\r\n        this.muxer.finalize()!;\r\n        const buffer = this.muxer.target.buffer;\r\n        const now = new Date();\r\n        const stream = saveFile(\r\n            // prettier-ignore\r\n            `Recording ${\r\n                now.getFullYear()\r\n            }-${\r\n                (now.getMonth() + 1).toString().padStart(2, '0')\r\n            }-${\r\n                now.getDate().toString().padStart(2, '0')\r\n            } ${\r\n                now.getHours().toString().padStart(2, '0')\r\n            }-${\r\n                now.getMinutes().toString().padStart(2, '0')\r\n            }-${\r\n                now.getSeconds().toString().padStart(2, '0')\r\n            }.mkv`\r\n        );\r\n        const writer = stream.getWriter();\r\n        writer.write(new Uint8Array(buffer));\r\n        writer.close();\r\n\r\n        this.muxer = undefined;\r\n        this.configurationWritten = false;\r\n        this.running = false;\r\n    }\r\n}\r\n\r\nexport const RECORD_STATE = makeAutoObservable({\r\n    recorder: new MatroskaMuxingRecorder(),\r\n    recording: false,\r\n    intervalId: -1,\r\n    hours: 0,\r\n    minutes: 0,\r\n    seconds: 0,\r\n});\r\n\r\nreaction(\r\n    () => RECORD_STATE.recording,\r\n    (recording) => {\r\n        if (recording) {\r\n            RECORD_STATE.intervalId = globalThis.setInterval(\r\n                action(() => {\r\n                    RECORD_STATE.seconds += 1;\r\n                    if (RECORD_STATE.seconds >= 60) {\r\n                        RECORD_STATE.seconds = 0;\r\n                        RECORD_STATE.minutes += 1;\r\n                    }\r\n                    if (RECORD_STATE.minutes >= 60) {\r\n                        RECORD_STATE.minutes = 0;\r\n                        RECORD_STATE.hours += 1;\r\n                    }\r\n                }),\r\n                1000\r\n            ) as unknown as number;\r\n        } else {\r\n            globalThis.clearInterval(RECORD_STATE.intervalId);\r\n            RECORD_STATE.intervalId = -1;\r\n            RECORD_STATE.hours = 0;\r\n            RECORD_STATE.minutes = 0;\r\n            RECORD_STATE.seconds = 0;\r\n        }\r\n    }\r\n);\r\n","import type { Adb, AdbSubprocessProtocol } from \"@yume-chan/adb\";\r\nimport {\r\n    AdbReverseNotSupportedError,\r\n    AdbSubprocessNoneProtocol,\r\n} from \"@yume-chan/adb\";\r\nimport type {\r\n    ScrcpyAudioStreamDisabledMetadata,\r\n    ScrcpyAudioStreamErroredMetadata,\r\n    ScrcpyAudioStreamSuccessMetadata,\r\n    ScrcpyDeviceMessage,\r\n    ScrcpyDisplay,\r\n    ScrcpyEncoder,\r\n    ScrcpyMediaStreamPacket,\r\n    ScrcpyVideoStreamMetadata,\r\n} from \"@yume-chan/scrcpy\";\r\nimport {\r\n    DEFAULT_SERVER_PATH,\r\n    ScrcpyControlMessageWriter,\r\n    ScrcpyDeviceMessageDeserializeStream,\r\n    ScrcpyVideoCodecId,\r\n    h264ParseConfiguration,\r\n    h265ParseConfiguration,\r\n} from \"@yume-chan/scrcpy\";\r\nimport type {\r\n    Consumable,\r\n    ReadableStream,\r\n    ReadableWritablePair,\r\n} from \"@yume-chan/stream-extra\";\r\nimport {\r\n    AbortController,\r\n    DecodeUtf8Stream,\r\n    InspectStream,\r\n    PushReadableStream,\r\n    SplitStringStream,\r\n    WritableStream,\r\n} from \"@yume-chan/stream-extra\";\r\n\r\nimport type { AdbScrcpyConnection } from \"./connection.js\";\r\nimport type { AdbScrcpyOptions } from \"./options/index.js\";\r\n\r\nfunction arrayToStream<T>(array: T[]): ReadableStream<T> {\r\n    return new PushReadableStream(async (controller) => {\r\n        for (const item of array) {\r\n            await controller.enqueue(item);\r\n        }\r\n    });\r\n}\r\n\r\nfunction concatStreams<T>(...streams: ReadableStream<T>[]): ReadableStream<T> {\r\n    return new PushReadableStream(async (controller) => {\r\n        for (const stream of streams) {\r\n            const reader = stream.getReader();\r\n            while (true) {\r\n                const { done, value } = await reader.read();\r\n                if (done) {\r\n                    break;\r\n                }\r\n                await controller.enqueue(value);\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nexport class AdbScrcpyExitedError extends Error {\r\n    public output: string[];\r\n\r\n    public constructor(output: string[]) {\r\n        super(\"scrcpy server exited prematurely\");\r\n        this.output = output;\r\n    }\r\n}\r\n\r\ninterface AdbScrcpyClientInit {\r\n    options: AdbScrcpyOptions<object>;\r\n    process: AdbSubprocessProtocol;\r\n    stdout: ReadableStream<string>;\r\n\r\n    videoStream: ReadableStream<Uint8Array> | undefined;\r\n    audioStream: ReadableStream<Uint8Array> | undefined;\r\n    controlStream:\r\n        | ReadableWritablePair<Uint8Array, Consumable<Uint8Array>>\r\n        | undefined;\r\n}\r\n\r\nexport interface AdbScrcpyVideoStream {\r\n    stream: ReadableStream<ScrcpyMediaStreamPacket>;\r\n    metadata: ScrcpyVideoStreamMetadata;\r\n}\r\n\r\nexport interface AdbScrcpyAudioStreamSuccessMetadata\r\n    extends Omit<ScrcpyAudioStreamSuccessMetadata, \"stream\"> {\r\n    readonly stream: ReadableStream<ScrcpyMediaStreamPacket>;\r\n}\r\n\r\nexport type AdbScrcpyAudioStreamMetadata =\r\n    | ScrcpyAudioStreamDisabledMetadata\r\n    | ScrcpyAudioStreamErroredMetadata\r\n    | AdbScrcpyAudioStreamSuccessMetadata;\r\n\r\nexport class AdbScrcpyClient {\r\n    public static async pushServer(\r\n        adb: Adb,\r\n        file: ReadableStream<Consumable<Uint8Array>>,\r\n        filename = DEFAULT_SERVER_PATH\r\n    ) {\r\n        const sync = await adb.sync();\r\n        try {\r\n            await sync.write({\r\n                filename,\r\n                file,\r\n            });\r\n        } finally {\r\n            await sync.dispose();\r\n        }\r\n    }\r\n\r\n    public static async start(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string,\r\n        options: AdbScrcpyOptions<object>\r\n    ) {\r\n        let connection: AdbScrcpyConnection | undefined;\r\n        let process: AdbSubprocessProtocol | undefined;\r\n\r\n        try {\r\n            try {\r\n                connection = options.createConnection(adb);\r\n                await connection.initialize();\r\n            } catch (e) {\r\n                if (e instanceof AdbReverseNotSupportedError) {\r\n                    // When reverse tunnel is not supported, try forward tunnel.\r\n                    options.tunnelForwardOverride = true;\r\n                    connection = options.createConnection(adb);\r\n                    await connection.initialize();\r\n                } else {\r\n                    connection = undefined;\r\n                    throw e;\r\n                }\r\n            }\r\n\r\n            process = await adb.subprocess.spawn(\r\n                [\r\n                    // cspell: disable-next-line\r\n                    `CLASSPATH=${path}`,\r\n                    \"app_process\",\r\n                    /* unused */ \"/\",\r\n                    \"com.genymobile.scrcpy.Server\",\r\n                    version,\r\n                    ...options.serialize(),\r\n                ],\r\n                {\r\n                    // Scrcpy server doesn't use stderr,\r\n                    // so disable Shell Protocol to simplify processing\r\n                    protocols: [AdbSubprocessNoneProtocol],\r\n                }\r\n            );\r\n\r\n            const stdout = process.stdout\r\n                .pipeThrough(new DecodeUtf8Stream())\r\n                .pipeThrough(new SplitStringStream(\"\\n\"));\r\n\r\n            // Must read all streams, otherwise the whole connection will be blocked.\r\n            const output: string[] = [];\r\n            const abortController = new AbortController();\r\n            const pipe = stdout\r\n                .pipeTo(\r\n                    new WritableStream({\r\n                        write(chunk) {\r\n                            output.push(chunk);\r\n                        },\r\n                    }),\r\n                    {\r\n                        signal: abortController.signal,\r\n                        preventCancel: true,\r\n                    }\r\n                )\r\n                .catch((e) => {\r\n                    if (abortController.signal.aborted) {\r\n                        return;\r\n                    }\r\n\r\n                    throw e;\r\n                });\r\n\r\n            const streams = await Promise.race([\r\n                process.exit.then(() => {\r\n                    throw new AdbScrcpyExitedError(output);\r\n                }),\r\n                connection.getStreams(),\r\n            ]);\r\n\r\n            abortController.abort();\r\n            await pipe;\r\n\r\n            return new AdbScrcpyClient({\r\n                options,\r\n                process,\r\n                stdout: concatStreams(arrayToStream(output), stdout),\r\n                videoStream: streams.video,\r\n                audioStream: streams.audio,\r\n                controlStream: streams.control,\r\n            });\r\n        } catch (e) {\r\n            await process?.kill();\r\n            throw e;\r\n        } finally {\r\n            connection?.dispose();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * This method will modify the given `options`,\r\n     * so don't reuse it elsewhere.\r\n     */\r\n    public static async getEncoders(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string,\r\n        options: AdbScrcpyOptions<object>\r\n    ): Promise<ScrcpyEncoder[]> {\r\n        options.setListEncoders();\r\n        return await options.getEncoders(adb, path, version);\r\n    }\r\n\r\n    /**\r\n     * This method will modify the given `options`,\r\n     * so don't reuse it elsewhere.\r\n     */\r\n    public static async getDisplays(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string,\r\n        options: AdbScrcpyOptions<object>\r\n    ): Promise<ScrcpyDisplay[]> {\r\n        options.setListDisplays();\r\n        return await options.getDisplays(adb, path, version);\r\n    }\r\n\r\n    private _options: AdbScrcpyOptions<object>;\r\n    private _process: AdbSubprocessProtocol;\r\n\r\n    private _stdout: ReadableStream<string>;\r\n    public get stdout() {\r\n        return this._stdout;\r\n    }\r\n\r\n    public get exit() {\r\n        return this._process.exit;\r\n    }\r\n\r\n    private _screenWidth: number | undefined;\r\n    public get screenWidth() {\r\n        return this._screenWidth;\r\n    }\r\n\r\n    private _screenHeight: number | undefined;\r\n    public get screenHeight() {\r\n        return this._screenHeight;\r\n    }\r\n\r\n    private _videoStream: Promise<AdbScrcpyVideoStream> | undefined;\r\n    public get videoStream() {\r\n        return this._videoStream;\r\n    }\r\n\r\n    private _audioStream: Promise<AdbScrcpyAudioStreamMetadata> | undefined;\r\n    public get audioStream() {\r\n        return this._audioStream;\r\n    }\r\n\r\n    private _controlMessageWriter: ScrcpyControlMessageWriter | undefined;\r\n    public get controlMessageWriter() {\r\n        return this._controlMessageWriter;\r\n    }\r\n\r\n    private _deviceMessageStream:\r\n        | ReadableStream<ScrcpyDeviceMessage>\r\n        | undefined;\r\n    public get deviceMessageStream() {\r\n        return this._deviceMessageStream;\r\n    }\r\n\r\n    public constructor({\r\n        options,\r\n        process,\r\n        stdout,\r\n        videoStream,\r\n        audioStream,\r\n        controlStream,\r\n    }: AdbScrcpyClientInit) {\r\n        this._options = options;\r\n        this._process = process;\r\n        this._stdout = stdout;\r\n\r\n        this._videoStream = videoStream\r\n            ? this.createVideoStream(videoStream)\r\n            : undefined;\r\n\r\n        this._audioStream = audioStream\r\n            ? this.createAudioStream(audioStream)\r\n            : undefined;\r\n\r\n        if (controlStream) {\r\n            this._controlMessageWriter = new ScrcpyControlMessageWriter(\r\n                controlStream.writable.getWriter(),\r\n                options\r\n            );\r\n            this._deviceMessageStream = controlStream.readable.pipeThrough(\r\n                new ScrcpyDeviceMessageDeserializeStream()\r\n            );\r\n        }\r\n    }\r\n\r\n    private async createVideoStream(initialStream: ReadableStream<Uint8Array>) {\r\n        const { stream, metadata } =\r\n            await this._options.parseVideoStreamMetadata(initialStream);\r\n\r\n        return {\r\n            stream: stream\r\n                .pipeThrough(this._options.createMediaStreamTransformer())\r\n                .pipeThrough(\r\n                    new InspectStream((packet) => {\r\n                        if (packet.type === \"configuration\") {\r\n                            switch (metadata.codec) {\r\n                                case ScrcpyVideoCodecId.H264: {\r\n                                    const { croppedWidth, croppedHeight } =\r\n                                        h264ParseConfiguration(packet.data);\r\n\r\n                                    this._screenWidth = croppedWidth;\r\n                                    this._screenHeight = croppedHeight;\r\n                                    break;\r\n                                }\r\n                                case ScrcpyVideoCodecId.H265: {\r\n                                    const { croppedWidth, croppedHeight } =\r\n                                        h265ParseConfiguration(packet.data);\r\n\r\n                                    this._screenWidth = croppedWidth;\r\n                                    this._screenHeight = croppedHeight;\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                    })\r\n                ),\r\n            metadata,\r\n        };\r\n    }\r\n\r\n    private async createAudioStream(\r\n        initialStream: ReadableStream<Uint8Array>\r\n    ): Promise<AdbScrcpyAudioStreamMetadata> {\r\n        const metadata = await this._options.parseAudioStreamMetadata(\r\n            initialStream\r\n        );\r\n\r\n        switch (metadata.type) {\r\n            case \"disabled\":\r\n            case \"errored\":\r\n                return metadata;\r\n            case \"success\":\r\n                return {\r\n                    ...metadata,\r\n                    stream: metadata.stream.pipeThrough(\r\n                        this._options.createMediaStreamTransformer()\r\n                    ),\r\n                };\r\n            default:\r\n                throw new Error(\r\n                    `Unexpected audio metadata type ${\r\n                        metadata[\"type\"] as unknown as string\r\n                    }`\r\n                );\r\n        }\r\n    }\r\n\r\n    public async close() {\r\n        await this._process.kill();\r\n    }\r\n}\r\n","import type { Adb } from \"@yume-chan/adb\";\r\nimport { AdbReverseNotSupportedError, NOOP } from \"@yume-chan/adb\";\r\nimport { delay } from \"@yume-chan/async\";\r\nimport type { Disposable } from \"@yume-chan/event\";\r\nimport type {\r\n    Consumable,\r\n    ReadableStream,\r\n    ReadableStreamDefaultReader,\r\n    ReadableWritablePair,\r\n} from \"@yume-chan/stream-extra\";\r\nimport {\r\n    BufferedReadableStream,\r\n    TransformStream,\r\n} from \"@yume-chan/stream-extra\";\r\nimport type { ValueOrPromise } from \"@yume-chan/struct\";\r\n\r\nexport interface AdbScrcpyConnectionOptions {\r\n    scid: number;\r\n\r\n    video: boolean;\r\n\r\n    audio: boolean;\r\n\r\n    /**\r\n     * Whether to create a control stream\r\n     */\r\n    control: boolean;\r\n\r\n    /**\r\n     * In forward tunnel mode, read a byte from video socket on start to detect connection issues\r\n     */\r\n    sendDummyByte: boolean;\r\n}\r\n\r\nexport const SCRCPY_SOCKET_NAME_PREFIX = \"scrcpy\";\r\n\r\nexport interface AdbScrcpyConnectionStreams {\r\n    video?: ReadableStream<Uint8Array>;\r\n    audio?: ReadableStream<Uint8Array>;\r\n    control?: ReadableWritablePair<Uint8Array, Consumable<Uint8Array>>;\r\n}\r\n\r\nexport abstract class AdbScrcpyConnection implements Disposable {\r\n    protected adb: Adb;\r\n\r\n    protected options: AdbScrcpyConnectionOptions;\r\n\r\n    protected socketName: string;\r\n\r\n    public constructor(adb: Adb, options: AdbScrcpyConnectionOptions) {\r\n        this.adb = adb;\r\n        this.options = options;\r\n        this.socketName = this.getSocketName();\r\n    }\r\n\r\n    public initialize(): ValueOrPromise<void> {\r\n        // pure virtual method\r\n    }\r\n\r\n    protected getSocketName(): string {\r\n        let socketName = \"localabstract:\" + SCRCPY_SOCKET_NAME_PREFIX;\r\n        if (this.options.scid !== undefined && this.options.scid >= 0) {\r\n            socketName += \"_\" + this.options.scid.toString(16).padStart(8, \"0\");\r\n        }\r\n        return socketName;\r\n    }\r\n\r\n    public abstract getStreams(): ValueOrPromise<AdbScrcpyConnectionStreams>;\r\n\r\n    public dispose(): void {\r\n        // pure virtual method\r\n    }\r\n}\r\n\r\nexport class AdbScrcpyForwardConnection extends AdbScrcpyConnection {\r\n    private _disposed = false;\r\n\r\n    private connect(): Promise<\r\n        ReadableWritablePair<Uint8Array, Consumable<Uint8Array>>\r\n    > {\r\n        return this.adb.createSocket(this.socketName);\r\n    }\r\n\r\n    private async connectAndRetry(\r\n        sendDummyByte: boolean\r\n    ): Promise<ReadableWritablePair<Uint8Array, Consumable<Uint8Array>>> {\r\n        for (let i = 0; !this._disposed && i < 100; i += 1) {\r\n            try {\r\n                const stream = await this.connect();\r\n                if (sendDummyByte) {\r\n                    // Can't guarantee the stream will preserve message boundaries,\r\n                    // so buffer the stream\r\n                    const buffered = new BufferedReadableStream(\r\n                        stream.readable\r\n                    );\r\n                    await buffered.readExactly(1);\r\n                    return {\r\n                        readable: buffered.release(),\r\n                        writable: stream.writable,\r\n                    };\r\n                }\r\n                return stream;\r\n            } catch (e) {\r\n                // Maybe the server is still starting\r\n                await delay(100);\r\n            }\r\n        }\r\n        throw new Error(`Can't connect to server after 100 retries`);\r\n    }\r\n\r\n    public override async getStreams(): Promise<AdbScrcpyConnectionStreams> {\r\n        let { sendDummyByte } = this.options;\r\n\r\n        const streams: AdbScrcpyConnectionStreams = {};\r\n\r\n        if (this.options.video) {\r\n            const video = await this.connectAndRetry(sendDummyByte);\r\n            streams.video = video.readable;\r\n            sendDummyByte = false;\r\n        }\r\n\r\n        if (this.options.audio) {\r\n            const audio = await this.connectAndRetry(sendDummyByte);\r\n            streams.audio = audio.readable;\r\n            sendDummyByte = false;\r\n        }\r\n\r\n        if (this.options.control) {\r\n            const control = await this.connectAndRetry(sendDummyByte);\r\n            sendDummyByte = false;\r\n            streams.control = control;\r\n        }\r\n\r\n        return streams;\r\n    }\r\n\r\n    public override dispose(): void {\r\n        this._disposed = true;\r\n    }\r\n}\r\n\r\nexport class AdbScrcpyReverseConnection extends AdbScrcpyConnection {\r\n    private streams!: ReadableStreamDefaultReader<\r\n        ReadableWritablePair<Uint8Array, Consumable<Uint8Array>>\r\n    >;\r\n\r\n    private address!: string;\r\n\r\n    public override async initialize(): Promise<void> {\r\n        // try to unbind first\r\n        await this.adb.reverse.remove(this.socketName).catch((e) => {\r\n            if (e instanceof AdbReverseNotSupportedError) {\r\n                throw e;\r\n            }\r\n\r\n            // Ignore other errors when unbinding\r\n        });\r\n\r\n        const queue = new TransformStream<\r\n            ReadableWritablePair<Uint8Array, Consumable<Uint8Array>>,\r\n            ReadableWritablePair<Uint8Array, Consumable<Uint8Array>>\r\n        >();\r\n        this.streams = queue.readable.getReader();\r\n        const writer = queue.writable.getWriter();\r\n        this.address = await this.adb.reverse.add(this.socketName, (socket) => {\r\n            void writer.write(socket);\r\n        });\r\n    }\r\n\r\n    private async accept(): Promise<\r\n        ReadableWritablePair<Uint8Array, Consumable<Uint8Array>>\r\n    > {\r\n        return (await this.streams.read()).value!;\r\n    }\r\n\r\n    public async getStreams(): Promise<AdbScrcpyConnectionStreams> {\r\n        const streams: AdbScrcpyConnectionStreams = {};\r\n\r\n        if (this.options.video) {\r\n            const video = await this.accept();\r\n            streams.video = video.readable;\r\n        }\r\n\r\n        if (this.options.audio) {\r\n            const audio = await this.accept();\r\n            streams.audio = audio.readable;\r\n        }\r\n\r\n        if (this.options.control) {\r\n            const control = await this.accept();\r\n            streams.control = control;\r\n        }\r\n\r\n        return streams;\r\n    }\r\n\r\n    public override dispose() {\r\n        // Don't await this!\r\n        // `reverse.remove`'s response will never arrive\r\n        // before we read all pending data from Scrcpy streams\r\n        // NOOP: failed to remove reverse tunnel is not a big deal\r\n        this.adb.reverse.remove(this.address).catch(NOOP);\r\n    }\r\n}\r\n","import type { Adb } from \"@yume-chan/adb\";\r\nimport type {\r\n    ScrcpyDisplay,\r\n    ScrcpyEncoder,\r\n    ScrcpyOptions,\r\n} from \"@yume-chan/scrcpy\";\r\nimport { ScrcpyOptionsBase } from \"@yume-chan/scrcpy\";\r\n\r\nimport type { AdbScrcpyConnection } from \"../connection.js\";\r\n\r\nexport interface AdbScrcpyOptions<T extends object> extends ScrcpyOptions<T> {\r\n    /**\r\n     * Allows the client to forcefully enable forward tunnel mode\r\n     * when reverse tunnel fails.\r\n     */\r\n    tunnelForwardOverride: boolean;\r\n\r\n    getEncoders(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string\r\n    ): Promise<ScrcpyEncoder[]>;\r\n\r\n    getDisplays(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string\r\n    ): Promise<ScrcpyDisplay[]>;\r\n\r\n    createConnection(adb: Adb): AdbScrcpyConnection;\r\n}\r\n\r\nexport abstract class AdbScrcpyOptionsBase<T extends object>\r\n    extends ScrcpyOptionsBase<T, ScrcpyOptions<T>>\r\n    implements AdbScrcpyOptions<T>\r\n{\r\n    public override get defaults(): Required<T> {\r\n        return this._base.defaults;\r\n    }\r\n\r\n    public tunnelForwardOverride = false;\r\n\r\n    public constructor(base: ScrcpyOptions<T>) {\r\n        super(base, base.value);\r\n    }\r\n\r\n    public serialize(): string[] {\r\n        return this._base.serialize();\r\n    }\r\n\r\n    public abstract getEncoders(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string\r\n    ): Promise<ScrcpyEncoder[]>;\r\n\r\n    public abstract getDisplays(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string\r\n    ): Promise<ScrcpyDisplay[]>;\r\n\r\n    public abstract createConnection(adb: Adb): AdbScrcpyConnection;\r\n}\r\n","import type { Adb } from \"@yume-chan/adb\";\r\nimport type {\r\n    ScrcpyDisplay,\r\n    ScrcpyEncoder,\r\n    ScrcpyOptionsInit1_16,\r\n} from \"@yume-chan/scrcpy\";\r\nimport { WritableStream } from \"@yume-chan/stream-extra\";\r\n\r\nimport { AdbScrcpyClient, AdbScrcpyExitedError } from \"../client.js\";\r\nimport type {\r\n    AdbScrcpyConnection,\r\n    AdbScrcpyConnectionOptions,\r\n} from \"../connection.js\";\r\nimport {\r\n    AdbScrcpyForwardConnection,\r\n    AdbScrcpyReverseConnection,\r\n} from \"../connection.js\";\r\n\r\nimport type { AdbScrcpyOptions } from \"./types.js\";\r\nimport { AdbScrcpyOptionsBase } from \"./types.js\";\r\n\r\nexport class AdbScrcpyOptions1_16 extends AdbScrcpyOptionsBase<ScrcpyOptionsInit1_16> {\r\n    public static createConnection(\r\n        adb: Adb,\r\n        connectionOptions: AdbScrcpyConnectionOptions,\r\n        tunnelForward: boolean\r\n    ): AdbScrcpyConnection {\r\n        if (tunnelForward) {\r\n            return new AdbScrcpyForwardConnection(adb, connectionOptions);\r\n        } else {\r\n            return new AdbScrcpyReverseConnection(adb, connectionOptions);\r\n        }\r\n    }\r\n\r\n    public static async getEncoders(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string,\r\n        options: AdbScrcpyOptions<object>\r\n    ): Promise<ScrcpyEncoder[]> {\r\n        const client = await AdbScrcpyClient.start(adb, path, version, options);\r\n\r\n        const encoders: ScrcpyEncoder[] = [];\r\n        await client.stdout.pipeTo(\r\n            new WritableStream({\r\n                write: (line) => {\r\n                    const encoder = options.parseEncoder(line);\r\n                    if (encoder) {\r\n                        encoders.push(encoder);\r\n                    }\r\n                },\r\n            })\r\n        );\r\n\r\n        return encoders;\r\n    }\r\n\r\n    public static async getDisplays(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string,\r\n        options: AdbScrcpyOptions<object>\r\n    ): Promise<ScrcpyDisplay[]> {\r\n        try {\r\n            // Server will exit before opening connections when an invalid display id was given.\r\n            const client = await AdbScrcpyClient.start(\r\n                adb,\r\n                path,\r\n                version,\r\n                options\r\n            );\r\n            await client.close();\r\n        } catch (e) {\r\n            if (e instanceof AdbScrcpyExitedError) {\r\n                const displays: ScrcpyDisplay[] = [];\r\n                for (const line of e.output) {\r\n                    const display = options.parseDisplay(line);\r\n                    if (display) {\r\n                        displays.push(display);\r\n                    }\r\n                }\r\n                return displays;\r\n            }\r\n        }\r\n\r\n        throw new Error(\"failed to get displays\");\r\n    }\r\n\r\n    public override getEncoders(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string\r\n    ): Promise<ScrcpyEncoder[]> {\r\n        return AdbScrcpyOptions1_16.getEncoders(adb, path, version, this);\r\n    }\r\n\r\n    public override getDisplays(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string\r\n    ): Promise<ScrcpyDisplay[]> {\r\n        return AdbScrcpyOptions1_16.getDisplays(adb, path, version, this);\r\n    }\r\n\r\n    public override createConnection(adb: Adb): AdbScrcpyConnection {\r\n        return AdbScrcpyOptions1_16.createConnection(\r\n            adb,\r\n            {\r\n                scid: -1,\r\n                video: true,\r\n                audio: false,\r\n                // Old versions always have control stream no matter what the option is\r\n                // Pass `control: false` to `Connection` will disable the control stream\r\n                control: true,\r\n                sendDummyByte: true,\r\n            },\r\n            this.tunnelForwardOverride || this.value.tunnelForward\r\n        );\r\n    }\r\n}\r\n","import type { Adb } from \"@yume-chan/adb\";\r\nimport type {\r\n    ScrcpyDisplay,\r\n    ScrcpyEncoder,\r\n    ScrcpyOptionsInit1_22,\r\n} from \"@yume-chan/scrcpy\";\r\n\r\nimport type { AdbScrcpyConnection } from \"../connection.js\";\r\n\r\nimport { AdbScrcpyOptions1_16 } from \"./1_16.js\";\r\nimport { AdbScrcpyOptionsBase } from \"./types.js\";\r\n\r\nexport class AdbScrcpyOptions1_22 extends AdbScrcpyOptionsBase<ScrcpyOptionsInit1_22> {\r\n    public override getEncoders(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string\r\n    ): Promise<ScrcpyEncoder[]> {\r\n        return AdbScrcpyOptions1_16.getEncoders(adb, path, version, this);\r\n    }\r\n\r\n    public override getDisplays(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string\r\n    ): Promise<ScrcpyDisplay[]> {\r\n        return AdbScrcpyOptions1_16.getDisplays(adb, path, version, this);\r\n    }\r\n\r\n    public override createConnection(adb: Adb): AdbScrcpyConnection {\r\n        return AdbScrcpyOptions1_16.createConnection(\r\n            adb,\r\n            {\r\n                scid: -1,\r\n                video: true,\r\n                audio: false,\r\n                control: this.value.control,\r\n                sendDummyByte: this.value.sendDummyByte,\r\n            },\r\n            this.tunnelForwardOverride || this.value.tunnelForward\r\n        );\r\n    }\r\n}\r\n","import type { Adb } from \"@yume-chan/adb\";\r\nimport type {\r\n    ScrcpyDisplay,\r\n    ScrcpyEncoder,\r\n    ScrcpyOptionsInit2_0,\r\n} from \"@yume-chan/scrcpy\";\r\n\r\nimport { AdbScrcpyClient, AdbScrcpyExitedError } from \"../client.js\";\r\nimport type { AdbScrcpyConnection } from \"../connection.js\";\r\n\r\nimport { AdbScrcpyOptions1_16 } from \"./1_16.js\";\r\nimport type { AdbScrcpyOptions } from \"./types.js\";\r\nimport { AdbScrcpyOptionsBase } from \"./types.js\";\r\n\r\nexport class AdbScrcpyOptions2_0 extends AdbScrcpyOptionsBase<ScrcpyOptionsInit2_0> {\r\n    public static async getEncoders(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string,\r\n        options: AdbScrcpyOptions<object>\r\n    ) {\r\n        try {\r\n            const client = await AdbScrcpyClient.start(\r\n                adb,\r\n                path,\r\n                version,\r\n                options\r\n            );\r\n            await client.close();\r\n        } catch (e) {\r\n            if (e instanceof AdbScrcpyExitedError) {\r\n                const encoders: ScrcpyEncoder[] = [];\r\n                for (const line of e.output) {\r\n                    const encoder = options.parseEncoder(line);\r\n                    if (encoder) {\r\n                        encoders.push(encoder);\r\n                    }\r\n                }\r\n                return encoders;\r\n            }\r\n        }\r\n        throw new Error(\"Unexpected error\");\r\n    }\r\n\r\n    public override async getEncoders(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string\r\n    ): Promise<ScrcpyEncoder[]> {\r\n        return AdbScrcpyOptions2_0.getEncoders(adb, path, version, this);\r\n    }\r\n\r\n    public override getDisplays(\r\n        adb: Adb,\r\n        path: string,\r\n        version: string\r\n    ): Promise<ScrcpyDisplay[]> {\r\n        return AdbScrcpyOptions1_16.getDisplays(adb, path, version, this);\r\n    }\r\n\r\n    public override createConnection(adb: Adb): AdbScrcpyConnection {\r\n        return AdbScrcpyOptions1_16.createConnection(\r\n            adb,\r\n            {\r\n                scid: this.value.scid.value,\r\n                video: true,\r\n                audio: this.value.audio,\r\n                control: this.value.control,\r\n                sendDummyByte: this.value.sendDummyByte,\r\n            },\r\n            this.tunnelForwardOverride || this.value.tunnelForward\r\n        );\r\n    }\r\n}\r\n","import { AdbScrcpyOptions2_0 } from \"./2_0.js\";\r\n\r\nexport class AdbScrcpyOptionsLatest extends AdbScrcpyOptions2_0 {}\r\n","export * from \"./1_16.js\";\r\nexport * from \"./1_22.js\";\r\nexport * from \"./2_0.js\";\r\nexport * from \"./latest.js\";\r\nexport * from \"./types.js\";\r\n","export * from \"./client.js\";\r\nexport * from \"./connection.js\";\r\nexport * from \"./options/index.js\";\r\n","\nexport const VERSION ='2.1';\nexport const BIN = new URL('./server.bin', import.meta.url);\n","export abstract class PcmPlayer<T> {\r\n    protected abstract sourceName: string;\r\n\r\n    private _context: AudioContext;\r\n    private _worklet: AudioWorkletNode | undefined;\r\n    private _buffer: T[] = [];\r\n\r\n    constructor(sampleRate: number) {\r\n        this._context = new AudioContext({\r\n            latencyHint: \"interactive\",\r\n            sampleRate,\r\n        });\r\n    }\r\n\r\n    protected abstract feedCore(worklet: AudioWorkletNode, source: T): void;\r\n\r\n    public feed(source: T) {\r\n        if (this._worklet === undefined) {\r\n            this._buffer.push(source);\r\n            return;\r\n        }\r\n\r\n        this.feedCore(this._worklet, source);\r\n    }\r\n\r\n    public async start() {\r\n        await this._context.audioWorklet.addModule(\r\n            new URL(\"./worker.js\", import.meta.url)\r\n        );\r\n\r\n        this._worklet = new AudioWorkletNode(this._context, this.sourceName, {\r\n            numberOfInputs: 0,\r\n            numberOfOutputs: 1,\r\n            outputChannelCount: [2],\r\n        });\r\n        this._worklet.connect(this._context.destination);\r\n\r\n        for (const source of this._buffer) {\r\n            this.feedCore(this._worklet, source);\r\n        }\r\n        this._buffer.length = 0;\r\n    }\r\n\r\n    async stop() {\r\n        this._worklet?.disconnect();\r\n        this._worklet = undefined;\r\n\r\n        await this._context.close();\r\n    }\r\n}\r\n\r\nexport class Int16PcmPlayer extends PcmPlayer<Int16Array> {\r\n    protected override sourceName = \"int16-source-processor\";\r\n\r\n    protected override feedCore(worklet: AudioWorkletNode, source: Int16Array) {\r\n        if (\r\n            source.byteOffset !== 0 ||\r\n            source.byteLength !== source.buffer.byteLength\r\n        ) {\r\n            source = source.slice();\r\n        }\r\n\r\n        const { buffer } = source;\r\n        worklet.port.postMessage([buffer], [buffer]);\r\n    }\r\n}\r\n\r\nexport class Float32PcmPlayer extends PcmPlayer<Float32Array> {\r\n    protected override sourceName = \"float32-source-processor\";\r\n\r\n    protected override feedCore(\r\n        worklet: AudioWorkletNode,\r\n        source: Float32Array\r\n    ) {\r\n        if (\r\n            source.byteOffset !== 0 ||\r\n            source.byteLength !== source.buffer.byteLength\r\n        ) {\r\n            source = source.slice();\r\n        }\r\n\r\n        const { buffer } = source;\r\n        worklet.port.postMessage([buffer], [buffer]);\r\n    }\r\n}\r\n\r\nexport class Float32PlanerPcmPlayer extends PcmPlayer<Float32Array[]> {\r\n    protected override sourceName = \"float32-planer-source-processor\";\r\n\r\n    protected override feedCore(\r\n        worklet: AudioWorkletNode,\r\n        source: Float32Array[]\r\n    ) {\r\n        const buffers = source.map((channel) => {\r\n            if (\r\n                channel.byteOffset !== 0 ||\r\n                channel.byteLength !== channel.buffer.byteLength\r\n            ) {\r\n                channel = channel.slice();\r\n            }\r\n            return channel.buffer;\r\n        });\r\n        worklet.port.postMessage(buffers, buffers);\r\n    }\r\n}\r\n","import { ScrcpyMediaStreamPacket } from \"@yume-chan/scrcpy\";\r\nimport { TransformStream } from \"@yume-chan/stream-extra\";\r\n\r\nexport class AacDecodeStream extends TransformStream<\r\n    ScrcpyMediaStreamPacket,\r\n    Float32Array[]\r\n> {\r\n    constructor(config: AudioDecoderConfig) {\r\n        let decoder: AudioDecoder;\r\n        super({\r\n            start(controller) {\r\n                decoder = new AudioDecoder({\r\n                    error(error) {\r\n                        console.log(\"audio decoder error: \", error);\r\n                        controller.error(error);\r\n                    },\r\n                    output(output) {\r\n                        controller.enqueue(\r\n                            Array.from({ length: 2 }, (_, i) => {\r\n                                const options: AudioDataCopyToOptions = {\r\n                                    // AAC decodes to \"f32-planar\",\r\n                                    // converting to another format may cause audio glitches on Chrome.\r\n                                    format: \"f32-planar\",\r\n                                    planeIndex: i,\r\n                                };\r\n                                const buffer = new Float32Array(\r\n                                    output.allocationSize(options) /\r\n                                        Float32Array.BYTES_PER_ELEMENT\r\n                                );\r\n                                output.copyTo(buffer, options);\r\n                                return buffer;\r\n                            })\r\n                        );\r\n                    },\r\n                });\r\n            },\r\n            transform(chunk) {\r\n                switch (chunk.type) {\r\n                    case \"configuration\":\r\n                        // https://www.w3.org/TR/webcodecs-aac-codec-registration/#audiodecoderconfig-description\r\n                        // Raw AAC stream needs `description` to be set.\r\n                        decoder.configure({\r\n                            ...config,\r\n                            description: chunk.data,\r\n                        });\r\n                        break;\r\n                    case \"data\":\r\n                        decoder.decode(\r\n                            new EncodedAudioChunk({\r\n                                data: chunk.data,\r\n                                type: \"key\",\r\n                                timestamp: 0,\r\n                            })\r\n                        );\r\n                }\r\n            },\r\n            async flush() {\r\n                await decoder!.flush();\r\n            },\r\n        });\r\n    }\r\n}\r\n\r\nexport class OpusDecodeStream extends TransformStream<\r\n    ScrcpyMediaStreamPacket,\r\n    Float32Array\r\n> {\r\n    constructor(config: AudioDecoderConfig) {\r\n        let decoder: AudioDecoder;\r\n        super({\r\n            start(controller) {\r\n                decoder = new AudioDecoder({\r\n                    error(error) {\r\n                        console.log(\"audio decoder error: \", error);\r\n                        controller.error(error);\r\n                    },\r\n                    output(output) {\r\n                        // Opus decodes to \"f32\",\r\n                        // converting to another format may cause audio glitches on Chrome.\r\n                        const options: AudioDataCopyToOptions = {\r\n                            format: \"f32\",\r\n                            planeIndex: 0,\r\n                        };\r\n                        const buffer = new Float32Array(\r\n                            output.allocationSize(options) /\r\n                                Float32Array.BYTES_PER_ELEMENT\r\n                        );\r\n                        output.copyTo(buffer, options);\r\n                        controller.enqueue(buffer);\r\n                    },\r\n                });\r\n                decoder.configure(config);\r\n            },\r\n            transform(chunk) {\r\n                switch (chunk.type) {\r\n                    case \"configuration\":\r\n                        // configuration data is a opus-in-ogg identification header,\r\n                        // but stream data is raw opus,\r\n                        // so it has no use here.\r\n                        break;\r\n                    case \"data\":\r\n                        if (chunk.data.length === 0) {\r\n                            break;\r\n                        }\r\n                        decoder.decode(\r\n                            new EncodedAudioChunk({\r\n                                type: \"key\",\r\n                                timestamp: 0,\r\n                                data: chunk.data,\r\n                            })\r\n                        );\r\n                }\r\n            },\r\n            async flush() {\r\n                await decoder!.flush();\r\n            },\r\n        });\r\n    }\r\n}\r\n","import { EventEmitter } from \"@yume-chan/event\";\r\nimport { BIN } from \"@yume-chan/fetch-scrcpy-server\";\r\n\r\nclass FetchWithProgress {\r\n    public readonly promise: Promise<Uint8Array>;\r\n\r\n    private _downloaded = 0;\r\n    public get downloaded() {\r\n        return this._downloaded;\r\n    }\r\n\r\n    private _total = 0;\r\n    public get total() {\r\n        return this._total;\r\n    }\r\n\r\n    private progressEvent = new EventEmitter<\r\n        [download: number, total: number]\r\n    >();\r\n    public get onProgress() {\r\n        return this.progressEvent.event;\r\n    }\r\n\r\n    public constructor(url: string | URL) {\r\n        this.promise = this.fetch(url);\r\n    }\r\n\r\n    private async fetch(url: string | URL) {\r\n        const response = await globalThis.fetch(url);\r\n        this._total = Number.parseInt(\r\n            response.headers.get(\"Content-Length\") ?? \"0\",\r\n            10\r\n        );\r\n        this.progressEvent.fire([this._downloaded, this._total]);\r\n\r\n        const reader = response.body!.getReader();\r\n        const chunks: Uint8Array[] = [];\r\n        while (true) {\r\n            const result = await reader.read();\r\n            if (result.done) {\r\n                break;\r\n            }\r\n            chunks.push(result.value);\r\n            this._downloaded += result.value.byteLength;\r\n            this.progressEvent.fire([this._downloaded, this._total]);\r\n        }\r\n\r\n        this._total = chunks.reduce(\r\n            (result, item) => result + item.byteLength,\r\n            0\r\n        );\r\n        const result = new Uint8Array(this._total);\r\n        let position = 0;\r\n        for (const chunk of chunks) {\r\n            result.set(chunk, position);\r\n            position += chunk.byteLength;\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\nlet cachedValue: FetchWithProgress | undefined;\r\nexport function fetchServer(\r\n    onProgress?: (e: [downloaded: number, total: number]) => void\r\n) {\r\n    if (!cachedValue) {\r\n        cachedValue = new FetchWithProgress(BIN);\r\n        cachedValue.promise.catch(() => {\r\n            cachedValue = undefined;\r\n        });\r\n    }\r\n\r\n    if (onProgress) {\r\n        cachedValue.onProgress(onProgress);\r\n        onProgress([cachedValue.downloaded, cachedValue.total]);\r\n    }\r\n\r\n    return cachedValue.promise;\r\n}\r\n","import { AdbScrcpyClient } from \"@yume-chan/adb-scrcpy\";\r\nimport { AoaHidDevice, HidKeyCode, HidKeyboard } from \"@yume-chan/aoa\";\r\nimport { Disposable } from \"@yume-chan/event\";\r\nimport {\r\n    AndroidKeyCode,\r\n    AndroidKeyEventAction,\r\n    AndroidKeyEventMeta,\r\n} from \"@yume-chan/scrcpy\";\r\n\r\nexport interface KeyboardInjector extends Disposable {\r\n    down(key: string): Promise<void>;\r\n    up(key: string): Promise<void>;\r\n    reset(): Promise<void>;\r\n}\r\n\r\nexport class ScrcpyKeyboardInjector implements KeyboardInjector {\r\n    private readonly client: AdbScrcpyClient;\r\n\r\n    private _controlLeft = false;\r\n    private _controlRight = false;\r\n    private _shiftLeft = false;\r\n    private _shiftRight = false;\r\n    private _altLeft = false;\r\n    private _altRight = false;\r\n    private _metaLeft = false;\r\n    private _metaRight = false;\r\n\r\n    private _capsLock = false;\r\n    private _numLock = true;\r\n\r\n    private _keys: Set<AndroidKeyCode> = new Set();\r\n\r\n    public constructor(client: AdbScrcpyClient) {\r\n        this.client = client;\r\n    }\r\n\r\n    private setModifier(keyCode: AndroidKeyCode, value: boolean) {\r\n        switch (keyCode) {\r\n            case AndroidKeyCode.ControlLeft:\r\n                this._controlLeft = value;\r\n                break;\r\n            case AndroidKeyCode.ControlRight:\r\n                this._controlRight = value;\r\n                break;\r\n            case AndroidKeyCode.ShiftLeft:\r\n                this._shiftLeft = value;\r\n                break;\r\n            case AndroidKeyCode.ShiftRight:\r\n                this._shiftRight = value;\r\n                break;\r\n            case AndroidKeyCode.AltLeft:\r\n                this._altLeft = value;\r\n                break;\r\n            case AndroidKeyCode.AltRight:\r\n                this._altRight = value;\r\n                break;\r\n            case AndroidKeyCode.MetaLeft:\r\n                this._metaLeft = value;\r\n                break;\r\n            case AndroidKeyCode.MetaRight:\r\n                this._metaRight = value;\r\n                break;\r\n            case AndroidKeyCode.CapsLock:\r\n                if (value) {\r\n                    this._capsLock = !this._capsLock;\r\n                }\r\n                break;\r\n            case AndroidKeyCode.NumLock:\r\n                if (value) {\r\n                    this._numLock = !this._numLock;\r\n                }\r\n                break;\r\n        }\r\n    }\r\n\r\n    private getMetaState(): AndroidKeyEventMeta {\r\n        let metaState = 0;\r\n        if (this._altLeft) {\r\n            metaState |=\r\n                AndroidKeyEventMeta.AltOn | AndroidKeyEventMeta.AltLeftOn;\r\n        }\r\n        if (this._altRight) {\r\n            metaState |=\r\n                AndroidKeyEventMeta.AltOn | AndroidKeyEventMeta.AltRightOn;\r\n        }\r\n        if (this._shiftLeft) {\r\n            metaState |=\r\n                AndroidKeyEventMeta.ShiftOn | AndroidKeyEventMeta.ShiftLeftOn;\r\n        }\r\n        if (this._shiftRight) {\r\n            metaState |=\r\n                AndroidKeyEventMeta.ShiftOn | AndroidKeyEventMeta.ShiftRightOn;\r\n        }\r\n        if (this._controlLeft) {\r\n            metaState |=\r\n                AndroidKeyEventMeta.CtrlOn | AndroidKeyEventMeta.CtrlLeftOn;\r\n        }\r\n        if (this._controlRight) {\r\n            metaState |=\r\n                AndroidKeyEventMeta.CtrlOn | AndroidKeyEventMeta.CtrlRightOn;\r\n        }\r\n        if (this._metaLeft) {\r\n            metaState |=\r\n                AndroidKeyEventMeta.MetaOn | AndroidKeyEventMeta.MetaLeftOn;\r\n        }\r\n        if (this._metaRight) {\r\n            metaState |=\r\n                AndroidKeyEventMeta.MetaOn | AndroidKeyEventMeta.MetaRightOn;\r\n        }\r\n        if (this._capsLock) {\r\n            metaState |= AndroidKeyEventMeta.CapsLockOn;\r\n        }\r\n        if (this._numLock) {\r\n            metaState |= AndroidKeyEventMeta.NumLockOn;\r\n        }\r\n        return metaState;\r\n    }\r\n\r\n    public async down(key: string): Promise<void> {\r\n        const keyCode = AndroidKeyCode[key as keyof typeof AndroidKeyCode];\r\n        if (!keyCode) {\r\n            return;\r\n        }\r\n\r\n        this.setModifier(keyCode, true);\r\n        this._keys.add(keyCode);\r\n        await this.client.controlMessageWriter?.injectKeyCode({\r\n            action: AndroidKeyEventAction.Down,\r\n            keyCode,\r\n            metaState: this.getMetaState(),\r\n            repeat: 0,\r\n        });\r\n    }\r\n\r\n    public async up(key: string): Promise<void> {\r\n        const keyCode = AndroidKeyCode[key as keyof typeof AndroidKeyCode];\r\n        if (!keyCode) {\r\n            return;\r\n        }\r\n\r\n        this.setModifier(keyCode, false);\r\n        this._keys.delete(keyCode);\r\n        await this.client.controlMessageWriter?.injectKeyCode({\r\n            action: AndroidKeyEventAction.Up,\r\n            keyCode,\r\n            metaState: this.getMetaState(),\r\n            repeat: 0,\r\n        });\r\n    }\r\n\r\n    public async reset(): Promise<void> {\r\n        this._controlLeft = false;\r\n        this._controlRight = false;\r\n        this._shiftLeft = false;\r\n        this._shiftRight = false;\r\n        this._altLeft = false;\r\n        this._altRight = false;\r\n        this._metaLeft = false;\r\n        this._metaRight = false;\r\n        for (const key of this._keys) {\r\n            this.up(AndroidKeyCode[key]);\r\n        }\r\n        this._keys.clear();\r\n    }\r\n\r\n    public dispose(): void {\r\n        // do nothing\r\n    }\r\n}\r\n\r\nexport class AoaKeyboardInjector implements KeyboardInjector {\r\n    public static async register(\r\n        device: USBDevice\r\n    ): Promise<AoaKeyboardInjector> {\r\n        const keyboard = await AoaHidDevice.register(\r\n            device,\r\n            0,\r\n            HidKeyboard.DESCRIPTOR\r\n        );\r\n        return new AoaKeyboardInjector(keyboard);\r\n    }\r\n\r\n    private readonly aoaKeyboard: AoaHidDevice;\r\n    private readonly hidKeyboard = new HidKeyboard();\r\n\r\n    public constructor(aoaKeyboard: AoaHidDevice) {\r\n        this.aoaKeyboard = aoaKeyboard;\r\n    }\r\n\r\n    public async down(key: string): Promise<void> {\r\n        const keyCode = HidKeyCode[key as keyof typeof HidKeyCode];\r\n        if (!keyCode) {\r\n            return;\r\n        }\r\n\r\n        this.hidKeyboard.down(keyCode);\r\n        await this.aoaKeyboard.sendInputReport(\r\n            this.hidKeyboard.serializeInputReport()\r\n        );\r\n    }\r\n\r\n    public async up(key: string): Promise<void> {\r\n        const keyCode = HidKeyCode[key as keyof typeof HidKeyCode];\r\n        if (!keyCode) {\r\n            return;\r\n        }\r\n\r\n        this.hidKeyboard.up(keyCode);\r\n        await this.aoaKeyboard.sendInputReport(\r\n            this.hidKeyboard.serializeInputReport()\r\n        );\r\n    }\r\n\r\n    public async reset(): Promise<void> {\r\n        this.hidKeyboard.reset();\r\n        await this.aoaKeyboard.sendInputReport(\r\n            this.hidKeyboard.serializeInputReport()\r\n        );\r\n    }\r\n\r\n    public async dispose(): Promise<void> {\r\n        await this.aoaKeyboard.unregister();\r\n    }\r\n}\r\n","import { PromiseResolver } from \"@yume-chan/async\";\r\nimport { AutoDisposable, EventEmitter } from \"@yume-chan/event\";\r\nimport type { Disposable } from \"@yume-chan/event\";\r\n\r\nlet worker: Worker | undefined;\r\nlet workerReady = false;\r\nconst pendingResolvers: PromiseResolver<TinyH264Wrapper>[] = [];\r\nlet streamId = 0;\r\n\r\nexport interface PictureReadyEventArgs {\r\n    renderStateId: number;\r\n\r\n    width: number;\r\n\r\n    height: number;\r\n\r\n    data: ArrayBuffer;\r\n}\r\n\r\nconst PICTURE_READY_SUBSCRIPTIONS = new Map<\r\n    number,\r\n    (e: PictureReadyEventArgs) => void\r\n>();\r\n\r\nfunction subscribePictureReady(\r\n    streamId: number,\r\n    handler: (e: PictureReadyEventArgs) => void\r\n): Disposable {\r\n    PICTURE_READY_SUBSCRIPTIONS.set(streamId, handler);\r\n\r\n    return {\r\n        dispose() {\r\n            PICTURE_READY_SUBSCRIPTIONS.delete(streamId);\r\n        },\r\n    };\r\n}\r\n\r\nexport class TinyH264Wrapper extends AutoDisposable {\r\n    public readonly streamId: number;\r\n\r\n    private readonly pictureReadyEvent =\r\n        new EventEmitter<PictureReadyEventArgs>();\r\n    public get onPictureReady() {\r\n        return this.pictureReadyEvent.event;\r\n    }\r\n\r\n    public constructor(streamId: number) {\r\n        super();\r\n\r\n        this.streamId = streamId;\r\n        this.addDisposable(\r\n            subscribePictureReady(streamId, this.handlePictureReady)\r\n        );\r\n    }\r\n\r\n    private handlePictureReady = (e: PictureReadyEventArgs) => {\r\n        this.pictureReadyEvent.fire(e);\r\n    };\r\n\r\n    public feed(data: ArrayBuffer) {\r\n        worker!.postMessage(\r\n            {\r\n                type: \"decode\",\r\n                data: data,\r\n                offset: 0,\r\n                length: data.byteLength,\r\n                renderStateId: this.streamId,\r\n            },\r\n            [data]\r\n        );\r\n    }\r\n\r\n    public override dispose() {\r\n        super.dispose();\r\n        worker!.postMessage({\r\n            type: \"release\",\r\n            renderStateId: this.streamId,\r\n        });\r\n    }\r\n}\r\n\r\ninterface TinyH264MessageBase {\r\n    type: string;\r\n}\r\n\r\ninterface TinyH264DecoderReadyMessage extends TinyH264MessageBase {\r\n    type: \"decoderReady\";\r\n}\r\n\r\ninterface TinyH264PictureReadyMessage\r\n    extends TinyH264MessageBase,\r\n        PictureReadyEventArgs {\r\n    type: \"pictureReady\";\r\n}\r\n\r\ntype TinyH264Message =\r\n    | TinyH264DecoderReadyMessage\r\n    | TinyH264PictureReadyMessage;\r\n\r\nexport function createTinyH264Wrapper(): Promise<TinyH264Wrapper> {\r\n    if (!worker) {\r\n        worker = new Worker(new URL(\"./worker.js\", import.meta.url));\r\n        worker.addEventListener(\r\n            \"message\",\r\n            ({ data }: MessageEvent<TinyH264Message>) => {\r\n                switch (data.type) {\r\n                    case \"decoderReady\":\r\n                        workerReady = true;\r\n                        for (const resolver of pendingResolvers) {\r\n                            resolver.resolve(new TinyH264Wrapper(streamId));\r\n                            streamId += 1;\r\n                        }\r\n                        pendingResolvers.length = 0;\r\n                        break;\r\n                    case \"pictureReady\":\r\n                        PICTURE_READY_SUBSCRIPTIONS.get(data.renderStateId)?.(\r\n                            data\r\n                        );\r\n                        break;\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    if (!workerReady) {\r\n        const resolver = new PromiseResolver<TinyH264Wrapper>();\r\n        pendingResolvers.push(resolver);\r\n        return resolver.promise;\r\n    }\r\n\r\n    const decoder = new TinyH264Wrapper(streamId);\r\n    streamId += 1;\r\n    return Promise.resolve(decoder);\r\n}\r\n","import { PromiseResolver } from \"@yume-chan/async\";\r\nimport type { ScrcpyMediaStreamPacket } from \"@yume-chan/scrcpy\";\r\nimport {\r\n    AndroidAvcLevel,\r\n    AndroidAvcProfile,\r\n    h264ParseConfiguration,\r\n} from \"@yume-chan/scrcpy\";\r\nimport { WritableStream } from \"@yume-chan/stream-extra\";\r\nimport type { default as YuvBuffer } from \"yuv-buffer\";\r\nimport type { default as YuvCanvas } from \"yuv-canvas\";\r\n\r\nimport type {\r\n    ScrcpyVideoDecoder,\r\n    ScrcpyVideoDecoderCapability,\r\n} from \"./types.js\";\r\nimport type { TinyH264Wrapper } from \"./wrapper.js\";\r\nimport { createTinyH264Wrapper } from \"./wrapper.js\";\r\n\r\nconst NOOP = () => {\r\n    // no-op\r\n};\r\n\r\nlet cachedInitializePromise:\r\n    | Promise<{ YuvBuffer: typeof YuvBuffer; YuvCanvas: typeof YuvCanvas }>\r\n    | undefined;\r\nfunction initialize() {\r\n    if (!cachedInitializePromise) {\r\n        cachedInitializePromise = Promise.all([\r\n            import(\"yuv-buffer\"),\r\n            import(\"yuv-canvas\"),\r\n        ]).then(([YuvBuffer, { default: YuvCanvas }]) => ({\r\n            YuvBuffer,\r\n            YuvCanvas,\r\n        }));\r\n    }\r\n\r\n    return cachedInitializePromise;\r\n}\r\n\r\nexport class TinyH264Decoder implements ScrcpyVideoDecoder {\r\n    public static readonly capabilities: Record<\r\n        string,\r\n        ScrcpyVideoDecoderCapability\r\n    > = {\r\n        h264: {\r\n            maxProfile: AndroidAvcProfile.Baseline,\r\n            maxLevel: AndroidAvcLevel.Level4,\r\n        },\r\n    };\r\n\r\n    private _renderer: HTMLCanvasElement;\r\n    public get renderer() {\r\n        return this._renderer;\r\n    }\r\n\r\n    private _frameRendered = 0;\r\n    public get frameRendered() {\r\n        return this._frameRendered;\r\n    }\r\n\r\n    private _frameSkipped = 0;\r\n    public get frameSkipped() {\r\n        return this._frameSkipped;\r\n    }\r\n\r\n    private _writable: WritableStream<ScrcpyMediaStreamPacket>;\r\n    public get writable() {\r\n        return this._writable;\r\n    }\r\n\r\n    private _yuvCanvas: YuvCanvas | undefined;\r\n    private _initializer: PromiseResolver<TinyH264Wrapper> | undefined;\r\n\r\n    public constructor() {\r\n        void initialize();\r\n\r\n        this._renderer = document.createElement(\"canvas\");\r\n\r\n        this._writable = new WritableStream<ScrcpyMediaStreamPacket>({\r\n            write: async (packet) => {\r\n                switch (packet.type) {\r\n                    case \"configuration\":\r\n                        await this.configure(packet.data);\r\n                        break;\r\n                    case \"data\": {\r\n                        if (!this._initializer) {\r\n                            throw new Error(\"Decoder not configured\");\r\n                        }\r\n\r\n                        const wrapper = await this._initializer.promise;\r\n                        wrapper.feed(packet.data.slice().buffer);\r\n                        break;\r\n                    }\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    private async configure(data: Uint8Array) {\r\n        this.dispose();\r\n\r\n        this._initializer = new PromiseResolver<TinyH264Wrapper>();\r\n        const { YuvBuffer, YuvCanvas } = await initialize();\r\n\r\n        if (!this._yuvCanvas) {\r\n            this._yuvCanvas = YuvCanvas.attach(this._renderer);\r\n        }\r\n\r\n        const {\r\n            encodedWidth,\r\n            encodedHeight,\r\n            croppedWidth,\r\n            croppedHeight,\r\n            cropLeft,\r\n            cropTop,\r\n        } = h264ParseConfiguration(data);\r\n\r\n        // H.264 Baseline profile only supports YUV 420 pixel format\r\n        const chromaWidth = encodedWidth / 2;\r\n        const chromaHeight = encodedHeight / 2;\r\n\r\n        // YUVCanvas will set canvas size when format changes\r\n        const format = YuvBuffer.format({\r\n            width: encodedWidth,\r\n            height: encodedHeight,\r\n            chromaWidth,\r\n            chromaHeight,\r\n            cropLeft: cropLeft,\r\n            cropTop: cropTop,\r\n            cropWidth: croppedWidth,\r\n            cropHeight: croppedHeight,\r\n            displayWidth: croppedWidth,\r\n            displayHeight: croppedHeight,\r\n        });\r\n\r\n        const wrapper = await createTinyH264Wrapper();\r\n        this._initializer.resolve(wrapper);\r\n\r\n        const uPlaneOffset = encodedWidth * encodedHeight;\r\n        const vPlaneOffset = uPlaneOffset + chromaWidth * chromaHeight;\r\n        wrapper.onPictureReady(({ data }) => {\r\n            this._frameRendered += 1;\r\n            const array = new Uint8Array(data);\r\n            const frame = YuvBuffer.frame(\r\n                format,\r\n                YuvBuffer.lumaPlane(format, array, encodedWidth, 0),\r\n                YuvBuffer.chromaPlane(format, array, chromaWidth, uPlaneOffset),\r\n                YuvBuffer.chromaPlane(format, array, chromaWidth, vPlaneOffset)\r\n            );\r\n            this._yuvCanvas!.drawFrame(frame);\r\n        });\r\n\r\n        wrapper.feed(data.slice().buffer);\r\n    }\r\n\r\n    public dispose(): void {\r\n        this._initializer?.promise\r\n            .then((wrapper) => wrapper.dispose())\r\n            // NOOP: It's disposed so nobody cares about the error\r\n            .catch(NOOP);\r\n        this._initializer = undefined;\r\n    }\r\n}\r\n","export * from \"./decoder.js\";\r\nexport * from \"./types.js\";\r\nexport * from \"./wrapper.js\";\r\n","import {\r\n    Dropdown,\r\n    IDropdownOption,\r\n    Icon,\r\n    IconButton,\r\n    Position,\r\n    SpinButton,\r\n    Stack,\r\n    TextField,\r\n    Toggle,\r\n    TooltipHost,\r\n} from \"@fluentui/react\";\r\nimport { makeStyles } from \"@griffel/react\";\r\nimport { AdbSyncError } from \"@yume-chan/adb\";\r\nimport { AdbScrcpyClient, AdbScrcpyOptionsLatest } from \"@yume-chan/adb-scrcpy\";\r\nimport {\r\n    DEFAULT_SERVER_PATH,\r\n    ScrcpyDisplay,\r\n    ScrcpyEncoder,\r\n    ScrcpyLogLevel,\r\n    ScrcpyOptionsInitLatest,\r\n    ScrcpyOptionsLatest,\r\n    ScrcpyVideoOrientation,\r\n} from \"@yume-chan/scrcpy\";\r\nimport {\r\n    ScrcpyVideoDecoderConstructor,\r\n    TinyH264Decoder,\r\n} from \"@yume-chan/scrcpy-decoder-tinyh264\";\r\nimport { VERSION } from \"@yume-chan/fetch-scrcpy-server\";\r\nimport { DecodeUtf8Stream, GatherStringStream } from \"@yume-chan/stream-extra\";\r\nimport {\r\n    autorun,\r\n    computed,\r\n    makeAutoObservable,\r\n    observable,\r\n    runInAction,\r\n} from \"mobx\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { GLOBAL_STATE } from \"../../state\";\r\nimport { Icons } from \"../../utils\";\r\nimport { STATE } from \"./state\";\r\n\r\nexport type Settings = ScrcpyOptionsInitLatest;\r\n\r\nexport interface ClientSettings {\r\n    turnScreenOff?: boolean;\r\n    decoder?: string;\r\n    ignoreDecoderCodecArgs?: boolean;\r\n}\r\n\r\nexport type SettingKeys = keyof (Settings & ClientSettings);\r\n\r\nexport interface SettingDefinitionBase {\r\n    group: \"settings\" | \"clientSettings\";\r\n    key: SettingKeys;\r\n    type: string;\r\n    label: string;\r\n    labelExtra?: JSX.Element;\r\n    description?: string;\r\n}\r\n\r\nexport interface TextSettingDefinition extends SettingDefinitionBase {\r\n    type: \"text\";\r\n    placeholder?: string;\r\n}\r\n\r\nexport interface DropdownSettingDefinition extends SettingDefinitionBase {\r\n    type: \"dropdown\";\r\n    placeholder?: string;\r\n    options: IDropdownOption[];\r\n}\r\n\r\nexport interface ToggleSettingDefinition extends SettingDefinitionBase {\r\n    type: \"toggle\";\r\n    disabled?: boolean;\r\n}\r\n\r\nexport interface NumberSettingDefinition extends SettingDefinitionBase {\r\n    type: \"number\";\r\n    min?: number;\r\n    max?: number;\r\n    step?: number;\r\n}\r\n\r\nexport type SettingDefinition =\r\n    | TextSettingDefinition\r\n    | DropdownSettingDefinition\r\n    | ToggleSettingDefinition\r\n    | NumberSettingDefinition;\r\n\r\ninterface SettingItemProps {\r\n    definition: SettingDefinition;\r\n    value: any;\r\n    onChange: (definition: SettingDefinition, value: any) => void;\r\n}\r\n\r\nconst useClasses = makeStyles({\r\n    labelRight: {\r\n        marginLeft: \"4px\",\r\n    },\r\n    item: {\r\n        width: \"100%\",\r\n        maxWidth: \"300px\",\r\n    },\r\n});\r\n\r\nexport const SettingItem = observer(function SettingItem({\r\n    definition,\r\n    value,\r\n    onChange,\r\n}: SettingItemProps) {\r\n    const classes = useClasses();\r\n\r\n    let label: JSX.Element = (\r\n        <Stack horizontal verticalAlign=\"center\">\r\n            <span>{definition.label}</span>\r\n            {!!definition.description && (\r\n                <TooltipHost content={definition.description}>\r\n                    <Icon\r\n                        className={classes.labelRight}\r\n                        iconName={Icons.Info}\r\n                    />\r\n                </TooltipHost>\r\n            )}\r\n            {definition.labelExtra}\r\n        </Stack>\r\n    );\r\n\r\n    switch (definition.type) {\r\n        case \"text\":\r\n            return (\r\n                <TextField\r\n                    className={classes.item}\r\n                    label={label as any}\r\n                    placeholder={definition.placeholder}\r\n                    value={value}\r\n                    onChange={(e, value) => onChange(definition, value)}\r\n                />\r\n            );\r\n        case \"dropdown\":\r\n            return (\r\n                <Dropdown\r\n                    className={classes.item}\r\n                    label={label as any}\r\n                    options={definition.options}\r\n                    placeholder={definition.placeholder}\r\n                    selectedKey={value}\r\n                    onChange={(e, option) => onChange(definition, option!.key)}\r\n                />\r\n            );\r\n        case \"toggle\":\r\n            return (\r\n                <Toggle\r\n                    label={label}\r\n                    checked={value}\r\n                    disabled={definition.disabled}\r\n                    onChange={(e, checked) => onChange(definition, checked)}\r\n                />\r\n            );\r\n        case \"number\":\r\n            return (\r\n                <SpinButton\r\n                    className={classes.item}\r\n                    label={definition.label}\r\n                    labelPosition={Position.top}\r\n                    min={definition.min}\r\n                    max={definition.max}\r\n                    step={definition.step}\r\n                    value={value.toString()}\r\n                    onChange={(e, value) =>\r\n                        onChange(definition, Number.parseInt(value!, 10))\r\n                    }\r\n                />\r\n            );\r\n    }\r\n});\r\n\r\nexport interface DecoderDefinition {\r\n    key: string;\r\n    name: string;\r\n    Constructor: ScrcpyVideoDecoderConstructor;\r\n}\r\n\r\nconst DEFAULT_SETTINGS = {\r\n    maxSize: 1080,\r\n    videoBitRate: 4_000_000,\r\n    videoCodec: \"h264\",\r\n    lockVideoOrientation: ScrcpyVideoOrientation.Unlocked,\r\n    displayId: 0,\r\n    crop: \"\",\r\n    powerOn: true,\r\n    audio: true,\r\n    audioCodec: \"aac\",\r\n} as Settings;\r\n\r\nexport const SETTING_STATE = makeAutoObservable(\r\n    {\r\n        displays: [] as ScrcpyDisplay[],\r\n        encoders: [] as ScrcpyEncoder[],\r\n        decoders: [\r\n            {\r\n                key: \"tinyh264\",\r\n                name: \"TinyH264 (Software)\",\r\n                Constructor: TinyH264Decoder,\r\n            },\r\n        ] as DecoderDefinition[],\r\n\r\n        settings: DEFAULT_SETTINGS,\r\n\r\n        clientSettings: {} as ClientSettings,\r\n    },\r\n    {\r\n        decoders: observable.shallow,\r\n        settings: observable.deep,\r\n        clientSettings: observable.deep,\r\n    }\r\n);\r\n\r\nexport const SCRCPY_SETTINGS_FILENAME = \"/data/local/tmp/.tango.json\";\r\n\r\nautorun(() => {\r\n    if (GLOBAL_STATE.adb) {\r\n        (async () => {\r\n            const sync = await GLOBAL_STATE.adb!.sync();\r\n            try {\r\n                const content = new GatherStringStream();\r\n                await sync\r\n                    .read(SCRCPY_SETTINGS_FILENAME)\r\n                    .pipeThrough(new DecodeUtf8Stream())\r\n                    .pipeTo(content);\r\n                const settings = JSON.parse(content.result);\r\n                runInAction(() => {\r\n                    SETTING_STATE.settings = {\r\n                        ...DEFAULT_SETTINGS,\r\n                        ...settings.settings,\r\n                    };\r\n                    SETTING_STATE.clientSettings = settings.clientSettings;\r\n                });\r\n            } catch (e) {\r\n                if (!(e instanceof AdbSyncError)) {\r\n                    throw e;\r\n                }\r\n            } finally {\r\n                await sync.dispose();\r\n            }\r\n        })();\r\n\r\n        runInAction(() => {\r\n            SETTING_STATE.encoders = [];\r\n            SETTING_STATE.displays = [];\r\n            SETTING_STATE.settings.displayId = undefined;\r\n        });\r\n    }\r\n});\r\n\r\nautorun(() => {\r\n    SETTING_STATE.clientSettings.decoder = SETTING_STATE.decoders[0].key;\r\n});\r\n\r\nexport const SETTING_DEFINITIONS = computed(() => {\r\n    const result: SettingDefinition[] = [];\r\n\r\n    result.push(\r\n        {\r\n            group: \"settings\",\r\n            key: \"powerOn\",\r\n            type: \"toggle\",\r\n            label: \"Wake device up on start\",\r\n        },\r\n        {\r\n            group: \"clientSettings\",\r\n            key: \"turnScreenOff\",\r\n            type: \"toggle\",\r\n            label: \"Turn screen off during mirroring\",\r\n        },\r\n        {\r\n            group: \"settings\",\r\n            key: \"stayAwake\",\r\n            type: \"toggle\",\r\n            label: \"Stay awake during mirroring (if plugged in)\",\r\n        },\r\n        {\r\n            group: \"settings\",\r\n            key: \"powerOffOnClose\",\r\n            type: \"toggle\",\r\n            label: \"Turn device off on stop\",\r\n        }\r\n    );\r\n\r\n    result.push({\r\n        group: \"settings\",\r\n        key: \"displayId\",\r\n        type: \"dropdown\",\r\n        label: \"Display\",\r\n        placeholder: \"Press refresh to update available displays\",\r\n        labelExtra: (\r\n            <IconButton\r\n                iconProps={{ iconName: Icons.ArrowClockwise }}\r\n                disabled={!GLOBAL_STATE.adb}\r\n                text=\"Refresh\"\r\n                onClick={async () => {\r\n                    try {\r\n                        await STATE.pushServer();\r\n\r\n                        const displays = await AdbScrcpyClient.getDisplays(\r\n                            GLOBAL_STATE.adb!,\r\n                            DEFAULT_SERVER_PATH,\r\n                            VERSION,\r\n                            new AdbScrcpyOptionsLatest(\r\n                                new ScrcpyOptionsLatest({\r\n                                    logLevel: ScrcpyLogLevel.Debug,\r\n                                })\r\n                            )\r\n                        );\r\n\r\n                        runInAction(() => {\r\n                            SETTING_STATE.displays = displays;\r\n                            if (\r\n                                !SETTING_STATE.settings.displayId ||\r\n                                !SETTING_STATE.displays.some(\r\n                                    (x) =>\r\n                                        x.id ===\r\n                                        SETTING_STATE.settings.displayId\r\n                                )\r\n                            ) {\r\n                                SETTING_STATE.settings.displayId =\r\n                                    SETTING_STATE.displays[0]?.id;\r\n                            }\r\n                        });\r\n                    } catch (e: any) {\r\n                        GLOBAL_STATE.showErrorDialog(e);\r\n                    }\r\n                }}\r\n            />\r\n        ),\r\n        options: SETTING_STATE.displays.map((item) => ({\r\n            key: item.id,\r\n            text: `${item.id}${item.resolution ? ` (${item.resolution})` : \"\"}`,\r\n        })),\r\n    });\r\n\r\n    result.push({\r\n        group: \"settings\",\r\n        key: \"crop\",\r\n        type: \"text\",\r\n        label: \"Crop\",\r\n        placeholder: \"W:H:X:Y\",\r\n    });\r\n\r\n    result.push(\r\n        {\r\n            group: \"settings\",\r\n            key: \"maxSize\",\r\n            type: \"number\",\r\n            label: \"Max Resolution (longer side, 0 = unlimited)\",\r\n            min: 0,\r\n            max: 2560,\r\n            step: 50,\r\n        },\r\n        {\r\n            group: \"settings\",\r\n            key: \"videoBitRate\",\r\n            type: \"number\",\r\n            label: \"Max Video Bitrate (bps)\",\r\n            min: 100,\r\n            max: 100_000_000,\r\n            step: 100,\r\n        },\r\n        {\r\n            group: \"settings\",\r\n            key: \"videoCodec\",\r\n            type: \"dropdown\",\r\n            label: \"Video Codec\",\r\n            options: [\r\n                {\r\n                    key: \"h264\",\r\n                    text: \"H.264\",\r\n                },\r\n                {\r\n                    key: \"h265\",\r\n                    text: \"H.265\",\r\n                },\r\n            ],\r\n        },\r\n        {\r\n            group: \"settings\",\r\n            key: \"videoEncoder\",\r\n            type: \"dropdown\",\r\n            label: \"Video Encoder\",\r\n            placeholder:\r\n                SETTING_STATE.encoders.length === 0\r\n                    ? \"Press refresh button to update encoder list\"\r\n                    : \"(default)\",\r\n            labelExtra: (\r\n                <IconButton\r\n                    iconProps={{ iconName: Icons.ArrowClockwise }}\r\n                    disabled={!GLOBAL_STATE.adb}\r\n                    text=\"Refresh\"\r\n                    onClick={async () => {\r\n                        try {\r\n                            await STATE.pushServer();\r\n\r\n                            const encoders = await AdbScrcpyClient.getEncoders(\r\n                                GLOBAL_STATE.adb!,\r\n                                DEFAULT_SERVER_PATH,\r\n                                VERSION,\r\n                                new AdbScrcpyOptionsLatest(\r\n                                    new ScrcpyOptionsLatest({\r\n                                        logLevel: ScrcpyLogLevel.Debug,\r\n                                    })\r\n                                )\r\n                            );\r\n\r\n                            runInAction(() => {\r\n                                SETTING_STATE.encoders = encoders;\r\n                            });\r\n                        } catch (e: any) {\r\n                            GLOBAL_STATE.showErrorDialog(e);\r\n                        }\r\n                    }}\r\n                />\r\n            ),\r\n            options: SETTING_STATE.encoders\r\n                .filter(\r\n                    (item) =>\r\n                        item.type === \"video\" &&\r\n                        (!item.codec ||\r\n                            item.codec === SETTING_STATE.settings.videoCodec!)\r\n                )\r\n                .map((item) => ({\r\n                    key: item.name,\r\n                    text: item.name,\r\n                })),\r\n        }\r\n    );\r\n\r\n    result.push({\r\n        group: \"settings\",\r\n        key: \"lockVideoOrientation\",\r\n        type: \"dropdown\",\r\n        label: \"Lock Video Orientation\",\r\n        options: [\r\n            {\r\n                key: ScrcpyVideoOrientation.Unlocked,\r\n                text: \"Unlocked\",\r\n            },\r\n            {\r\n                key: ScrcpyVideoOrientation.Initial,\r\n                text: \"Current\",\r\n            },\r\n            {\r\n                key: ScrcpyVideoOrientation.Portrait,\r\n                text: \"Portrait\",\r\n            },\r\n            {\r\n                key: ScrcpyVideoOrientation.Landscape,\r\n                text: \"Landscape\",\r\n            },\r\n            {\r\n                key: ScrcpyVideoOrientation.PortraitFlipped,\r\n                text: \"Portrait (Flipped)\",\r\n            },\r\n            {\r\n                key: ScrcpyVideoOrientation.LandscapeFlipped,\r\n                text: \"Landscape (Flipped)\",\r\n            },\r\n        ],\r\n    });\r\n\r\n    if (SETTING_STATE.decoders.length > 1) {\r\n        result.push({\r\n            group: \"clientSettings\",\r\n            key: \"decoder\",\r\n            type: \"dropdown\",\r\n            label: \"Video Decoder\",\r\n            options: SETTING_STATE.decoders.map((item) => ({\r\n                key: item.key,\r\n                text: item.name,\r\n                data: item,\r\n            })),\r\n        });\r\n    }\r\n\r\n    result.push({\r\n        group: \"clientSettings\",\r\n        key: \"ignoreDecoderCodecArgs\",\r\n        type: \"toggle\",\r\n        label: `Ignore video decoder's codec options`,\r\n        description: `Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used.`,\r\n    });\r\n\r\n    result.push(\r\n        {\r\n            group: \"settings\",\r\n            key: \"audio\",\r\n            type: \"toggle\",\r\n            label: \"Forward Audio (Requires Android 11)\",\r\n        },\r\n        {\r\n            group: \"settings\",\r\n            key: \"audioCodec\",\r\n            type: \"dropdown\",\r\n            label: \"Audio Codec\",\r\n            options: [\r\n                {\r\n                    key: \"raw\",\r\n                    text: \"Raw\",\r\n                },\r\n                {\r\n                    key: \"aac\",\r\n                    text: \"AAC\",\r\n                },\r\n                {\r\n                    key: \"opus\",\r\n                    text: \"Opus\",\r\n                },\r\n            ],\r\n        },\r\n        {\r\n            group: \"settings\",\r\n            key: \"audioEncoder\",\r\n            type: \"dropdown\",\r\n            placeholder:\r\n                SETTING_STATE.encoders.length === 0\r\n                    ? \"Press refresh button to update encoder list\"\r\n                    : \"(default)\",\r\n            label: \"Audio Encoder\",\r\n            labelExtra: (\r\n                <IconButton\r\n                    iconProps={{ iconName: Icons.ArrowClockwise }}\r\n                    disabled={!GLOBAL_STATE.adb}\r\n                    text=\"Refresh\"\r\n                    onClick={async () => {\r\n                        try {\r\n                            await STATE.pushServer();\r\n\r\n                            const encoders = await AdbScrcpyClient.getEncoders(\r\n                                GLOBAL_STATE.adb!,\r\n                                DEFAULT_SERVER_PATH,\r\n                                VERSION,\r\n                                new AdbScrcpyOptionsLatest(\r\n                                    new ScrcpyOptionsLatest({\r\n                                        logLevel: ScrcpyLogLevel.Debug,\r\n                                    })\r\n                                )\r\n                            );\r\n\r\n                            runInAction(() => {\r\n                                SETTING_STATE.encoders = encoders;\r\n                            });\r\n                        } catch (e: any) {\r\n                            GLOBAL_STATE.showErrorDialog(e);\r\n                        }\r\n                    }}\r\n                />\r\n            ),\r\n            options: SETTING_STATE.encoders\r\n                .filter(\r\n                    (x) =>\r\n                        x.type === \"audio\" &&\r\n                        x.codec === SETTING_STATE.settings.audioCodec\r\n                )\r\n                .map((item) => ({\r\n                    key: item.name,\r\n                    text: item.name,\r\n                })),\r\n        }\r\n    );\r\n\r\n    return result;\r\n});\r\n\r\nautorun(() => {\r\n    if (SETTING_STATE.encoders.length === 0) {\r\n        SETTING_STATE.settings.videoEncoder = \"\";\r\n        SETTING_STATE.settings.audioEncoder = \"\";\r\n        return;\r\n    }\r\n\r\n    const encodersForCurrentVideoCodec = SETTING_STATE.encoders.filter(\r\n        (item) =>\r\n            item.type === \"video\" &&\r\n            item.codec === SETTING_STATE.settings.videoCodec\r\n    );\r\n    if (\r\n        SETTING_STATE.settings.videoEncoder &&\r\n        encodersForCurrentVideoCodec.every(\r\n            (item) => item.name !== SETTING_STATE.settings.videoEncoder\r\n        )\r\n    ) {\r\n        SETTING_STATE.settings.videoEncoder = \"\";\r\n    }\r\n\r\n    const encodersForCurrentAudioCodec = SETTING_STATE.encoders.filter(\r\n        (item) =>\r\n            item.type === \"audio\" &&\r\n            item.codec === SETTING_STATE.settings.audioCodec\r\n    );\r\n    if (\r\n        SETTING_STATE.settings.audioEncoder &&\r\n        encodersForCurrentAudioCodec.every(\r\n            (item) => item.name !== SETTING_STATE.settings.audioEncoder\r\n        )\r\n    ) {\r\n        SETTING_STATE.settings.audioEncoder = \"\";\r\n    }\r\n});\r\n","import { ADB_SYNC_MAX_PACKET_SIZE, encodeUtf8 } from \"@yume-chan/adb\";\r\nimport { AdbDaemonWebUsbDevice } from \"@yume-chan/adb-daemon-webusb\";\r\nimport { AdbScrcpyClient, AdbScrcpyOptionsLatest } from \"@yume-chan/adb-scrcpy\";\r\nimport { VERSION } from \"@yume-chan/fetch-scrcpy-server\";\r\nimport {\r\n    Float32PcmPlayer,\r\n    Float32PlanerPcmPlayer,\r\n    Int16PcmPlayer,\r\n    PcmPlayer,\r\n} from \"@yume-chan/pcm-player\";\r\nimport {\r\n    AndroidScreenPowerMode,\r\n    CodecOptions,\r\n    DEFAULT_SERVER_PATH,\r\n    ScrcpyAudioCodec,\r\n    ScrcpyDeviceMessageType,\r\n    ScrcpyHoverHelper,\r\n    ScrcpyInstanceId,\r\n    ScrcpyLogLevel,\r\n    ScrcpyMediaStreamPacket,\r\n    ScrcpyOptionsLatest,\r\n    ScrcpyVideoCodecId,\r\n    clamp,\r\n    h264ParseConfiguration,\r\n    h265ParseConfiguration,\r\n} from \"@yume-chan/scrcpy\";\r\nimport { ScrcpyVideoDecoder } from \"@yume-chan/scrcpy-decoder-tinyh264\";\r\nimport {\r\n    Consumable,\r\n    DistributionStream,\r\n    InspectStream,\r\n    ReadableStream,\r\n    WritableStream,\r\n} from \"@yume-chan/stream-extra\";\r\nimport { action, autorun, makeAutoObservable, runInAction } from \"mobx\";\r\nimport { GLOBAL_STATE } from \"../../state\";\r\nimport { ProgressStream } from \"../../utils\";\r\nimport { AacDecodeStream, OpusDecodeStream } from \"./audio-decode-stream\";\r\nimport { fetchServer } from \"./fetch-server\";\r\nimport {\r\n    AoaKeyboardInjector,\r\n    KeyboardInjector,\r\n    ScrcpyKeyboardInjector,\r\n} from \"./input\";\r\nimport { MatroskaMuxingRecorder, RECORD_STATE } from \"./recorder\";\r\nimport { SCRCPY_SETTINGS_FILENAME, SETTING_STATE } from \"./settings\";\r\n\r\nconst NOOP = () => {\r\n    // no-op\r\n};\r\n\r\nexport class ScrcpyPageState {\r\n    running = false;\r\n\r\n    fullScreenContainer: HTMLDivElement | null = null;\r\n    rendererContainer: HTMLDivElement | null = null;\r\n\r\n    isFullScreen = false;\r\n\r\n    logVisible = false;\r\n    log: string[] = [];\r\n    demoModeVisible = false;\r\n    navigationBarVisible = true;\r\n\r\n    width = 0;\r\n    height = 0;\r\n    rotation = 0;\r\n\r\n    get rotatedWidth() {\r\n        return STATE.rotation & 1 ? STATE.height : STATE.width;\r\n    }\r\n    get rotatedHeight() {\r\n        return STATE.rotation & 1 ? STATE.width : STATE.height;\r\n    }\r\n\r\n    client: AdbScrcpyClient | undefined = undefined;\r\n    hoverHelper: ScrcpyHoverHelper | undefined = undefined;\r\n    keyboard: KeyboardInjector | undefined = undefined;\r\n    audioPlayer: PcmPlayer<unknown> | undefined = undefined;\r\n\r\n    async pushServer() {\r\n        const serverBuffer = await fetchServer();\r\n        await AdbScrcpyClient.pushServer(\r\n            GLOBAL_STATE.adb!,\r\n            new ReadableStream<Consumable<Uint8Array>>({\r\n                start(controller) {\r\n                    controller.enqueue(new Consumable(serverBuffer));\r\n                    controller.close();\r\n                },\r\n            })\r\n        );\r\n    }\r\n\r\n    decoder: ScrcpyVideoDecoder | undefined = undefined;\r\n    fpsCounterIntervalId: any = undefined;\r\n    fps = \"0\";\r\n\r\n    connecting = false;\r\n    serverTotalSize = 0;\r\n    serverDownloadedSize = 0;\r\n    debouncedServerDownloadedSize = 0;\r\n    serverDownloadSpeed = 0;\r\n    serverUploadedSize = 0;\r\n    debouncedServerUploadedSize = 0;\r\n    serverUploadSpeed = 0;\r\n\r\n    constructor() {\r\n        makeAutoObservable(this, {\r\n            start: false,\r\n            stop: action.bound,\r\n            dispose: action.bound,\r\n            setFullScreenContainer: action.bound,\r\n            setRendererContainer: action.bound,\r\n            clientPositionToDevicePosition: false,\r\n        });\r\n\r\n        autorun(() => {\r\n            if (!GLOBAL_STATE.adb) {\r\n                this.dispose();\r\n            }\r\n        });\r\n\r\n        if (typeof document === \"object\") {\r\n            document.addEventListener(\"fullscreenchange\", () => {\r\n                if (!document.fullscreenElement) {\r\n                    runInAction(() => {\r\n                        this.isFullScreen = false;\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        autorun(() => {\r\n            if (this.rendererContainer && this.decoder) {\r\n                while (this.rendererContainer.firstChild) {\r\n                    this.rendererContainer.firstChild.remove();\r\n                }\r\n                this.rendererContainer.appendChild(this.decoder.renderer);\r\n            }\r\n        });\r\n    }\r\n\r\n    start = async () => {\r\n        if (!GLOBAL_STATE.adb) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            if (!SETTING_STATE.clientSettings.decoder) {\r\n                throw new Error(\"No available decoder\");\r\n            }\r\n\r\n            runInAction(() => {\r\n                this.serverTotalSize = 0;\r\n                this.serverDownloadedSize = 0;\r\n                this.debouncedServerDownloadedSize = 0;\r\n                this.serverUploadedSize = 0;\r\n                this.debouncedServerUploadedSize = 0;\r\n                this.connecting = true;\r\n            });\r\n\r\n            let intervalId = setInterval(\r\n                action(() => {\r\n                    this.serverDownloadSpeed =\r\n                        this.serverDownloadedSize -\r\n                        this.debouncedServerDownloadedSize;\r\n                    this.debouncedServerDownloadedSize =\r\n                        this.serverDownloadedSize;\r\n                }),\r\n                1000\r\n            );\r\n\r\n            let serverBuffer: Uint8Array;\r\n            try {\r\n                serverBuffer = await fetchServer(\r\n                    action(([downloaded, total]) => {\r\n                        this.serverDownloadedSize = downloaded;\r\n                        this.serverTotalSize = total;\r\n                    })\r\n                );\r\n                runInAction(() => {\r\n                    this.serverDownloadSpeed =\r\n                        this.serverDownloadedSize -\r\n                        this.debouncedServerDownloadedSize;\r\n                    this.debouncedServerDownloadedSize =\r\n                        this.serverDownloadedSize;\r\n                });\r\n            } finally {\r\n                clearInterval(intervalId);\r\n            }\r\n\r\n            intervalId = setInterval(\r\n                action(() => {\r\n                    this.serverUploadSpeed =\r\n                        this.serverUploadedSize -\r\n                        this.debouncedServerUploadedSize;\r\n                    this.debouncedServerUploadedSize = this.serverUploadedSize;\r\n                }),\r\n                1000\r\n            );\r\n\r\n            try {\r\n                await AdbScrcpyClient.pushServer(\r\n                    GLOBAL_STATE.adb!,\r\n                    new ReadableStream<Consumable<Uint8Array>>({\r\n                        start(controller) {\r\n                            controller.enqueue(new Consumable(serverBuffer));\r\n                            controller.close();\r\n                        },\r\n                    })\r\n                        // In fact `pushServer` will pipe the stream through a DistributionStream,\r\n                        // but without this pipeThrough, the progress will not be updated.\r\n                        .pipeThrough(\r\n                            new DistributionStream(ADB_SYNC_MAX_PACKET_SIZE)\r\n                        )\r\n                        .pipeThrough(\r\n                            new ProgressStream(\r\n                                action((progress) => {\r\n                                    this.serverUploadedSize = progress;\r\n                                })\r\n                            )\r\n                        )\r\n                );\r\n\r\n                runInAction(() => {\r\n                    this.serverUploadSpeed =\r\n                        this.serverUploadedSize -\r\n                        this.debouncedServerUploadedSize;\r\n                    this.debouncedServerUploadedSize = this.serverUploadedSize;\r\n                });\r\n            } finally {\r\n                clearInterval(intervalId);\r\n            }\r\n\r\n            const decoderDefinition =\r\n                SETTING_STATE.decoders.find(\r\n                    (x) => x.key === SETTING_STATE.clientSettings.decoder\r\n                ) ?? SETTING_STATE.decoders[0];\r\n\r\n            const videoCodecOptions = new CodecOptions();\r\n            if (!SETTING_STATE.clientSettings.ignoreDecoderCodecArgs) {\r\n                const capability =\r\n                    decoderDefinition.Constructor.capabilities[\r\n                        SETTING_STATE.settings.videoCodec!\r\n                    ];\r\n                if (capability) {\r\n                    videoCodecOptions.value.profile = capability.maxProfile;\r\n                    videoCodecOptions.value.level = capability.maxLevel;\r\n                }\r\n            }\r\n\r\n            // Disabled due to https://github.com/Genymobile/scrcpy/issues/2841\r\n            // Less recording delay\r\n            // codecOptions.value.iFrameInterval = 1;\r\n            // Less latency\r\n            // codecOptions.value.intraRefreshPeriod = 10000;\r\n\r\n            const options = new AdbScrcpyOptionsLatest(\r\n                new ScrcpyOptionsLatest({\r\n                    ...SETTING_STATE.settings,\r\n                    logLevel: ScrcpyLogLevel.Debug,\r\n                    scid: ScrcpyInstanceId.random(),\r\n                    sendDeviceMeta: false,\r\n                    sendDummyByte: false,\r\n                    videoCodecOptions,\r\n                })\r\n            );\r\n\r\n            runInAction(() => {\r\n                this.log = [];\r\n                this.log.push(`[client] Server version: ${VERSION}`);\r\n                this.log.push(\r\n                    `[client] Server arguments: ${options\r\n                        .serialize()\r\n                        .join(\" \")}`\r\n                );\r\n            });\r\n\r\n            const client = await AdbScrcpyClient.start(\r\n                GLOBAL_STATE.adb!,\r\n                DEFAULT_SERVER_PATH,\r\n                VERSION,\r\n                options\r\n            );\r\n\r\n            client.stdout.pipeTo(\r\n                new WritableStream<string>({\r\n                    write: action((line) => {\r\n                        this.log.push(line);\r\n                    }),\r\n                })\r\n            );\r\n\r\n            const sync = await GLOBAL_STATE.adb!.sync();\r\n            try {\r\n                await sync.write({\r\n                    filename: SCRCPY_SETTINGS_FILENAME,\r\n                    file: new ReadableStream<Consumable<Uint8Array>>({\r\n                        start(controller) {\r\n                            controller.enqueue(\r\n                                new Consumable(\r\n                                    encodeUtf8(\r\n                                        JSON.stringify({\r\n                                            settings: SETTING_STATE.settings,\r\n                                            clientSettings:\r\n                                                SETTING_STATE.clientSettings,\r\n                                        })\r\n                                    )\r\n                                )\r\n                            );\r\n                            controller.close();\r\n                        },\r\n                    }),\r\n                });\r\n            } finally {\r\n                sync.dispose();\r\n            }\r\n\r\n            RECORD_STATE.recorder = new MatroskaMuxingRecorder();\r\n\r\n            client.videoStream!.then(({ stream, metadata }) => {\r\n                runInAction(() => {\r\n                    RECORD_STATE.recorder.videoMetadata = metadata;\r\n                });\r\n\r\n                const decoder = new decoderDefinition.Constructor(\r\n                    metadata.codec\r\n                );\r\n\r\n                runInAction(() => {\r\n                    this.decoder = decoder;\r\n\r\n                    let lastFrameRendered = 0;\r\n                    let lastFrameSkipped = 0;\r\n                    this.fpsCounterIntervalId = setInterval(\r\n                        action(() => {\r\n                            const deltaRendered =\r\n                                decoder.frameRendered - lastFrameRendered;\r\n                            const deltaSkipped =\r\n                                decoder.frameSkipped - lastFrameSkipped;\r\n                            // prettier-ignore\r\n                            this.fps = `${\r\n                            deltaRendered\r\n                        }${\r\n                            deltaSkipped ? `+${deltaSkipped} skipped` : \"\"\r\n                        }`;\r\n                            lastFrameRendered = decoder.frameRendered;\r\n                            lastFrameSkipped = decoder.frameSkipped;\r\n                        }),\r\n                        1000\r\n                    );\r\n                });\r\n\r\n                let lastKeyframe = 0n;\r\n                const handler = new InspectStream<ScrcpyMediaStreamPacket>(\r\n                    (packet) => {\r\n                        RECORD_STATE.recorder.addVideoPacket(packet);\r\n\r\n                        if (packet.type === \"configuration\") {\r\n                            let croppedWidth: number;\r\n                            let croppedHeight: number;\r\n                            switch (metadata.codec) {\r\n                                case ScrcpyVideoCodecId.H264:\r\n                                    ({ croppedWidth, croppedHeight } =\r\n                                        h264ParseConfiguration(packet.data));\r\n                                    break;\r\n                                case ScrcpyVideoCodecId.H265:\r\n                                    ({ croppedWidth, croppedHeight } =\r\n                                        h265ParseConfiguration(packet.data));\r\n                                    break;\r\n                                default:\r\n                                    throw new Error(\"Codec not supported\");\r\n                            }\r\n\r\n                            runInAction(() => {\r\n                                this.log.push(\r\n                                    `[client] Video size changed: ${croppedWidth}x${croppedHeight}`\r\n                                );\r\n                                this.width = croppedWidth;\r\n                                this.height = croppedHeight;\r\n                            });\r\n                        } else if (\r\n                            packet.keyframe &&\r\n                            packet.pts !== undefined\r\n                        ) {\r\n                            if (lastKeyframe) {\r\n                                const interval =\r\n                                    (Number(packet.pts - lastKeyframe) / 1000) |\r\n                                    0;\r\n                                runInAction(() => {\r\n                                    this.log.push(\r\n                                        `[client] Keyframe interval: ${interval}ms`\r\n                                    );\r\n                                });\r\n                            }\r\n                            lastKeyframe = packet.pts!;\r\n                        }\r\n                    }\r\n                );\r\n\r\n                stream.pipeThrough(handler).pipeTo(decoder.writable);\r\n            });\r\n\r\n            client.audioStream?.then(async (metadata) => {\r\n                switch (metadata.type) {\r\n                    case \"disabled\":\r\n                        runInAction(() =>\r\n                            this.log.push(\r\n                                `[client] Demuxer audio: stream explicitly disabled by the device`\r\n                            )\r\n                        );\r\n                        return;\r\n                    case \"errored\":\r\n                        runInAction(() =>\r\n                            this.log.push(\r\n                                `[client] Demuxer audio: stream configuration error on the device`\r\n                            )\r\n                        );\r\n                        return;\r\n                    case \"success\":\r\n                        // Code is after this `switch`\r\n                        break;\r\n                    default:\r\n                        throw new Error(\r\n                            `Unexpected audio metadata type ${\r\n                                metadata[\"type\"] as unknown as string\r\n                            }`\r\n                        );\r\n                }\r\n\r\n                const [recordStream, playbackStream] = metadata.stream.tee();\r\n                switch (metadata.codec) {\r\n                    case ScrcpyAudioCodec.RAW: {\r\n                        const audioPlayer = new Int16PcmPlayer(48000);\r\n                        this.audioPlayer = audioPlayer;\r\n\r\n                        playbackStream.pipeTo(\r\n                            new WritableStream({\r\n                                write: (chunk) => {\r\n                                    audioPlayer.feed(\r\n                                        new Int16Array(\r\n                                            chunk.data.buffer,\r\n                                            chunk.data.byteOffset,\r\n                                            chunk.data.byteLength /\r\n                                                Int16Array.BYTES_PER_ELEMENT\r\n                                        )\r\n                                    );\r\n                                },\r\n                            })\r\n                        );\r\n\r\n                        await this.audioPlayer.start();\r\n                        break;\r\n                    }\r\n                    case ScrcpyAudioCodec.OPUS: {\r\n                        const audioPlayer = new Float32PcmPlayer(48000);\r\n                        this.audioPlayer = audioPlayer;\r\n\r\n                        playbackStream\r\n                            .pipeThrough(\r\n                                new OpusDecodeStream({\r\n                                    codec: metadata.codec.webCodecId,\r\n                                    numberOfChannels: 2,\r\n                                    sampleRate: 48000,\r\n                                })\r\n                            )\r\n                            .pipeTo(\r\n                                new WritableStream({\r\n                                    write: (chunk) => {\r\n                                        audioPlayer.feed(chunk);\r\n                                    },\r\n                                })\r\n                            );\r\n                        await audioPlayer.start();\r\n                        break;\r\n                    }\r\n                    case ScrcpyAudioCodec.AAC: {\r\n                        const audioPlayer = new Float32PlanerPcmPlayer(48000);\r\n                        this.audioPlayer = audioPlayer;\r\n\r\n                        playbackStream\r\n                            .pipeThrough(\r\n                                new AacDecodeStream({\r\n                                    codec: metadata.codec.webCodecId,\r\n                                    numberOfChannels: 2,\r\n                                    sampleRate: 48000,\r\n                                })\r\n                            )\r\n                            .pipeTo(\r\n                                new WritableStream({\r\n                                    write: (chunk) => {\r\n                                        audioPlayer.feed(chunk);\r\n                                    },\r\n                                })\r\n                            );\r\n                        await audioPlayer.start();\r\n                        break;\r\n                    }\r\n                    default:\r\n                        throw new Error(\r\n                            `Unsupported audio codec ${metadata.codec.optionValue}`\r\n                        );\r\n                }\r\n\r\n                runInAction(() => {\r\n                    RECORD_STATE.recorder.audioCodec = metadata.codec;\r\n                });\r\n\r\n                recordStream.pipeTo(\r\n                    new WritableStream({\r\n                        write: (packet) => {\r\n                            if (packet.type === \"data\") {\r\n                                RECORD_STATE.recorder.addAudioPacket(packet);\r\n                            }\r\n                        },\r\n                    })\r\n                );\r\n            });\r\n\r\n            client.exit.then(this.dispose);\r\n\r\n            client.deviceMessageStream!.pipeTo(\r\n                new WritableStream({\r\n                    write(message) {\r\n                        switch (message.type) {\r\n                            case ScrcpyDeviceMessageType.Clipboard:\r\n                                globalThis.navigator.clipboard.writeText(\r\n                                    message.content\r\n                                );\r\n                                break;\r\n                        }\r\n                    },\r\n                })\r\n            );\r\n\r\n            if (SETTING_STATE.clientSettings.turnScreenOff) {\r\n                await client.controlMessageWriter!.setScreenPowerMode(\r\n                    AndroidScreenPowerMode.Off\r\n                );\r\n            }\r\n\r\n            runInAction(() => {\r\n                this.client = client;\r\n                this.hoverHelper = new ScrcpyHoverHelper();\r\n                this.running = true;\r\n            });\r\n\r\n            const device = GLOBAL_STATE.device!;\r\n            if (device instanceof AdbDaemonWebUsbDevice) {\r\n                this.keyboard = await AoaKeyboardInjector.register(device.raw);\r\n            } else {\r\n                this.keyboard = new ScrcpyKeyboardInjector(client);\r\n            }\r\n        } catch (e: any) {\r\n            GLOBAL_STATE.showErrorDialog(e);\r\n        } finally {\r\n            runInAction(() => {\r\n                this.connecting = false;\r\n            });\r\n        }\r\n    };\r\n\r\n    async stop() {\r\n        // Request to close client first\r\n        await this.client?.close();\r\n        this.dispose();\r\n    }\r\n\r\n    dispose() {\r\n        // Otherwise some packets may still arrive at decoder\r\n        this.decoder?.dispose();\r\n        this.decoder = undefined;\r\n\r\n        if (RECORD_STATE.recording) {\r\n            RECORD_STATE.recorder.stop();\r\n            RECORD_STATE.recording = false;\r\n        }\r\n\r\n        this.keyboard?.dispose();\r\n        this.keyboard = undefined;\r\n\r\n        this.audioPlayer?.stop();\r\n        this.audioPlayer = undefined;\r\n\r\n        this.fps = \"0\";\r\n        clearTimeout(this.fpsCounterIntervalId);\r\n\r\n        if (this.isFullScreen) {\r\n            document.exitFullscreen();\r\n            this.isFullScreen = false;\r\n        }\r\n\r\n        this.client = undefined;\r\n        this.running = false;\r\n    }\r\n\r\n    setFullScreenContainer(element: HTMLDivElement | null) {\r\n        this.fullScreenContainer = element;\r\n    }\r\n\r\n    setRendererContainer(element: HTMLDivElement | null) {\r\n        this.rendererContainer = element;\r\n    }\r\n\r\n    clientPositionToDevicePosition(clientX: number, clientY: number) {\r\n        const viewRect = this.rendererContainer!.getBoundingClientRect();\r\n        let pointerViewX = clamp((clientX - viewRect.x) / viewRect.width, 0, 1);\r\n        let pointerViewY = clamp(\r\n            (clientY - viewRect.y) / viewRect.height,\r\n            0,\r\n            1\r\n        );\r\n\r\n        if (this.rotation & 1) {\r\n            [pointerViewX, pointerViewY] = [pointerViewY, pointerViewX];\r\n        }\r\n        switch (this.rotation) {\r\n            case 1:\r\n                pointerViewY = 1 - pointerViewY;\r\n                break;\r\n            case 2:\r\n                pointerViewX = 1 - pointerViewX;\r\n                pointerViewY = 1 - pointerViewY;\r\n                break;\r\n            case 3:\r\n                pointerViewX = 1 - pointerViewX;\r\n                break;\r\n        }\r\n\r\n        return {\r\n            x: pointerViewX * this.width,\r\n            y: pointerViewY * this.height,\r\n        };\r\n    }\r\n}\r\n\r\nexport const STATE = new ScrcpyPageState();\r\n","import {\r\n    CommandBar,\r\n    ContextualMenuItemType,\r\n    ICommandBarItemProps,\r\n} from \"@fluentui/react\";\r\nimport {\r\n    AndroidKeyCode,\r\n    AndroidKeyEventAction,\r\n    AndroidScreenPowerMode,\r\n} from \"@yume-chan/scrcpy\";\r\nimport { action, computed } from \"mobx\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { Icons } from \"../../utils\";\r\nimport { CommandBarSpacerItem } from \"../command-bar-spacer-item\";\r\nimport { RECORD_STATE } from \"./recorder\";\r\nimport { STATE } from \"./state\";\r\n\r\nconst ITEMS = computed(() => {\r\n    const result: ICommandBarItemProps[] = [];\r\n\r\n    result.push({\r\n        key: \"stop\",\r\n        iconProps: { iconName: Icons.Stop },\r\n        text: \"Stop\",\r\n        onClick: STATE.stop as VoidFunction,\r\n    });\r\n\r\n    result.push(\r\n        RECORD_STATE.recording\r\n            ? {\r\n                  key: \"Record\",\r\n                  iconProps: {\r\n                      iconName: Icons.Record,\r\n                      style: { color: \"red\" },\r\n                  },\r\n                  // prettier-ignore\r\n                  text: `${\r\n                      RECORD_STATE.hours ? `${RECORD_STATE.hours}:` : \"\"\r\n                  }${\r\n                      RECORD_STATE.minutes.toString().padStart(2, \"0\")\r\n                  }:${\r\n                      RECORD_STATE.seconds.toString().padStart(2, \"0\")\r\n                  }`,\r\n                  onClick: action(() => {\r\n                      STATE.fullScreenContainer!.focus();\r\n\r\n                      RECORD_STATE.recorder.stop();\r\n                      RECORD_STATE.recording = false;\r\n                  }),\r\n              }\r\n            : {\r\n                  key: \"Record\",\r\n                  disabled: !STATE.running,\r\n                  iconProps: { iconName: Icons.Record },\r\n                  text: \"Record\",\r\n                  onClick: action(() => {\r\n                      STATE.fullScreenContainer!.focus();\r\n\r\n                      RECORD_STATE.recorder.start();\r\n                      RECORD_STATE.recording = true;\r\n                  }),\r\n              }\r\n    );\r\n\r\n    result.push({\r\n        key: \"fullscreen\",\r\n        disabled: !STATE.running,\r\n        iconProps: { iconName: Icons.FullScreenMaximize },\r\n        iconOnly: true,\r\n        text: \"Fullscreen\",\r\n        onClick: action(() => {\r\n            STATE.fullScreenContainer!.focus();\r\n\r\n            STATE.fullScreenContainer!.requestFullscreen();\r\n            STATE.isFullScreen = true;\r\n        }),\r\n    });\r\n\r\n    result.push(\r\n        {\r\n            key: \"volumeUp\",\r\n            disabled: !STATE.running,\r\n            iconProps: { iconName: Icons.Speaker2 },\r\n            iconOnly: true,\r\n            text: \"Volume Up\",\r\n            onClick: (async () => {\r\n                STATE.fullScreenContainer!.focus();\r\n\r\n                // TODO: Auto repeat when holding\r\n                await STATE.client?.controlMessageWriter!.injectKeyCode({\r\n                    action: AndroidKeyEventAction.Down,\r\n                    keyCode: AndroidKeyCode.VolumeUp,\r\n                    repeat: 0,\r\n                    metaState: 0,\r\n                });\r\n                await STATE.client?.controlMessageWriter!.injectKeyCode({\r\n                    action: AndroidKeyEventAction.Up,\r\n                    keyCode: AndroidKeyCode.VolumeUp,\r\n                    repeat: 0,\r\n                    metaState: 0,\r\n                });\r\n            }) as () => void,\r\n        },\r\n        {\r\n            key: \"volumeDown\",\r\n            disabled: !STATE.running,\r\n            iconProps: { iconName: Icons.Speaker1 },\r\n            iconOnly: true,\r\n            text: \"Volume Down\",\r\n            onClick: (async () => {\r\n                STATE.fullScreenContainer!.focus();\r\n\r\n                await STATE.client?.controlMessageWriter!.injectKeyCode({\r\n                    action: AndroidKeyEventAction.Down,\r\n                    keyCode: AndroidKeyCode.VolumeDown,\r\n                    repeat: 0,\r\n                    metaState: 0,\r\n                });\r\n                await STATE.client?.controlMessageWriter!.injectKeyCode({\r\n                    action: AndroidKeyEventAction.Up,\r\n                    keyCode: AndroidKeyCode.VolumeDown,\r\n                    repeat: 0,\r\n                    metaState: 0,\r\n                });\r\n            }) as () => void,\r\n        },\r\n        {\r\n            key: \"volumeMute\",\r\n            disabled: !STATE.running,\r\n            iconProps: { iconName: Icons.SpeakerOff },\r\n            iconOnly: true,\r\n            text: \"Toggle Mute\",\r\n            onClick: (async () => {\r\n                STATE.fullScreenContainer!.focus();\r\n\r\n                await STATE.client?.controlMessageWriter!.injectKeyCode({\r\n                    action: AndroidKeyEventAction.Down,\r\n                    keyCode: AndroidKeyCode.VolumeMute,\r\n                    repeat: 0,\r\n                    metaState: 0,\r\n                });\r\n                await STATE.client?.controlMessageWriter!.injectKeyCode({\r\n                    action: AndroidKeyEventAction.Up,\r\n                    keyCode: AndroidKeyCode.VolumeMute,\r\n                    repeat: 0,\r\n                    metaState: 0,\r\n                });\r\n            }) as () => void,\r\n        }\r\n    );\r\n\r\n    result.push(\r\n        {\r\n            key: \"rotateDevice\",\r\n            disabled: !STATE.running,\r\n            iconProps: { iconName: Icons.Orientation },\r\n            iconOnly: true,\r\n            text: \"Rotate Device\",\r\n            onClick: () => {\r\n                STATE.fullScreenContainer!.focus();\r\n\r\n                STATE.client!.controlMessageWriter!.rotateDevice();\r\n            },\r\n        },\r\n        {\r\n            key: \"rotateVideoLeft\",\r\n            disabled: !STATE.running,\r\n            iconProps: { iconName: Icons.RotateLeft },\r\n            iconOnly: true,\r\n            text: \"Rotate Video Left\",\r\n            onClick: action(() => {\r\n                STATE.fullScreenContainer!.focus();\r\n\r\n                STATE.rotation -= 1;\r\n                if (STATE.rotation < 0) {\r\n                    STATE.rotation = 3;\r\n                }\r\n            }),\r\n        },\r\n        {\r\n            key: \"rotateVideoRight\",\r\n            disabled: !STATE.running,\r\n            iconProps: { iconName: Icons.RotateRight },\r\n            iconOnly: true,\r\n            text: \"Rotate Video Right\",\r\n            onClick: action(() => {\r\n                STATE.fullScreenContainer!.focus();\r\n\r\n                STATE.rotation = (STATE.rotation + 1) & 3;\r\n            }),\r\n        }\r\n    );\r\n\r\n    result.push(\r\n        {\r\n            key: \"turnScreenOff\",\r\n            disabled: !STATE.running,\r\n            iconProps: { iconName: Icons.Lightbulb },\r\n            iconOnly: true,\r\n            text: \"Turn Screen Off\",\r\n            onClick: () => {\r\n                STATE.fullScreenContainer!.focus();\r\n\r\n                STATE.client!.controlMessageWriter!.setScreenPowerMode(\r\n                    AndroidScreenPowerMode.Off\r\n                );\r\n            },\r\n        },\r\n        {\r\n            key: \"turnScreenOn\",\r\n            disabled: !STATE.running,\r\n            iconProps: { iconName: Icons.LightbulbFilament },\r\n            iconOnly: true,\r\n            text: \"Turn Screen On\",\r\n            onClick: () => {\r\n                STATE.fullScreenContainer!.focus();\r\n\r\n                STATE.client!.controlMessageWriter!.setScreenPowerMode(\r\n                    AndroidScreenPowerMode.Normal\r\n                );\r\n            },\r\n        }\r\n    );\r\n\r\n    if (STATE.running) {\r\n        result.push({\r\n            key: \"fps\",\r\n            text: `FPS: ${STATE.fps}`,\r\n            disabled: true,\r\n        });\r\n    }\r\n\r\n    result.push(\r\n        {\r\n            // HACK: make CommandBar overflow on far items\r\n            // https://github.com/microsoft/fluentui/issues/11842\r\n            key: \"spacer\",\r\n            onRender: () => <CommandBarSpacerItem />,\r\n        },\r\n        {\r\n            // HACK: add a separator in CommandBar overflow menu\r\n            // https://github.com/microsoft/fluentui/issues/10035\r\n            key: \"separator\",\r\n            disabled: true,\r\n            itemType: ContextualMenuItemType.Divider,\r\n        }\r\n    );\r\n\r\n    result.push(\r\n        {\r\n            key: \"NavigationBar\",\r\n            iconProps: { iconName: Icons.PanelBottom },\r\n            canCheck: true,\r\n            checked: STATE.navigationBarVisible,\r\n            text: \"Navigation Bar\",\r\n            iconOnly: true,\r\n            onClick: action(() => {\r\n                STATE.navigationBarVisible = !STATE.navigationBarVisible;\r\n            }),\r\n        },\r\n        {\r\n            key: \"Log\",\r\n            iconProps: { iconName: Icons.TextGrammarError },\r\n            canCheck: true,\r\n            checked: STATE.logVisible,\r\n            text: \"Log\",\r\n            iconOnly: true,\r\n            onClick: action(() => {\r\n                STATE.logVisible = !STATE.logVisible;\r\n            }),\r\n        },\r\n        {\r\n            key: \"DemoMode\",\r\n            iconProps: { iconName: Icons.Wand },\r\n            canCheck: true,\r\n            checked: STATE.demoModeVisible,\r\n            text: \"Demo Mode\",\r\n            iconOnly: true,\r\n            onClick: action(() => {\r\n                STATE.demoModeVisible = !STATE.demoModeVisible;\r\n            }),\r\n        }\r\n    );\r\n\r\n    return result;\r\n});\r\n\r\nexport const ScrcpyCommandBar = observer(function ScrcpyCommandBar() {\r\n    return <CommandBar items={ITEMS.get()} />;\r\n});\r\n","import { IconButton, Stack } from \"@fluentui/react\";\r\nimport { makeStyles, mergeClasses } from \"@griffel/react\";\r\nimport { AndroidKeyCode, AndroidKeyEventAction } from \"@yume-chan/scrcpy\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { CSSProperties, PointerEvent, ReactNode } from \"react\";\r\nimport { Icons } from \"../../utils\";\r\nimport { STATE } from \"./state\";\r\n\r\nconst useClasses = makeStyles({\r\n    container: {\r\n        height: \"40px\",\r\n        backgroundColor: \"#999\",\r\n    },\r\n    bar: {\r\n        width: \"100%\",\r\n        maxWidth: \"300px\",\r\n    },\r\n    icon: {\r\n        color: \"white\",\r\n    },\r\n    back: {\r\n        transform: \"rotate(180deg)\",\r\n    },\r\n});\r\n\r\nfunction handlePointerDown(e: PointerEvent<HTMLDivElement>) {\r\n    if (!STATE.client) {\r\n        return false;\r\n    }\r\n\r\n    if (e.button !== 0) {\r\n        return false;\r\n    }\r\n\r\n    STATE.fullScreenContainer!.focus();\r\n    e.currentTarget.setPointerCapture(e.pointerId);\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    return true;\r\n}\r\n\r\nfunction handlePointerUp(e: PointerEvent<HTMLDivElement>) {\r\n    if (!STATE.client) {\r\n        return false;\r\n    }\r\n\r\n    if (e.button !== 0) {\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction handleBackPointerDown(e: PointerEvent<HTMLDivElement>) {\r\n    if (!handlePointerDown(e)) {\r\n        return;\r\n    }\r\n\r\n    STATE.client!.controlMessageWriter!.backOrScreenOn(\r\n        AndroidKeyEventAction.Down\r\n    );\r\n}\r\n\r\nfunction handleBackPointerUp(e: PointerEvent<HTMLDivElement>) {\r\n    if (!handlePointerUp(e)) {\r\n        return;\r\n    }\r\n\r\n    STATE.client!.controlMessageWriter!.backOrScreenOn(\r\n        AndroidKeyEventAction.Up\r\n    );\r\n}\r\n\r\nfunction handleHomePointerDown(e: PointerEvent<HTMLDivElement>) {\r\n    if (!handlePointerDown(e)) {\r\n        return;\r\n    }\r\n\r\n    STATE.client!.controlMessageWriter!.injectKeyCode({\r\n        action: AndroidKeyEventAction.Down,\r\n        keyCode: AndroidKeyCode.AndroidHome,\r\n        repeat: 0,\r\n        metaState: 0,\r\n    });\r\n}\r\n\r\nfunction handleHomePointerUp(e: PointerEvent<HTMLDivElement>) {\r\n    if (!handlePointerUp(e)) {\r\n        return;\r\n    }\r\n\r\n    STATE.client!.controlMessageWriter!.injectKeyCode({\r\n        action: AndroidKeyEventAction.Up,\r\n        keyCode: AndroidKeyCode.AndroidHome,\r\n        repeat: 0,\r\n        metaState: 0,\r\n    });\r\n}\r\n\r\nfunction handleAppSwitchPointerDown(e: PointerEvent<HTMLDivElement>) {\r\n    if (!handlePointerDown(e)) {\r\n        return;\r\n    }\r\n\r\n    STATE.client!.controlMessageWriter!.injectKeyCode({\r\n        action: AndroidKeyEventAction.Down,\r\n        keyCode: AndroidKeyCode.AndroidAppSwitch,\r\n        repeat: 0,\r\n        metaState: 0,\r\n    });\r\n}\r\n\r\nfunction handleAppSwitchPointerUp(e: PointerEvent<HTMLDivElement>) {\r\n    if (!handlePointerUp(e)) {\r\n        return;\r\n    }\r\n\r\n    STATE.client!.controlMessageWriter!.injectKeyCode({\r\n        action: AndroidKeyEventAction.Up,\r\n        keyCode: AndroidKeyCode.AndroidAppSwitch,\r\n        repeat: 0,\r\n        metaState: 0,\r\n    });\r\n}\r\n\r\nexport const NavigationBar = observer(function NavigationBar({\r\n    className,\r\n    style,\r\n    children,\r\n}: {\r\n    className: string;\r\n    style: CSSProperties;\r\n    children: ReactNode;\r\n}) {\r\n    const classes = useClasses();\r\n\r\n    if (!STATE.navigationBarVisible) {\r\n        return (\r\n            <div className={className} style={style}>\r\n                {children}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Stack\r\n            className={mergeClasses(classes.container, className)}\r\n            verticalFill\r\n            horizontalAlign=\"center\"\r\n            style={style}\r\n        >\r\n            {children}\r\n\r\n            <Stack\r\n                className={classes.bar}\r\n                verticalFill\r\n                horizontal\r\n                horizontalAlign=\"space-evenly\"\r\n                verticalAlign=\"center\"\r\n            >\r\n                <IconButton\r\n                    className={mergeClasses(classes.back, classes.icon)}\r\n                    iconProps={{ iconName: Icons.Play }}\r\n                    onPointerDown={handleBackPointerDown}\r\n                    onPointerUp={handleBackPointerUp}\r\n                />\r\n                <IconButton\r\n                    className={classes.icon}\r\n                    iconProps={{ iconName: Icons.Circle }}\r\n                    onPointerDown={handleHomePointerDown}\r\n                    onPointerUp={handleHomePointerUp}\r\n                />\r\n                <IconButton\r\n                    className={classes.icon}\r\n                    iconProps={{ iconName: Icons.Stop }}\r\n                    onPointerDown={handleAppSwitchPointerDown}\r\n                    onPointerUp={handleAppSwitchPointerUp}\r\n                />\r\n            </Stack>\r\n        </Stack>\r\n    );\r\n});\r\n","import { makeStyles } from \"@griffel/react\";\r\nimport {\r\n    AndroidMotionEventAction,\r\n    AndroidMotionEventButton,\r\n    ScrcpyPointerId,\r\n} from \"@yume-chan/scrcpy\";\r\nimport { MouseEvent, PointerEvent, useEffect, useState } from \"react\";\r\nimport { STATE } from \"./state\";\r\n\r\nconst useClasses = makeStyles({\r\n    video: {\r\n        transformOrigin: \"center center\",\r\n        touchAction: \"none\",\r\n    },\r\n});\r\n\r\nfunction handleWheel(e: WheelEvent) {\r\n    if (!STATE.client) {\r\n        return;\r\n    }\r\n\r\n    STATE.fullScreenContainer!.focus();\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    const { x, y } = STATE.clientPositionToDevicePosition(e.clientX, e.clientY);\r\n    STATE.client!.controlMessageWriter!.injectScroll({\r\n        screenWidth: STATE.client!.screenWidth!,\r\n        screenHeight: STATE.client!.screenHeight!,\r\n        pointerX: x,\r\n        pointerY: y,\r\n        scrollX: -e.deltaX / 100,\r\n        scrollY: -e.deltaY / 100,\r\n        buttons: 0,\r\n    });\r\n}\r\n\r\nconst MOUSE_EVENT_BUTTON_TO_ANDROID_BUTTON = [\r\n    AndroidMotionEventButton.Primary,\r\n    AndroidMotionEventButton.Tertiary,\r\n    AndroidMotionEventButton.Secondary,\r\n    AndroidMotionEventButton.Back,\r\n    AndroidMotionEventButton.Forward,\r\n];\r\n\r\nfunction injectTouch(\r\n    action: AndroidMotionEventAction,\r\n    e: PointerEvent<HTMLDivElement>\r\n) {\r\n    if (!STATE.client) {\r\n        return;\r\n    }\r\n\r\n    const { pointerType } = e;\r\n    let pointerId: bigint;\r\n    if (pointerType === \"mouse\") {\r\n        // Android 13 has bug with mouse injection\r\n        // https://github.com/Genymobile/scrcpy/issues/3708\r\n        pointerId = ScrcpyPointerId.Finger;\r\n    } else {\r\n        pointerId = BigInt(e.pointerId);\r\n    }\r\n\r\n    const { x, y } = STATE.clientPositionToDevicePosition(e.clientX, e.clientY);\r\n\r\n    const messages = STATE.hoverHelper!.process({\r\n        action,\r\n        pointerId,\r\n        screenWidth: STATE.client.screenWidth!,\r\n        screenHeight: STATE.client.screenHeight!,\r\n        pointerX: x,\r\n        pointerY: y,\r\n        pressure: e.pressure,\r\n        actionButton: MOUSE_EVENT_BUTTON_TO_ANDROID_BUTTON[e.button],\r\n        // `MouseEvent.buttons` has the same order as Android `MotionEvent`\r\n        buttons: e.buttons,\r\n    });\r\n    for (const message of messages) {\r\n        STATE.client.controlMessageWriter!.injectTouch(message);\r\n    }\r\n}\r\n\r\nfunction handlePointerDown(e: PointerEvent<HTMLDivElement>) {\r\n    if (!STATE.client) {\r\n        return;\r\n    }\r\n\r\n    STATE.fullScreenContainer!.focus();\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    e.currentTarget.setPointerCapture(e.pointerId);\r\n    injectTouch(AndroidMotionEventAction.Down, e);\r\n}\r\n\r\nfunction handlePointerMove(e: PointerEvent<HTMLDivElement>) {\r\n    if (!STATE.client) {\r\n        return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    injectTouch(\r\n        e.buttons === 0\r\n            ? AndroidMotionEventAction.HoverMove\r\n            : AndroidMotionEventAction.Move,\r\n        e\r\n    );\r\n}\r\n\r\nfunction handlePointerUp(e: PointerEvent<HTMLDivElement>) {\r\n    if (!STATE.client) {\r\n        return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    injectTouch(AndroidMotionEventAction.Up, e);\r\n}\r\n\r\nfunction handlePointerLeave(e: PointerEvent<HTMLDivElement>) {\r\n    if (!STATE.client) {\r\n        return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    // Because pointer capture on pointer down, this event only happens for hovering mouse and pen.\r\n    // Release the injected pointer, otherwise it will stuck at the last position.\r\n    injectTouch(AndroidMotionEventAction.HoverExit, e);\r\n    injectTouch(AndroidMotionEventAction.Up, e);\r\n}\r\n\r\nfunction handleContextMenu(e: MouseEvent<HTMLDivElement>) {\r\n    e.preventDefault();\r\n}\r\n\r\nexport function VideoContainer() {\r\n    const classes = useClasses();\r\n\r\n    const [container, setContainer] = useState<HTMLDivElement | null>(null);\r\n\r\n    useEffect(() => {\r\n        STATE.setRendererContainer(container);\r\n\r\n        if (!container) {\r\n            return;\r\n        }\r\n\r\n        container.addEventListener(\"wheel\", handleWheel, {\r\n            passive: false,\r\n        });\r\n\r\n        return () => {\r\n            container.removeEventListener(\"wheel\", handleWheel);\r\n        };\r\n    }, [container]);\r\n\r\n    return (\r\n        <div\r\n            ref={setContainer}\r\n            className={classes.video}\r\n            style={{\r\n                width: STATE.width,\r\n                height: STATE.height,\r\n                transform: `translate(${\r\n                    (STATE.rotatedWidth - STATE.width) / 2\r\n                }px, ${(STATE.rotatedHeight - STATE.height) / 2}px) rotate(${\r\n                    STATE.rotation * 90\r\n                }deg)`,\r\n            }}\r\n            onPointerDown={handlePointerDown}\r\n            onPointerMove={handlePointerMove}\r\n            onPointerUp={handlePointerUp}\r\n            onPointerCancel={handlePointerUp}\r\n            onPointerLeave={handlePointerLeave}\r\n            onContextMenu={handleContextMenu}\r\n        />\r\n    );\r\n}\r\n","export * from \"./command-bar\";\r\nexport * from \"./fetch-server\";\r\nexport * from \"./navigation-bar\";\r\nexport * from \"./settings\";\r\nexport * from \"./state\";\r\nexport * from \"./video-container\";\r\n","import { useEffect } from \"react\";\r\n\r\ntype CommonEventMaps<T> = T extends typeof globalThis\r\n    ? WindowEventMap\r\n    : T extends Window\r\n    ? WindowEventMap\r\n    : T extends Document\r\n    ? DocumentEventMap\r\n    : T extends HTMLElement\r\n    ? HTMLElementEventMap\r\n    : T extends SVGElement\r\n    ? SVGElementEventMap\r\n    : { [type: string]: unknown };\r\n\r\nconst useClientAddEventListener = <\r\n    T extends EventTarget,\r\n    U extends keyof CommonEventMaps<T>\r\n>(\r\n    target: T | (() => T),\r\n    type: U,\r\n    listener: (this: T, ev: CommonEventMaps<T>[U]) => any,\r\n    options?: AddEventListenerOptions,\r\n    deps?: readonly unknown[]\r\n) => {\r\n    useEffect(() => {\r\n        const targetValue = typeof target === \"function\" ? target() : target;\r\n        targetValue.addEventListener(type as any, listener as any, options);\r\n\r\n        return () =>\r\n            targetValue.removeEventListener(\r\n                type as any,\r\n                listener as any,\r\n                options\r\n            );\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, deps);\r\n};\r\n\r\nexport const useAddEventListener =\r\n    typeof window !== \"undefined\" ? useClientAddEventListener : () => {};\r\n","import { useLayoutEffect as useReactLayoutEffect } from \"react\";\r\n\r\nexport const useLayoutEffect =\r\n    typeof window !== \"undefined\" ? useReactLayoutEffect : () => {};\r\n","import { MutableRefObject, useRef } from \"react\";\r\n\r\nimport { useLayoutEffect } from \"./layout-effect\";\r\n\r\nconst UNINITIALIZED = Symbol(\"UNINITIALIZED\");\r\n\r\nexport function useConstLazy<T>(initializer: () => T): T {\r\n    const ref = useRef<T | typeof UNINITIALIZED>(UNINITIALIZED);\r\n    if (ref.current === UNINITIALIZED) {\r\n        ref.current = initializer();\r\n    }\r\n    return ref.current;\r\n}\r\n\r\nexport function useConst<T>(value: T): T {\r\n    const ref = useRef(value);\r\n    return ref.current;\r\n}\r\n\r\nexport function useLatestRef<T>(value: T): MutableRefObject<T> {\r\n    const ref = useRef(value);\r\n    useLayoutEffect(() => {\r\n        ref.current = value;\r\n    }, [value]);\r\n    return ref;\r\n}\r\n\r\nexport function useStableCallback<T extends (...args: any[]) => void>(\r\n    callback: T\r\n): T {\r\n    const callbackRef = useLatestRef(callback);\r\n    return useConst(function (...args) {\r\n        return callbackRef.current(...args);\r\n    } as T);\r\n}\r\n","import { useState } from \"react\";\r\n\r\nimport { useAddEventListener } from \"./add-event-listener\";\r\nimport { useStableCallback } from \"./stable-callback\";\r\n\r\nfunction useClientLocalStorage<T extends string = string>(\r\n    key: string,\r\n    fallbackValue: T\r\n) {\r\n    const [value, setValue] = useState<T>(\r\n        () => (localStorage.getItem(key) as T) || fallbackValue\r\n    );\r\n\r\n    useAddEventListener(\r\n        globalThis,\r\n        \"storage\",\r\n        () =>\r\n            setValue((localStorage.getItem(key) as T | null) ?? fallbackValue),\r\n        { passive: true },\r\n        [key, fallbackValue]\r\n    );\r\n\r\n    const handleChange = useStableCallback((value: T) => {\r\n        setValue(value);\r\n        localStorage.setItem(key, value);\r\n    });\r\n\r\n    return [value, handleChange] as const;\r\n}\r\n\r\nexport const useLocalStorage: typeof useClientLocalStorage =\r\n    typeof localStorage !== \"undefined\"\r\n        ? useClientLocalStorage\r\n        : (key, fallbackValue) => [fallbackValue, () => {}];\r\n","export * from \"./add-event-listener\";\r\nexport * from \"./layout-effect\";\r\nexport * from \"./local-storage\";\r\nexport * from \"./stable-callback\";\r\n","import {\r\n    Dialog,\r\n    LayerHost,\r\n    Link,\r\n    PrimaryButton,\r\n    ProgressIndicator,\r\n    Stack,\r\n    StackItem,\r\n} from \"@fluentui/react\";\r\nimport { useId } from \"@fluentui/react-hooks\";\r\nimport { makeStyles, shorthands } from \"@griffel/react\";\r\nimport { WebCodecsDecoder } from \"@yume-chan/scrcpy-decoder-webcodecs\";\r\nimport { action, runInAction } from \"mobx\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { NextPage } from \"next\";\r\nimport Head from \"next/head\";\r\nimport { KeyboardEvent, useEffect, useState } from \"react\";\r\nimport { DemoModePanel, DeviceView, ExternalLink } from \"../components\";\r\nimport {\r\n    NavigationBar,\r\n    SETTING_DEFINITIONS,\r\n    SETTING_STATE,\r\n    STATE,\r\n    ScrcpyCommandBar,\r\n    SettingItem,\r\n    VideoContainer,\r\n} from \"../components/scrcpy\";\r\nimport { useLocalStorage } from \"../hooks\";\r\nimport { GLOBAL_STATE } from \"../state\";\r\nimport { CommonStackTokens, RouteStackProps, formatSpeed } from \"../utils\";\r\n\r\nconst useClasses = makeStyles({\r\n    layerHost: {\r\n        position: \"absolute\",\r\n        top: 0,\r\n        bottom: 0,\r\n        left: 0,\r\n        right: 0,\r\n        pointerEvents: \"none\",\r\n        ...shorthands.margin(0),\r\n    },\r\n    fullScreenContainer: {\r\n        flexGrow: 1,\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n        backgroundColor: \"black\",\r\n        \":focus-visible\": {\r\n            ...shorthands.outline(\"0\"),\r\n        },\r\n    },\r\n    fullScreenStatusBar: {\r\n        display: \"flex\",\r\n        color: \"white\",\r\n        columnGap: \"12px\",\r\n        ...shorthands.padding(\"8px\", \"20px\"),\r\n    },\r\n    spacer: {\r\n        flexGrow: 1,\r\n    },\r\n});\r\n\r\nconst ConnectingDialog = observer(() => {\r\n    const classes = useClasses();\r\n    const layerHostId = useId(\"layerHost\");\r\n\r\n    const [isClient, setIsClient] = useState(false);\r\n\r\n    useEffect(() => {\r\n        setIsClient(true);\r\n    }, []);\r\n\r\n    if (!isClient) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <LayerHost id={layerHostId} className={classes.layerHost} />\r\n\r\n            <Dialog\r\n                hidden={!STATE.connecting}\r\n                modalProps={{ layerProps: { hostId: layerHostId } }}\r\n                dialogContentProps={{ title: \"Connecting...\" }}\r\n            >\r\n                <Stack tokens={CommonStackTokens}>\r\n                    <ProgressIndicator\r\n                        label=\"Downloading scrcpy server...\"\r\n                        percentComplete={\r\n                            STATE.serverTotalSize\r\n                                ? STATE.serverDownloadedSize /\r\n                                  STATE.serverTotalSize\r\n                                : undefined\r\n                        }\r\n                        description={formatSpeed(\r\n                            STATE.debouncedServerDownloadedSize,\r\n                            STATE.serverTotalSize,\r\n                            STATE.serverDownloadSpeed\r\n                        )}\r\n                    />\r\n\r\n                    <ProgressIndicator\r\n                        label=\"Pushing scrcpy server to device...\"\r\n                        progressHidden={\r\n                            STATE.serverTotalSize === 0 ||\r\n                            STATE.serverDownloadedSize !== STATE.serverTotalSize\r\n                        }\r\n                        percentComplete={\r\n                            STATE.serverUploadedSize / STATE.serverTotalSize\r\n                        }\r\n                        description={formatSpeed(\r\n                            STATE.debouncedServerUploadedSize,\r\n                            STATE.serverTotalSize,\r\n                            STATE.serverUploadSpeed\r\n                        )}\r\n                    />\r\n\r\n                    <ProgressIndicator\r\n                        label=\"Starting scrcpy server on device...\"\r\n                        progressHidden={\r\n                            STATE.serverTotalSize === 0 ||\r\n                            STATE.serverUploadedSize !== STATE.serverTotalSize\r\n                        }\r\n                    />\r\n                </Stack>\r\n            </Dialog>\r\n        </>\r\n    );\r\n});\r\n\r\nasync function handleKeyEvent(e: KeyboardEvent<HTMLDivElement>) {\r\n    if (!STATE.client) {\r\n        return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    const { type, code } = e;\r\n    STATE.keyboard![type === \"keydown\" ? \"down\" : \"up\"](code);\r\n}\r\n\r\nfunction handleBlur() {\r\n    if (!STATE.client) {\r\n        return;\r\n    }\r\n\r\n    STATE.keyboard?.reset();\r\n}\r\n\r\nconst FullscreenHint = observer(function FullscreenHint({\r\n    keyboardLockEnabled,\r\n}: {\r\n    keyboardLockEnabled: boolean;\r\n}) {\r\n    const classes = useClasses();\r\n\r\n    const [hintHidden, setHintHidden] = useLocalStorage<`${boolean}`>(\r\n        \"scrcpy-hint-hidden\",\r\n        \"false\"\r\n    );\r\n\r\n    if (!keyboardLockEnabled || !STATE.isFullScreen || hintHidden === \"true\") {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className={classes.fullScreenStatusBar}>\r\n            <div>{GLOBAL_STATE.device?.serial}</div>\r\n            <div>FPS: {STATE.fps}</div>\r\n\r\n            <div className={classes.spacer} />\r\n\r\n            <div>Press and hold ESC to exit full screen</div>\r\n\r\n            <Link onClick={() => setHintHidden(\"true\")}>\r\n                {`Don't show again`}\r\n            </Link>\r\n        </div>\r\n    );\r\n});\r\n\r\nconst Scrcpy: NextPage = () => {\r\n    const classes = useClasses();\r\n\r\n    useEffect(() => {\r\n        // Detect WebCodecs support at client side\r\n        if (\r\n            SETTING_STATE.decoders.length === 1 &&\r\n            WebCodecsDecoder.isSupported()\r\n        ) {\r\n            runInAction(() => {\r\n                SETTING_STATE.decoders.unshift({\r\n                    key: \"webcodecs\",\r\n                    name: \"WebCodecs\",\r\n                    Constructor: WebCodecsDecoder,\r\n                });\r\n            });\r\n        }\r\n    }, []);\r\n\r\n    const [keyboardLockEnabled, setKeyboardLockEnabled] = useState(false);\r\n    useEffect(() => {\r\n        if (!(\"keyboard\" in navigator)) {\r\n            return;\r\n        }\r\n\r\n        // Keyboard Lock is only effective in fullscreen mode,\r\n        // but the `lock` method can be called at any time.\r\n\r\n        // @ts-expect-error\r\n        navigator.keyboard.lock();\r\n        setKeyboardLockEnabled(true);\r\n\r\n        return () => {\r\n            // @ts-expect-error\r\n            navigator.keyboard.unlock();\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        window.addEventListener(\"blur\", handleBlur);\r\n\r\n        return () => {\r\n            window.removeEventListener(\"blur\", handleBlur);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <Stack {...RouteStackProps}>\r\n            <Head>\r\n                <title>Scrcpy - Tango</title>\r\n            </Head>\r\n\r\n            {STATE.running ? (\r\n                <>\r\n                    <ScrcpyCommandBar />\r\n\r\n                    <Stack horizontal grow styles={{ root: { height: 0 } }}>\r\n                        <div\r\n                            ref={STATE.setFullScreenContainer}\r\n                            className={classes.fullScreenContainer}\r\n                            tabIndex={0}\r\n                            onKeyDown={handleKeyEvent}\r\n                            onKeyUp={handleKeyEvent}\r\n                        >\r\n                            <FullscreenHint\r\n                                keyboardLockEnabled={keyboardLockEnabled}\r\n                            />\r\n\r\n                            <DeviceView\r\n                                width={STATE.rotatedWidth}\r\n                                height={STATE.rotatedHeight}\r\n                                BottomElement={NavigationBar}\r\n                            >\r\n                                <VideoContainer />\r\n                            </DeviceView>\r\n                        </div>\r\n\r\n                        <div\r\n                            style={{\r\n                                padding: 12,\r\n                                overflow: \"hidden auto\",\r\n                                display: STATE.logVisible ? \"block\" : \"none\",\r\n                                width: 500,\r\n                                fontFamily: \"monospace\",\r\n                                overflowY: \"auto\",\r\n                                whiteSpace: \"pre-wrap\",\r\n                                wordWrap: \"break-word\",\r\n                            }}\r\n                        >\r\n                            {STATE.log.map((line, index) => (\r\n                                <div key={index}>{line}</div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <DemoModePanel\r\n                            style={{\r\n                                display: STATE.demoModeVisible\r\n                                    ? \"block\"\r\n                                    : \"none\",\r\n                            }}\r\n                        />\r\n                    </Stack>\r\n                </>\r\n            ) : (\r\n                <>\r\n                    <div>\r\n                        <ExternalLink\r\n                            href=\"https://github.com/Genymobile/scrcpy\"\r\n                            spaceAfter\r\n                        >\r\n                            Scrcpy\r\n                        </ExternalLink>\r\n                        can mirror device display and audio with low latency and\r\n                        control the device, all without root access.\r\n                    </div>\r\n                    <div>\r\n                        This is a TypeScript re-implementation of the client\r\n                        part. Paired with official pre-built server binary.\r\n                    </div>\r\n\r\n                    <StackItem align=\"start\">\r\n                        <PrimaryButton\r\n                            text=\"Start\"\r\n                            disabled={!GLOBAL_STATE.adb}\r\n                            onClick={STATE.start}\r\n                        />\r\n                    </StackItem>\r\n\r\n                    {SETTING_DEFINITIONS.get().map((definition) => (\r\n                        <SettingItem\r\n                            key={definition.key}\r\n                            definition={definition}\r\n                            value={\r\n                                (SETTING_STATE[definition.group] as any)[\r\n                                    definition.key\r\n                                ]\r\n                            }\r\n                            onChange={action(\r\n                                (definition, value) =>\r\n                                    ((SETTING_STATE[definition.group] as any)[\r\n                                        definition.key\r\n                                    ] = value)\r\n                            )}\r\n                        />\r\n                    ))}\r\n\r\n                    <ConnectingDialog />\r\n                </>\r\n            )}\r\n        </Stack>\r\n    );\r\n};\r\n\r\nexport default observer(Scrcpy);\r\n"],"names":["window","__NEXT_P","push","__webpack_require__","CommandBarSpacerItem","container","setContainer","useState","useEffect","parent","parentElement","originalFlexGrow","style","flexGrow","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsx","div","ref","cachedValue","worker","cachedInitializePromise","AndroidAv1Profile","AndroidAv1Level","AndroidAvcProfile","AndroidAvcLevel","AndroidHevcProfile","AndroidHevcLevel","AndroidMotionEventAction","AndroidMotionEventButton","ScrcpyPointerId","ScrcpyControlMessageType","AndroidKeyEventAction","AndroidKeyEventMeta","AndroidKeyCode","AndroidScreenPowerMode","ScrcpyDeviceMessageType","ScrcpyLogLevel1_16","ScrcpyVideoOrientation1_16","ScrcpyVideoCodecId","ScrcpyLogLevel1_18","ScrcpyVideoOrientation1_18","annexBSplitNalu","buffer","start","zeroCount","inEmulation","i","length","byte","prevZeroCount","subarray","NaluSodbBitReader","_nalu","_byteLength","_stopBitIndex","_zeroCount","_bytePosition","_bitPosition","_byte","byteLength","stopBitIndex","bytePosition","bitPosition","ended","constructor","nalu","j","readByte","next","value","read","result","skip","decodeExponentialGolombNumber","peek","Object","assign","readBytes","Uint8Array","peekBytes","h264SearchConfiguration","sequenceParameterSet","pictureParameterSet","naluType","h264ParseConfiguration","data","profile_idc","profileIndex","constraint_set","constraintSet","level_idc","levelIndex","pic_width_in_mbs_minus1","pic_height_in_map_units_minus1","frame_mbs_only_flag","frame_crop_left_offset","frame_crop_right_offset","frame_crop_top_offset","frame_crop_bottom_offset","h264ParseSequenceParameterSet","reader","nal_ref_idc","nal_unit_type","constraint_set0_flag","constraint_set1_flag","constraint_set2_flag","constraint_set3_flag","constraint_set4_flag","constraint_set5_flag","seq_parameter_set_id","chroma_format_idc","seq_scaling_matrix_present_flag","seq_scaling_list_present_flag","pic_order_cnt_type","num_ref_frames_in_pic_order_cnt_cycle","offset_for_ref_frame","frame_cropping_flag","encodedWidth","encodedHeight","cropLeft","cropRight","cropTop","cropBottom","croppedWidth","croppedHeight","h265ParseVideoParameterSet","vps_num_units_in_tick","vps_time_scale","vps_poc_proportional_to_timing_flag","vps_num_ticks_poc_diff_one_minus1","vps_num_hrd_parameters","hrd_layer_set_idx","cprms_present_flag","hrdParameters","vps_video_parameter_set_id","vps_base_layer_internal_flag","vps_base_layer_available_flag","vps_max_layers_minus1","vps_max_sub_layers_minus1","vps_temporal_id_nesting_flag","profileTierLevel","h265ParseProfileTierLevel","vps_sub_layer_ordering_info_present_flag","vps_max_dec_pic_buffering_minus1","vps_max_num_reorder_pics","vps_max_latency_increase_plus1","vps_max_layer_id","vps_num_layer_sets_minus1","layer_id_included_flag","vps_timing_info_present_flag","h265ParseHrdParameters","commonInfPresentFlag","maxNumSubLayersMinus1","nal_hrd_parameters_present_flag","vcl_hrd_parameters_present_flag","sub_pic_hrd_params_present_flag","tick_divisor_minus2","du_cpb_removal_delay_increment_length_minus1","sub_pic_cpb_params_in_pic_timing_sei_flag","dpb_output_delay_du_length_minus1","bit_rate_scale","cpb_size_scale","cpb_size_du_scale","initial_cpb_removal_delay_length_minus1","au_cpb_removal_delay_length_minus1","dpb_output_delay_length_minus1","fixed_pic_rate_general_flag","fixed_pic_rate_within_cvs_flag","elemental_duration_in_tc_minus1","low_delay_hrd_flag","cpb_cnt_minus1","nalHrdParameters","vclHrdParameters","cpb_cnt_minus_1","h265ParseSubLayerHrdParameters","vps_extension_flag","h265ParseSequenceParameterSet","separate_colour_plane_flag","conf_win_left_offset","conf_win_right_offset","conf_win_top_offset","conf_win_bottom_offset","sps_max_dec_pic_buffering_minus1","sps_max_num_reorder_pics","sps_max_latency_increase_plus1","sps_scaling_list_data_present_flag","scalingListData","pcm_sample_bit_depth_luma_minus1","pcm_sample_bit_depth_chroma_minus1","log2_min_pcm_luma_coding_block_size_minus3","log2_diff_max_min_pcm_luma_coding_block_size","pcm_loop_filter_disabled_flag","num_long_term_ref_pics_sps","lt_ref_pic_poc_lsb_sps","used_by_curr_pic_lt_sps_flag","vuiParameters","sps_range_extension_flag","sps_multilayer_extension_flag","sps_3d_extension_flag","sps_scc_extension_flag","sps_extension_4bits","spsMultilayerExtension","sps3dExtension","sps_extension_data_flag","sps_video_parameter_set_id","sps_max_sub_layers_minus1","sps_temporal_id_nesting_flag","sps_seq_parameter_set_id","pic_width_in_luma_samples","pic_height_in_luma_samples","conformance_window_flag","bit_depth_luma_minus8","bit_depth_chroma_minus8","log2_max_pic_order_cnt_lsb_minus4","sps_sub_layer_ordering_info_present_flag","log2_min_luma_coding_block_size_minus3","log2_diff_max_min_luma_coding_block_size","log2_min_luma_transform_block_size_minus2","log2_diff_max_min_luma_transform_block_size","max_transform_hierarchy_depth_inter","max_transform_hierarchy_depth_intra","scaling_list_enabled_flag","h265ParseScalingListData","scaling_list","sizeId","matrixId","scaling_list_pred_mode_flag","nextCoef","coefNum","Math","min","scaling_list_dc_coef_minus8","scaling_list_delta_coef","amp_enabled_flag","sample_adaptive_offset_enabled_flag","pcm_enabled_flag","num_short_term_ref_pic_sets","shortTermRefPicSets","h265ParseShortTermReferencePictureSet","stRpsIdx","sets","inter_ref_pic_set_prediction_flag","delta_idx_minus1","delta_rps_sign","abs_delta_rps_minus1","used_by_curr_pic_flag","use_delta_flag","num_negative_pics","num_positive_pics","delta_poc_s0_minus1","used_by_curr_pic_s0_flag","delta_poc_s1_minus1","used_by_curr_pic_s1_flag","RefRpsIdx","RefRps","NumDeltaPocs_RefRpsIdx","DeltaRps","Number","RefPocS0","RefPocS1","pocS0","pocS1","dPoc","prev","current","long_term_ref_pics_present_flag","sps_temporal_mvp_enabled_flag","strong_intra_smoothing_enabled_flag","vui_parameters_present_flag","h265ParseVuiParameters","aspect_ratio_idc","sar_width","sar_height","overscan_appropriate_flag","video_format","video_full_range_flag","colour_description_present_flag","colour_primaries","transfer_characteristics","matrix_coeffs","chroma_sample_loc_type_top_field","chroma_sample_loc_type_bottom_field","def_disp_win_left_offset","def_disp_win_right_offset","def_disp_win_top_offset","def_disp_win_bottom_offset","vui_num_units_in_tick","vui_time_scale","vui_poc_proportional_to_timing_flag","vui_num_ticks_poc_diff_one_minus1","vui_hrd_parameters_present_flag","tiles_fixed_structure_flag","motion_vectors_over_pic_boundaries_flag","restricted_ref_pic_lists_flag","min_spatial_segmentation_idc","max_bytes_per_pic_denom","max_bits_per_min_cu_denom","log2_max_mv_length_horizontal","log2_max_mv_length_vertical","aspect_ratio_info_present_flag","overscan_info_present_flag","video_signal_type_present_flag","chroma_loc_info_present_flag","neutral_chroma_indication_flag","field_seq_flag","frame_field_info_present_flag","default_display_window_flag","vui_timing_info_present_flag","bitstream_restriction_flag","sps_extension_present_flag","h265ParseSpsMultilayerExtension","inter_view_mv_vert_constraint_flag","h265ParseSps3dExtension","iv_di_mc_enabled_flag","iv_mv_scal_enabled_flag","log2_ivmc_sub_pb_size_minus3","iv_res_pred_enabled_flag","depth_ref_enabled_flag","vsp_mc_enabled_flag","dbbp_enabled_flag","tex_mc_enabled_flag","log2_texmc_sub_pb_size_minus3","intra_contour_enabled_flag","intra_dc_only_wedge_enabled_flag","cqt_cu_part_pred_enabled_flag","inter_dc_only_enabled_flag","skip_intra_enabled_flag","h265ParseProfileTier","max_12bit_constraint_flag","max_10bit_constraint_flag","max_8bit_constraint_flag","max_422chroma_constraint_flag","max_420chroma_constraint_flag","max_monochrome_constraint_flag","intra_constraint_flag","one_picture_only_constraint_flag","lower_bit_rate_constraint_flag","max_14bit_constraint_flag","inbld_flag","profile_space","tier_flag","profileCompatibilitySet","profile_compatibility_flag","progressive_source_flag","interlaced_source_flag","non_packed_constraint_flag","frame_only_constraint_flag","profilePresentFlag","generalProfileTier","general_level_idc","sub_layer_profile_present_flag","sub_layer_level_present_flag","subLayerProfileTier","sub_layer_level_idc","subLayerId","CpbCnt","bit_rate_value_minus1","cpb_size_value_minus1","cbr_flag","cpb_size_du_value_minus1","bit_rate_du_value_minus1","h265SearchConfiguration","videoParameterSet","count","header","h265ParseNaluHeader","nuh_layer_id","nuh_temporal_id_plus1","raw","rbsp","h265ParseConfiguration","generalProfileSpace","generalTierFlag","generalProfileIndex","generalProfileCompatibilitySet","generalConstraintSet","generalLevelIndex","SubWidthC","getSubWidthC","SubHeightC","getSubHeightC","BasicControlMessage","esm","AU","uint8","Mouse","Finger","VirtualMouse","VirtualFinger","ScrcpyControlMessageTypeValue","types","options","controlMessageTypes","get","type","indexOf","fillMessageType","message","ScrcpyHoverHelper","lastHoverMessage","process","pointerId","action","Up","undefined","HoverMove","InjectTouch","ScrcpyInjectKeyCodeControlMessage","ZP","W$","uint32","ScrcpyInjectTextControlMessage","string","lengthField","ScrcpySetScreenPowerModeControlMessage","ScrcpyControlMessageSerializer","_options","_typeValues","_scrollController","createScrollController","injectKeyCode","serialize","InjectKeyCode","injectText","text","InjectText","injectTouch","serializeInjectTouchControlMessage","injectScroll","serializeScrollMessage","InjectScroll","backOrScreenOn","serializeBackOrScreenOnControlMessage","BackOrScreenOn","setScreenPowerMode","mode","SetScreenPowerMode","rotateDevice","ScrcpyRotateDeviceControlMessage","RotateDevice","ScrcpyControlMessageWriter","_writer","_serializer","writer","write","stream_extra_esm","ConsumableWritableStream","releaseLock","close","ScrcpyAckClipboardDeviceMessage","uint64","extra","AckClipboard","ScrcpyClipboardDeviceMessage","Clipboard","ScrcpyDeviceMessageDeserializeStream","BufferedTransformStream","stream","readExactly","deserialize","e","tb","oU","hy","CODEC_OPTION_TYPES","repeatPreviousFrameAfter","maxPtsGapToEncoder","CodecOptions","toOptionValue","entries","filter","map","key","input","replace","toLowerCase","join","clamp","max","ScrcpyFloatToUint16FieldDefinition","Pl","size","signed","array","littleEndian","ek","Uint16","dataView","offset","SCRCPY_CONTROL_MESSAGE_TYPES_1_16","ExpandNotificationPanel","CollapseNotificationPanel","GetClipboard","SetClipboard","ScrcpyMediaStreamRawPacket","uint8Array","SCRCPY_MEDIA_PACKET_FLAG_CONFIG","ScrcpyInjectTouchControlMessage1_16","uint16","field","ScrcpySetClipboardControlMessage1_15","ScrcpyAudioCodec","OPUS","AAC","RAW","optionValue","metadataValue","mimeType","webCodecId","DEFAULT_SERVER_PATH","toScrcpyOptionValue","empty","String","ScrcpyOptionsBase","_base","base","setListEncoders","setListDisplays","parseEncoder","line","parseDisplay","parseVideoStreamMetadata","parseAudioStreamMetadata","createMediaStreamTransformer","serializeSetClipboardControlMessage","ScrcpyInjectScrollControlMessage1_16","int32","ScrcpyScrollController1_16","accumulatedX","accumulatedY","processMessage","scrollX","scrollY","processed","ScrcpyOptions1_16","DEFAULTS","logLevel","Debug","maxSize","bitRate","maxFps","lockVideoOrientation","Unlocked","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions","SERIALIZE_ORDER","order","parseCString","maxLength","FO","substring","parseUint16BE","parseUint32BE","Uint32","defaults","init","match","id","parseInt","buffered","BufferedReadableStream","metadata","codec","H264","deviceName","width","height","release","TransformStream","transform","chunk","controller","enqueue","deserializeStream","StructDeserializeStream","writable","readable","pipeThrough","packet","pts","Down","ScrcpyBackOrScreenOnControlMessage1_16","ScrcpyOptions1_17","encoderName","encoderNameRegex","name","ScrcpyBackOrScreenOnControlMessage1_18","concat","SCRCPY_CONTROL_MESSAGE_TYPES_1_18","slice","splice","ExpandSettingPanel","LOG_LEVEL_MAP","Verbose","Info","Warn","Error","VIDEO_ORIENTATION_MAP","Initial","Portrait","Landscape","PortraitFlipped","LandscapeFlipped","ScrcpyOptions1_18","powerOffOnClose","ScrcpySetClipboardControlMessage1_21","int8","ScrcpyOptions1_21","clipboardAutosync","serializedValue","defaultValue","ScrcpyInjectScrollControlMessage1_22","ScrcpyScrollController1_22","ScrcpyOptions1_22","downsizeOnError","sendDeviceMeta","sendDummyByte","KEYFRAME_PTS","ScrcpyOptions1_23","cleanup","keyframe","ScrcpyOptions1_24","powerOn","ScrcpyFloatToInt16FieldDefinition","Int16","ScrcpyInjectScrollControlMessage1_25","ScrcpyScrollController1_25","ScrcpyOptions1_25","ScrcpyInjectTouchControlMessage2_0","ScrcpyInstanceId","NONE","random","toString","ScrcpyOptions2_0","omit","obj","keys","includes","scid","videoCodec","videoBitRate","videoCodecOptions","videoEncoder","audio","audioCodec","audioBitRate","audioCodecOptions","audioEncoder","listEncoders","listDisplays","sendCodecMeta","display","resolution","H265","AV1","codecMetadataValue","PushReadableStream","getReader","done","ScrcpyOptions2_1","video","audioSource","ScrcpyLogLevel","ScrcpyVideoOrientation","ScrcpyOptionsLatest","toHex","padStart","toUpperCase","toUint32Le","WebCodecsDecoder","isSupported","globalThis","VideoDecoder","capabilities","h264","h265","_codec","_writable","_renderer","renderer","_frameRendered","frameRendered","_frameSkipped","frameSkipped","context","decoder","_config","currentFrameRendered","animationFrameId","document","createElement","getContext","output","drawImage","frame","error","WritableStream","configure","decode","onFramePresented","requestAnimationFrame","optimizeForLatency","state","set","EncodedVideoChunk","timestamp","dispose","cancelAnimationFrame","MatroskaVideoCodecNameMap","MatroskaAudioCodecNameMap","MatroskaMuxingRecorder","addVideoChunk","_firstTimestamp","sample","h264StreamToAvcSample","nalUnits","totalLength","unit","muxer","addVideoChunkRaw","configurationWritten","decoderConfig","description","videoCodecDescription","addVideoPacket","videoMetadata","h264ConfigurationToAvcDecoderConfigurationRecord","h265ConfigurationToHevcDecoderConfigurationRecord","general_profile_space","general_tier_flag","general_profile_idc","_packetsFromLastKeyframe","console","addAudioChunk","addAudioChunkRaw","addAudioPacket","_this_videoMetadata_width","_this_videoMetadata_height","running","target","ArrayBufferTarget","firstTimestampBehavior","sampleRate","numberOfChannels","bitDepth","WebMMuxer","stop","finalize","now","Date","saveFile","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getWriter","RECORD_STATE","makeAutoObservable","recorder","recording","intervalId","hours","minutes","seconds","reaction","setInterval","clearInterval","AdbScrcpyExitedError","AdbScrcpyClient","pushServer","adb","file","filename","sync","path","version","connection","createConnection","initialize","adb_esm","AdbReverseNotSupportedError","tunnelForwardOverride","subprocess","spawn","protocols","AdbSubprocessNoneProtocol","stdout","DecodeUtf8Stream","SplitStringStream","abortController","AbortController","pipe","pipeTo","signal","preventCancel","catch","aborted","streams","Promise","race","exit","then","getStreams","abort","concatStreams","item","videoStream","audioStream","controlStream","kill","getEncoders","getDisplays","_process","_stdout","_screenWidth","screenWidth","_screenHeight","screenHeight","_videoStream","_audioStream","_controlMessageWriter","controlMessageWriter","_deviceMessageStream","deviceMessageStream","createVideoStream","createAudioStream","initialStream","InspectStream","AdbScrcpyConnection","socketName","getSocketName","AdbScrcpyForwardConnection","_disposed","connect","createSocket","connectAndRetry","async_esm","delay","AdbScrcpyReverseConnection","address","reverse","remove","queue","add","socket","accept","NOOP","types_AdbScrcpyOptionsBase","_1_16_AdbScrcpyOptions1_16","connectionOptions","client","encoders","encoder","displays","AdbScrcpyOptions2_0","AdbScrcpyOptionsLatest","BIN","U","PcmPlayer","_context","_worklet","_buffer","AudioContext","latencyHint","feed","source","feedCore","audioWorklet","addModule","AudioWorkletNode","sourceName","numberOfInputs","numberOfOutputs","outputChannelCount","destination","disconnect","Int16PcmPlayer","worklet","byteOffset","port","postMessage","Float32PcmPlayer","Float32PlanerPcmPlayer","buffers","channel","AacDecodeStream","config","AudioDecoder","log","Array","from","_","format","planeIndex","Float32Array","allocationSize","BYTES_PER_ELEMENT","copyTo","EncodedAudioChunk","flush","OpusDecodeStream","FetchWithProgress","downloaded","_downloaded","total","_total","onProgress","progressEvent","event","fetch","url","response","headers","fire","body","chunks","reduce","position","EventEmitter","promise","fetchServer","ScrcpyKeyboardInjector","setModifier","keyCode","_controlLeft","_controlRight","_shiftLeft","_shiftRight","_altLeft","_altRight","_metaLeft","_metaRight","_capsLock","_numLock","getMetaState","metaState","down","_this_client_controlMessageWriter","_keys","repeat","up","delete","reset","clear","Set","AoaKeyboardInjector","register","device","keyboard","AoaHidDevice","HidKeyboard","HidKeyCode","hidKeyboard","aoaKeyboard","sendInputReport","serializeInputReport","unregister","workerReady","pendingResolvers","streamId","PICTURE_READY_SUBSCRIPTIONS","Map","TinyH264Wrapper","event_esm","Xn","pictureReadyEvent","vp","onPictureReady","handler","addDisposable","handlePictureReady","renderStateId","all","t","bind","YuvBuffer","default","YuvCanvas","TinyH264Decoder","maxProfile","Baseline","maxLevel","Level4","_yuvCanvas","_initializer","wrapper","PromiseResolver","attach","chromaWidth","chromaHeight","cropWidth","cropHeight","displayWidth","displayHeight","createTinyH264Wrapper","Worker","tu","URL","p","u","b","addEventListener","resolver","resolve","uPlaneOffset","vPlaneOffset","lumaPlane","chromaPlane","drawFrame","useClasses","makeStyles","labelRight","marginLeft","maxWidth","SettingItem","observer","param","definition","onChange","classes","label","jsx_runtime","jsxs","Stack","horizontal","verticalAlign","span","TooltipHost","content","Icon","className","iconName","Icons","labelExtra","TextField","placeholder","Dropdown","selectedKey","option","Toggle","checked","disabled","SpinButton","labelPosition","Position","step","DEFAULT_SETTINGS","SETTING_STATE","decoders","Constructor","settings","clientSettings","observable","SCRCPY_SETTINGS_FILENAME","autorun","GLOBAL_STATE","GatherStringStream","JSON","parse","runInAction","AdbSyncError","SETTING_DEFINITIONS","computed","group","IconButton","iconProps","onClick","STATE","some","x","encodersForCurrentVideoCodec","every","encodersForCurrentAudioCodec","rotatedWidth","rotation","rotatedHeight","serverBuffer","ReadableStream","Consumable","_this_client","_this_decoder","_this_keyboard","_this_audioPlayer","audioPlayer","fps","clearTimeout","fpsCounterIntervalId","isFullScreen","exitFullscreen","setFullScreenContainer","element","fullScreenContainer","setRendererContainer","rendererContainer","clientPositionToDevicePosition","clientX","clientY","viewRect","getBoundingClientRect","pointerViewX","pointerViewY","y","logVisible","demoModeVisible","navigationBarVisible","hoverHelper","connecting","serverTotalSize","serverDownloadedSize","debouncedServerDownloadedSize","serverDownloadSpeed","serverUploadedSize","debouncedServerUploadedSize","serverUploadSpeed","DistributionStream","ADB_SYNC_MAX_PACKET_SIZE","ProgressStream","progress","decoderDefinition","capability","profile","level","encodeUtf8","stringify","lastFrameRendered","lastFrameSkipped","deltaRendered","deltaSkipped","lastKeyframe","interval","recordStream","playbackStream","tee","Int16Array","navigator","clipboard","writeText","AdbDaemonWebUsbDevice","fullscreenElement","firstChild","appendChild","ITEMS","color","iconOnly","onRender","itemType","ContextualMenuItemType","canCheck","ScrcpyCommandBar","CommandBar","items","backgroundColor","bar","icon","back","handlePointerDown","button","currentTarget","setPointerCapture","preventDefault","stopPropagation","handlePointerUp","handleBackPointerDown","handleBackPointerUp","handleHomePointerDown","handleHomePointerUp","handleAppSwitchPointerDown","handleAppSwitchPointerUp","NavigationBar","children","mergeClasses","verticalFill","horizontalAlign","onPointerDown","onPointerUp","transformOrigin","touchAction","handleWheel","pointerX","pointerY","deltaX","deltaY","buttons","MOUSE_EVENT_BUTTON_TO_ANDROID_BUTTON","pointerType","BigInt","messages","pressure","actionButton","handlePointerMove","handlePointerLeave","handleContextMenu","VideoContainer","passive","removeEventListener","onPointerMove","onPointerCancel","onPointerLeave","onContextMenu","useClientAddEventListener","listener","deps","targetValue","useLayoutEffect","useReactLayoutEffect","Symbol","useLocalStorage","localStorage","fallbackValue","setValue","getItem","useAddEventListener","handleChange","useStableCallback","callback","callbackRef","useLatestRef","useRef","useConst","_len","arguments","args","_key","setItem","layerHost","top","bottom","left","right","pointerEvents","shorthands","flexDirection","fullScreenStatusBar","columnGap","spacer","ConnectingDialog","layerHostId","useId","isClient","setIsClient","Fragment","LayerHost","Dialog","hidden","modalProps","layerProps","hostId","dialogContentProps","title","tokens","CommonStackTokens","ProgressIndicator","percentComplete","formatSpeed","progressHidden","handleKeyEvent","code","handleBlur","FullscreenHint","keyboardLockEnabled","hintHidden","setHintHidden","serial","Link","Scrcpy","setKeyboardLockEnabled","lock","unlock","RouteStackProps","Head","grow","styles","root","tabIndex","onKeyDown","onKeyUp","DeviceView","BottomElement","padding","overflow","fontFamily","overflowY","whiteSpace","wordWrap","index","DemoModePanel","ExternalLink","href","spaceAfter","StackItem","align","PrimaryButton","scrcpy"],"sourceRoot":""}