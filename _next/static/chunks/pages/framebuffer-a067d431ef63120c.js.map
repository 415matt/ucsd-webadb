{"version":3,"file":"static/chunks/pages/framebuffer-a067d431ef63120c.js","mappings":"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","sources":["webpack://_N_E/?7cee","webpack://_N_E/./src/pages/framebuffer.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/framebuffer\",\n      function () {\n        return require(\"private-next-pages/framebuffer.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/framebuffer\"])\n      });\n    }\n  ","import { ICommandBarItemProps, Stack } from \"@fluentui/react\";\r\nimport { AdbFrameBuffer, AdbFrameBufferV2 } from \"@yume-chan/adb\";\r\nimport { action, autorun, computed, makeAutoObservable } from \"mobx\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { NextPage } from \"next\";\r\nimport Head from \"next/head\";\r\nimport { useCallback, useEffect, useRef } from \"react\";\r\nimport { CommandBar, DemoModePanel, DeviceView } from \"../components\";\r\nimport { GLOBAL_STATE } from \"../state\";\r\nimport { Icons, RouteStackProps } from \"../utils\";\r\n\r\nclass FrameBufferState {\r\n    width = 0;\r\n    height = 0;\r\n    imageData: ImageData | undefined = undefined;\r\n    demoModeVisible = false;\r\n\r\n    constructor() {\r\n        makeAutoObservable(this, {\r\n            toggleDemoModeVisible: action.bound,\r\n        });\r\n    }\r\n\r\n    setImage(image: AdbFrameBuffer) {\r\n        this.width = image.width;\r\n        this.height = image.height;\r\n        this.imageData = new ImageData(\r\n            new Uint8ClampedArray(image.data),\r\n            image.width,\r\n            image.height\r\n        );\r\n    }\r\n\r\n    toggleDemoModeVisible() {\r\n        this.demoModeVisible = !this.demoModeVisible;\r\n    }\r\n}\r\n\r\nconst state = new FrameBufferState();\r\n\r\nconst FrameBuffer: NextPage = (): JSX.Element | null => {\r\n    const canvasRef = useRef<HTMLCanvasElement | null>(null);\r\n\r\n    const capture = useCallback(async () => {\r\n        if (!GLOBAL_STATE.adb) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const start = Date.now();\r\n            const framebuffer = await GLOBAL_STATE.adb.framebuffer();\r\n            console.log(\r\n                \"Framebuffer speed\",\r\n                (\r\n                    (((AdbFrameBufferV2.size + framebuffer.size) /\r\n                        (Date.now() - start)) *\r\n                        1000) /\r\n                    1024 /\r\n                    1024\r\n                ).toFixed(2),\r\n                \"MB/s\"\r\n            );\r\n            state.setImage(framebuffer);\r\n        } catch (e: any) {\r\n            GLOBAL_STATE.showErrorDialog(e);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        return autorun(() => {\r\n            const canvas = canvasRef.current;\r\n            if (canvas && state.imageData) {\r\n                canvas.width = state.width;\r\n                canvas.height = state.height;\r\n                const context = canvas.getContext(\"2d\")!;\r\n                context.putImageData(state.imageData, 0, 0);\r\n            }\r\n        });\r\n    }, []);\r\n\r\n    const commandBarItems = computed(() => [\r\n        {\r\n            key: \"start\",\r\n            disabled: !GLOBAL_STATE.adb,\r\n            iconProps: {\r\n                iconName: Icons.Camera,\r\n                style: { height: 20, fontSize: 20, lineHeight: 1.5 },\r\n            },\r\n            text: \"Capture\",\r\n            onClick: capture,\r\n        },\r\n        {\r\n            key: \"Save\",\r\n            disabled: !state.imageData,\r\n            iconProps: {\r\n                iconName: Icons.Save,\r\n                style: { height: 20, fontSize: 20, lineHeight: 1.5 },\r\n            },\r\n            text: \"Save\",\r\n            onClick: () => {\r\n                const canvas = canvasRef.current;\r\n                if (!canvas) {\r\n                    return;\r\n                }\r\n\r\n                const url = canvas.toDataURL();\r\n                const a = document.createElement(\"a\");\r\n                a.href = url;\r\n                a.download = `Screenshot of ${GLOBAL_STATE.device!.name}.png`;\r\n                a.click();\r\n            },\r\n        },\r\n    ]);\r\n\r\n    const commandBarFarItems = computed((): ICommandBarItemProps[] => [\r\n        {\r\n            key: \"DemoMode\",\r\n            iconProps: {\r\n                iconName: Icons.Wand,\r\n                style: { height: 20, fontSize: 20, lineHeight: 1.5 },\r\n            },\r\n            checked: state.demoModeVisible,\r\n            text: \"Demo Mode\",\r\n            onClick: state.toggleDemoModeVisible,\r\n        },\r\n        {\r\n            key: \"info\",\r\n            iconProps: {\r\n                iconName: Icons.Info,\r\n                style: { height: 20, fontSize: 20, lineHeight: 1.5 },\r\n            },\r\n            iconOnly: true,\r\n            tooltipHostProps: {\r\n                content:\r\n                    \"Use ADB FrameBuffer command to capture a full-size, high-resolution screenshot.\",\r\n                calloutProps: {\r\n                    calloutMaxWidth: 250,\r\n                },\r\n            },\r\n        },\r\n    ]);\r\n\r\n    return (\r\n        <Stack {...RouteStackProps}>\r\n            <Head>\r\n                <title>Screen Capture - Tango</title>\r\n            </Head>\r\n\r\n            <CommandBar\r\n                items={commandBarItems.get()}\r\n                farItems={commandBarFarItems.get()}\r\n            />\r\n            <Stack horizontal grow styles={{ root: { height: 0 } }}>\r\n                <DeviceView width={state.width} height={state.height}>\r\n                    <canvas ref={canvasRef} style={{ display: \"block\" }} />\r\n                </DeviceView>\r\n\r\n                <DemoModePanel\r\n                    style={{\r\n                        display: state.demoModeVisible ? \"block\" : \"none\",\r\n                    }}\r\n                />\r\n            </Stack>\r\n        </Stack>\r\n    );\r\n};\r\n\r\nexport default observer(FrameBuffer);\r\n"],"names":["window","__NEXT_P","push","__webpack_require__","state","setImage","image","width","height","imageData","ImageData","Uint8ClampedArray","data","toggleDemoModeVisible","demoModeVisible","constructor","undefined","makeAutoObservable","action","FrameBuffer","canvasRef","useRef","capture","useCallback","GLOBAL_STATE","start","Date","now","framebuffer","console","log","AdbFrameBufferV2","size","toFixed","e","useEffect","autorun","canvas","current","context","getContext","putImageData","commandBarItems","computed","key","disabled","iconProps","iconName","Icons","style","fontSize","lineHeight","text","onClick","url","toDataURL","a","document","createElement","href","download","concat","click","commandBarFarItems","checked","iconOnly","tooltipHostProps","content","calloutProps","calloutMaxWidth","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsxs","Stack","RouteStackProps","jsx","Head","title","CommandBar","items","get","farItems","horizontal","grow","styles","root","DeviceView","ref","display","DemoModePanel","__webpack_exports__","observer"],"sourceRoot":""}