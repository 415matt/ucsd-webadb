{"version":3,"file":"static/chunks/pages/reverse-68c681f2a980f440.js","mappings":"mFACA,CAAAA,OAAAC,QAAA,CAAAD,OAAAC,QAAA,MAAAC,IAAA,EACA,WACA,WACA,OAAeC,EAAQ,KACvB,EACA,2GCCA,IAAMC,EAAQC,CAAAA,EAAAA,EAAAA,EAAAA,EAAmB,CAC7BC,IAAK,EAAE,GAGXC,CAAAA,EAAAA,EAAAA,EAAAA,EACI,IAAMC,EAAAA,CAAAA,CAAAA,GAAgB,CACtB,MAAOC,GAAW,CACTA,IAIL,MAAMA,EAAOC,OAAO,CAACC,MAAM,CAAC,YAAYC,KAAK,CAACC,EAAAA,IAAIA,EAClD,MAAMJ,EAAOC,OAAO,CAACI,GAAG,CAAC,WAAY,GAAY,CAC7CC,CAAAA,EAAAA,EAAAA,CAAAA,EAAY,IAAM,CACdX,EAAME,GAAG,CAACJ,IAAI,CAAE,kBACpB,GACAc,EAAOC,QAAQ,CAACC,MAAM,CAClB,IAAIC,EAAAA,cAAcA,CAAC,CACfC,MAAO,GAAW,CACdL,CAAAA,EAAAA,EAAAA,CAAAA,EAAY,IAAM,CACdX,EAAME,GAAG,CAACJ,IAAI,CACV,kBAAoCmB,MAAA,CAAlBC,CAAAA,EAAAA,EAAAA,UAAAA,EAAWC,IAErC,EACJ,CACJ,GAER,GACJ,EACA,CAAEC,gBAAiB,EAAK,GAG5B,IAAMC,EAA8B,IAE5B,GAAAC,EAAAC,GAAA,EAACC,MAAAA,UACIxB,EAAME,GAAG,CAACuB,GAAG,CAAC,CAACC,EAAMC,IAClB,GAAAL,EAAAC,GAAA,EAACC,MAAAA,UAAiBE,GAARC,KAM1BC,CAAAA,EAAA,QAAeC,CAAAA,EAAAA,EAAAA,EAAAA,EAASR","sources":["webpack://_N_E/?00c0","webpack://_N_E/./src/pages/reverse.tsx","webpack://_N_E/<anon>"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/reverse\",\n      function () {\n        return require(\"private-next-pages/reverse.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/reverse\"])\n      });\n    }\n  ","import { NOOP, decodeUtf8 } from \"@yume-chan/adb\";\r\nimport { WritableStream } from \"@yume-chan/stream-extra\";\r\nimport { makeAutoObservable, reaction, runInAction } from \"mobx\";\r\nimport { observer } from \"mobx-react-lite\";\r\nimport { NextPage } from \"next\";\r\nimport { GLOBAL_STATE } from \"../state\";\r\n\r\nconst state = makeAutoObservable({\r\n    log: [] as string[],\r\n});\r\n\r\nreaction(\r\n    () => GLOBAL_STATE.adb,\r\n    async (device) => {\r\n        if (!device) {\r\n            return;\r\n        }\r\n\r\n        await device.reverse.remove(\"tcp:3000\").catch(NOOP);\r\n        await device.reverse.add(\"tcp:3000\", (socket) => {\r\n            runInAction(() => {\r\n                state.log.push(`received stream`);\r\n            });\r\n            socket.readable.pipeTo(\r\n                new WritableStream({\r\n                    write: (chunk) => {\r\n                        runInAction(() => {\r\n                            state.log.push(\r\n                                `received data: ${decodeUtf8(chunk)}`\r\n                            );\r\n                        });\r\n                    },\r\n                })\r\n            );\r\n        });\r\n    },\r\n    { fireImmediately: true }\r\n);\r\n\r\nconst ReverseTesterPage: NextPage = () => {\r\n    return (\r\n        <div>\r\n            {state.log.map((line, index) => (\r\n                <div key={index}>{line}</div>\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default observer(ReverseTesterPage);\r\n"],"names":["window","__NEXT_P","push","__webpack_require__","state","makeAutoObservable","log","reaction","GLOBAL_STATE","device","reverse","remove","catch","NOOP","add","runInAction","socket","readable","pipeTo","WritableStream","write","concat","decodeUtf8","chunk","fireImmediately","ReverseTesterPage","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","jsx","div","map","line","index","__webpack_exports__","observer"],"sourceRoot":""}